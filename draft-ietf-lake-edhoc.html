<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Ephemeral Diffie-Hellman Over COSE (EDHOC)</title>
<meta content="Göran Selander" name="author">
<meta content="John Preuß Mattsson" name="author">
<meta content="Francesca Palombini" name="author">
<meta content="
       This document specifies Ephemeral Diffie-Hellman Over COSE (EDHOC), a very compact, and lightweight authenticated Diffie-Hellman key exchange with ephemeral keys.  EDHOC provides mutual authentication, perfect forward secrecy, and identity protection. EDHOC is intended for usage in constrained scenarios and a main use case is to establish an OSCORE security context. By reusing COSE for cryptography, CBOR for encoding, and CoAP for transport, the additional code footprint can be kept very low. 
    " name="description">
<meta content="xml2rfc 3.3.0" name="generator">
<meta content="draft-ietf-lake-edhoc-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.3.0
    Python 3.8.5
    appdirs 1.4.4
    ConfigArgParse 1.2.3
    google-i18n-address 2.4.0
    html5lib 1.1
    intervaltree 3.0.2
    Jinja2 2.11.2
    kitchen 1.2.6
    lxml 4.5.0
    pycountry 19.8.18
    pyflakes 2.1.1
    PyYAML 5.3.1
    requests 2.22.0
    setuptools 45.2.0
    six 1.14.0
-->
<link href="draft-ietf-lake-edhoc.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@import url('https://martinthomson.github.io/i-d-template/fonts.css');

html {
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --small-font-size: 14.5px;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
#title {
  padding: 1em 0 0.2em;
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1, h2, h3 {
  font-size: 22px;
  line-height: 26px;
}
h4, h5, h6 {
  font-size: 18px;
  line-height: 22px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p, #abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 18px;
  line-height: 24px;
}
p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
dd.break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href].selfRef {
  color: var(--text-color);
}
a[href] {
  color: var(--link-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px 'Oxygen Mono', monospace;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  pre {
    display: inline-block;
    overflow-x: auto;
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  pre + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
  table {
    display: inline-block;
    overflow-x: auto;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
tr:nth-child(2n) > td {
  background-color: var(--background-color);
}
tr:nth-child(2n+1) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n+1) > td {
  background-color: var(--background-color);
}
table caption {
  margin: 0;
  padding: 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  visibility: hidden;
  user-select: none;
}
a.pilcrow[href] { color: #ddd; }
a.pilcrow[href]:hover { text-decoration: none; }
@media screen {
  :hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 8em;
}
#identifiers dt {
  width: var(--identifier-width);
  margin: 0;
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0 0 0 calc(1em + var(--identifier-width));
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 500px) {
  .index ul {
    column-count: 2;
    column-gap: 20px;
  }
  .index ul ul {
    column-count: 1;
    column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul p, #toc ul li {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table .text-left, table .text-left {
  text-align: left;
}
table .text-center, table .text-center {
  text-align: center;
}
table .text-right, table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
</head>
<body>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Ephemeral Diffie-Hellman Over COSE (EDHO</td>
<td class="right">November 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">Selander, et al.</td>
<td class="center">Expires 19 May 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-lake-edhoc-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-11-15" class="published">15 November 2020</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-05-19">19 May 2021</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">G. Selander</div>
<div class="org">Ericsson AB</div>
</div>
<div class="author">
      <div class="author-name">J. Mattsson</div>
<div class="org">Ericsson AB</div>
</div>
<div class="author">
      <div class="author-name">F. Palombini</div>
<div class="org">Ericsson AB</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Ephemeral Diffie-Hellman Over COSE (EDHOC)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies Ephemeral Diffie-Hellman Over COSE (EDHOC), a very compact, and lightweight authenticated Diffie-Hellman key exchange with ephemeral keys.  EDHOC provides mutual authentication, perfect forward secrecy, and identity protection. EDHOC is intended for usage in constrained scenarios and a main use case is to establish an OSCORE security context. By reusing COSE for cryptography, CBOR for encoding, and CoAP for transport, the additional code footprint can be kept very low.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 19 May 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-rationale-for-edhoc" class="xref">Rationale for EDHOC</a><a href="#section-toc.1-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-use-of-edhoc" class="xref">Use of EDHOC</a><a href="#section-toc.1-1.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1" class="keepWithNext"><a href="#section-1.3" class="xref">1.3</a>.  <a href="#name-terminology-and-requirement" class="xref">Terminology and Requirements Language</a><a href="#section-toc.1-1.1.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-background" class="xref">Background</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-edhoc-overview" class="xref">EDHOC Overview</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-transport-and-message-corre" class="xref">Transport and Message Correlation</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-authentication-keys-and-ide" class="xref">Authentication Keys and Identities</a><a href="#section-toc.1-1.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-identifiers" class="xref">Identifiers</a><a href="#section-toc.1-1.3.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-cipher-suites" class="xref">Cipher Suites</a><a href="#section-toc.1-1.3.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="xref">3.5</a>.  <a href="#name-communication-negotiation-o" class="xref">Communication/Negotiation of Protocol Features</a><a href="#section-toc.1-1.3.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.3.2.6">
                <p id="section-toc.1-1.3.2.6.1"><a href="#section-3.6" class="xref">3.6</a>.  <a href="#name-auxiliary-data" class="xref">Auxiliary Data</a><a href="#section-toc.1-1.3.2.6.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.3.2.7">
                <p id="section-toc.1-1.3.2.7.1"><a href="#section-3.7" class="xref">3.7</a>.  <a href="#name-ephemeral-public-keys" class="xref">Ephemeral Public Keys</a><a href="#section-toc.1-1.3.2.7.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.3.2.8">
                <p id="section-toc.1-1.3.2.8.1"><a href="#section-3.8" class="xref">3.8</a>.  <a href="#name-key-derivation" class="xref">Key Derivation</a><a href="#section-toc.1-1.3.2.8.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-edhoc-authenticated-with-as" class="xref">EDHOC Authenticated with Asymmetric Keys</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-overview" class="xref">Overview</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-encoding-of-public-authenti" class="xref">Encoding of Public Authentication Key Identifiers</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-encoding-of-bstr_identifier" class="xref">Encoding of bstr_identifier</a><a href="#section-toc.1-1.4.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-edhoc-message-1" class="xref">EDHOC Message 1</a><a href="#section-toc.1-1.4.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-edhoc-message-2" class="xref">EDHOC Message 2</a><a href="#section-toc.1-1.4.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="xref">4.6</a>.  <a href="#name-edhoc-message-3" class="xref">EDHOC Message 3</a><a href="#section-toc.1-1.4.2.6.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-error-handling" class="xref">Error Handling</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-edhoc-error-message" class="xref">EDHOC Error Message</a><a href="#section-toc.1-1.5.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-transferring-edhoc-and-deri" class="xref">Transferring EDHOC and Deriving an OSCORE Context</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-transferring-edhoc-in-coap" class="xref">Transferring EDHOC in CoAP</a><a href="#section-toc.1-1.6.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-security-properties" class="xref">Security Properties</a><a href="#section-toc.1-1.7.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-cryptographic-consideration" class="xref">Cryptographic Considerations</a><a href="#section-toc.1-1.7.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-cipher-suites-2" class="xref">Cipher Suites</a><a href="#section-toc.1-1.7.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="xref">7.4</a>.  <a href="#name-unprotected-data" class="xref">Unprotected Data</a><a href="#section-toc.1-1.7.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.7.2.5">
                <p id="section-toc.1-1.7.2.5.1"><a href="#section-7.5" class="xref">7.5</a>.  <a href="#name-denial-of-service" class="xref">Denial-of-Service</a><a href="#section-toc.1-1.7.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.7.2.6">
                <p id="section-toc.1-1.7.2.6.1"><a href="#section-7.6" class="xref">7.6</a>.  <a href="#name-implementation-consideratio" class="xref">Implementation Considerations</a><a href="#section-toc.1-1.7.2.6.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.7.2.7">
                <p id="section-toc.1-1.7.2.7.1"><a href="#section-7.7" class="xref">7.7</a>.  <a href="#name-other-documents-referencing" class="xref">Other Documents Referencing EDHOC</a><a href="#section-toc.1-1.7.2.7.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-edhoc-cipher-suites-registr" class="xref">EDHOC Cipher Suites Registry</a><a href="#section-toc.1-1.8.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-edhoc-method-type-registry" class="xref">EDHOC Method Type Registry</a><a href="#section-toc.1-1.8.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="xref">8.3</a>.  <a href="#name-the-well-known-uri-registry" class="xref">The Well-Known URI Registry</a><a href="#section-toc.1-1.8.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="xref">8.4</a>.  <a href="#name-media-types-registry" class="xref">Media Types Registry</a><a href="#section-toc.1-1.8.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.8.2.5">
                <p id="section-toc.1-1.8.2.5.1"><a href="#section-8.5" class="xref">8.5</a>.  <a href="#name-coap-content-formats-regist" class="xref">CoAP Content-Formats Registry</a><a href="#section-toc.1-1.8.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.8.2.6">
                <p id="section-toc.1-1.8.2.6.1"><a href="#section-8.6" class="xref">8.6</a>.  <a href="#name-expert-review-instructions" class="xref">Expert Review Instructions</a><a href="#section-toc.1-1.8.2.6.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.9.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.9.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-appendix.a" class="xref">Appendix A</a>.  <a href="#name-use-of-cbor-cddl-and-cose-i" class="xref">Use of CBOR, CDDL and COSE in EDHOC</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-a.1" class="xref">A.1</a>.  <a href="#name-cbor-and-cddl" class="xref">CBOR and CDDL</a><a href="#section-toc.1-1.10.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-a.2" class="xref">A.2</a>.  <a href="#name-cose" class="xref">COSE</a><a href="#section-toc.1-1.10.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-appendix.b" class="xref">Appendix B</a>.  <a href="#name-test-vectors" class="xref">Test Vectors</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-b.1" class="xref">B.1</a>.  <a href="#name-test-vectors-for-edhoc-auth" class="xref">Test Vectors for EDHOC Authenticated with Signature Keys (x5t)</a><a href="#section-toc.1-1.11.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-b.2" class="xref">B.2</a>.  <a href="#name-test-vectors-for-edhoc-authe" class="xref">Test Vectors for EDHOC Authenticated with Static Diffie-Hellman Keys</a><a href="#section-toc.1-1.11.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-appendix.c" class="xref"></a><a href="#name-acknowledgments" class="xref">Acknowledgments</a><a href="#section-toc.1-1.12.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-appendix.d" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.13.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Security at the application layer provides an attractive option for protecting Internet of Things (IoT) deployments, for example where protection needs to work over a variety of underlying protocols. IoT devices may be constrained in various ways, including memory, storage, processing capacity, and energy <span>[<a href="#RFC7228" class="xref">RFC7228</a>]</span>. A method for protecting individual messages at the application layer suitable for constrained devices, is provided by CBOR Object Signing and Encryption (COSE) <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>), which builds on the Concise Binary Object Representation (CBOR) <span>[<a href="#RFC7049" class="xref">RFC7049</a>]</span>. Object Security for Constrained RESTful Environments (OSCORE) <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> is a method for application-layer protection of the Constrained Application Protocol (CoAP), using COSE.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">In order for a communication session to provide forward secrecy, the communicating parties can run an Elliptic Curve Diffie-Hellman (ECDH) key exchange protocol with ephemeral keys, from which shared key material can be derived. This document specifies Ephemeral Diffie-Hellman Over COSE (EDHOC), a lightweight key exchange protocol providing perfect forward secrecy and identity protection. Authentication is based on credentials established out of band, e.g. from a trusted third party, such as an Authorization Server as specified by <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. The construction provided by EDHOC can be applied to authenticate raw public keys (RPK) and public key certificates. This version of the protocol is focusing on RPK and certificates by reference which is the initial focus for the LAKE WG (see Section 2.2 of <span>[<a href="#I-D.ietf-lake-reqs" class="xref">I-D.ietf-lake-reqs</a>]</span>).<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">After successful completion of the EDHOC protocol, application keys and other application specific data can be derived using the EDHOC-Exporter interface. A main use case for EDHOC is to establish an OSCORE security context. EDHOC uses COSE for cryptography, CBOR for encoding, and CoAP for transport. By reusing existing libraries, the additional code footprint can be kept very low.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">EDHOC is designed for highly constrained settings making it especially suitable for low-power wide area networks <span>[<a href="#RFC8376" class="xref">RFC8376</a>]</span> such as Cellular IoT, 6TiSCH, and LoRaWAN. Compared to the DTLS 1.3 handshake <span>[<a href="#I-D.ietf-tls-dtls13" class="xref">I-D.ietf-tls-dtls13</a>]</span> with ECDH and connection ID, the number of bytes in EDHOC + CoAP can be less than 1/6 when RPK authentication is used, see <span>[<a href="#I-D.ietf-lwig-security-protocol-comparison" class="xref">I-D.ietf-lwig-security-protocol-comparison</a>]</span>. <a href="#fig-sizes" class="xref">Figure 1</a> shows two examples of message sizes for EDHOC with different kinds of authentication keys and different COSE header parameters for identification: static Diffie-Hellman keys identified by 'kid' <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>, and X.509 signature certificates identified by a hash value using 'x5t' <span>[<a href="#I-D.ietf-cose-x509" class="xref">I-D.ietf-cose-x509</a>]</span>. Further reductions of message sizes are possible, for example by eliding redundant length indications.<a href="#section-1-4" class="pilcrow">¶</a></p>
<span id="name-example-of-message-sizes-in"></span><div id="fig-sizes">
<figure id="figure-1">
        <div class="artwork art-text alignCenter" id="section-1-5.1">
<pre>
=================================
                    kid       x5t
---------------------------------
message_1            37        37
message_2            46       117
message_3            20        91
----------------------------------
Total               103       245
=================================
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-example-of-message-sizes-in" class="selfRef">Example of message sizes in bytes.</a>
        </figcaption></figure>
</div>
<p id="section-1-6">The ECDH exchange and the key derivation follow known protocol constructions such as <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span>, NIST SP-800-56A <span>[<a href="#SP-800-56A" class="xref">SP-800-56A</a>]</span>, and HKDF <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span>. CBOR <span>[<a href="#RFC7049" class="xref">RFC7049</a>]</span> and COSE <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span> are used to implement these standards. The use of COSE provides crypto agility and enables use of future algorithms and headers designed for constrained IoT.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">This document is organized as follows: <a href="#background" class="xref">Section 2</a> describes how EDHOC authenticated with digital signatures builds on SIGMA-I, <a href="#overview" class="xref">Section 3</a> specifies general properties of EDHOC, including message flow, formatting of the ephemeral public keys, and key derivation, <a href="#asym" class="xref">Section 4</a> specifies EDHOC with signature key and static Diffie-Hellman key authentication, <a href="#error" class="xref">Section 5</a> specifies the EDHOC error message, and <a href="#transfer" class="xref">Section 6</a> describes how EDHOC can be transferred in CoAP and used to establish an OSCORE security context.<a href="#section-1-7" class="pilcrow">¶</a></p>
<div id="rationale-for-edhoc">
<section id="section-1.1">
        <h3 id="name-rationale-for-edhoc">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-rationale-for-edhoc" class="section-name selfRef">Rationale for EDHOC</a>
        </h3>
<p id="section-1.1-1">Many constrained IoT systems today do not use any security at all, and when they do, they often do not follow best practices. One reason is that many current security protocols are not designed with constrained IoT in mind. Constrained IoT systems often deal with personal information, valuable business data, and actuators interacting with the physical world. Not only do such systems need security and privacy, they often need end-to-end protection with source authentication and perfect forward secrecy. EDHOC and OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> enables security following current best practices to devices and systems where current security protocols are impractical.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">EDHOC is optimized for small message sizes and can therefore be sent over a small number of radio frames. The message size of a key exchange protocol may have a large impact on the performance of an IoT deployment, especially in constrained environments. For example, in a network bootstrapping setting a large number of devices turned on in a short period of time may result in large latencies caused by parallel key exchanges. Requirements on network formation time in constrained environments can be translated into key exchange overhead. In network technologies with duty cycle, each additional frame significantly increases the latency even if no other devices are transmitting.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">Power consumption for wireless devices is highly dependent on message transmission, listening, and reception. For devices that only send a few bytes occasionally, the battery lifetime may be impacted by a heavy key exchange protocol. A key exchange may need to be executed more than once, e.g. due to a device rebooting or for security reasons such as perfect forward secrecy.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4">EDHOC is adapted to primitives and protocols designed for the Internet of Things: EDHOC is built on CBOR and COSE which enables small message overhead and efficient parsing in constrained devices. EDHOC is not bound to a particular transport layer, but it is recommended to transport the EDHOC message in CoAP payloads. EDHOC is not bound to a particular communication security protocol but works off-the-shelf with OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> providing the necessary input parameters with required properties. Maximum code complexity (ROM/Flash) is often a constraint in many devices and by reusing already existing libraries, the additional code footprint for EDHOC + OSCORE can be kept very low.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="use-of-edhoc">
<section id="section-1.2">
        <h3 id="name-use-of-edhoc">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-use-of-edhoc" class="section-name selfRef">Use of EDHOC</a>
        </h3>
<p id="section-1.2-1">EDHOC is designed as a lightweight AKE for OSCORE, i.e. to provide authentication and session key establishment for IoT use cases such as those built on CoAP <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span>. CoAP is a specialized web transfer protocol for use with constrained nodes and networks, providing a request/response interaction model between application endpoints. As such, EDHOC is targeting a large variety of use cases involving 'things' with embedded microcontrollers, sensors and actuators.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2">A typical setting is when one of the endpoints is constrained or in a constrained network, and the other endpoint is a node on the Internet (such as a mobile phone) or at the edge of the constrained network (such as a gateway). Thing-to-thing interactions over constrained networks are also relevant since both endpoints would then benefit from the lightweight properties of the protocol. EDHOC could e.g. be run when a device/device(s) connect(s) for the first time, or to establish fresh keys which are not compromised by a later compromise of the long-term keys. (Further security properties are described in <a href="#sec-prop" class="xref">Section 7.1</a>.)<a href="#section-1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology-and-requirements-language">
<section id="section-1.3">
        <h3 id="name-terminology-and-requirement">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-terminology-and-requirement" class="section-name selfRef">Terminology and Requirements Language</a>
        </h3>
<p id="section-1.3-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as shown here.<a href="#section-1.3-1" class="pilcrow">¶</a></p>
<p id="section-1.3-2">Readers are expected to be familiar with the terms and concepts described in CBOR <span>[<a href="#RFC7049" class="xref">RFC7049</a>]</span>, CBOR Sequences <span>[<a href="#RFC8742" class="xref">RFC8742</a>]</span>, COSE <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>, and CDDL <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span>. The Concise Data Definition Language (CDDL) is used to express CBOR data structures <span>[<a href="#RFC7049" class="xref">RFC7049</a>]</span>. Examples of CBOR and CDDL are provided in <a href="#CBOR" class="xref">Appendix A.1</a>.<a href="#section-1.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="background">
<section id="section-2">
      <h2 id="name-background">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-background" class="section-name selfRef">Background</a>
      </h2>
<p id="section-2-1">EDHOC specifies different authentication methods of the Diffie-Hellman key exchange: digital signatures and static Diffie-Hellman keys. This section outlines the digital signature based method.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">SIGMA (SIGn-and-MAc) is a family of theoretical protocols with a large number of variants <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span>. Like IKEv2 <span>[<a href="#RFC7296" class="xref">RFC7296</a>]</span> and (D)TLS 1.3 <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>, EDHOC authenticated with digital signatures is built on a variant of the SIGMA protocol which provide identity protection of the initiator (SIGMA-I), and like IKEv2 <span>[<a href="#RFC7296" class="xref">RFC7296</a>]</span>, EDHOC implements the SIGMA-I variant as Mac-then-Sign. The SIGMA-I protocol using an authenticated encryption algorithm is shown in <a href="#fig-sigma" class="xref">Figure 2</a>.<a href="#section-2-2" class="pilcrow">¶</a></p>
<span id="name-authenticated-encryption-va"></span><div id="fig-sigma">
<figure id="figure-2">
        <div class="artwork art-text alignCenter" id="section-2-3.1">
<pre>
Initiator                                               Responder
   |                          G_X                            |
   +--------------------------------------------------------&gt;|
   |                                                         |
   |  G_Y, AEAD( K_2; ID_CRED_R, Sig(R; CRED_R, G_X, G_Y) )  |
   |&lt;--------------------------------------------------------+
   |                                                         |
   |     AEAD( K_3; ID_CRED_I, Sig(I; CRED_I, G_Y, G_X) )    |
   +--------------------------------------------------------&gt;|
   |                                                         |
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-authenticated-encryption-va" class="selfRef">Authenticated encryption variant of the SIGMA-I protocol.</a>
        </figcaption></figure>
</div>
<p id="section-2-4">The parties exchanging messages are called Initiator (I) and Responder (R). They exchange ephemeral public keys, compute the shared secret, and derive symmetric application keys.<a href="#section-2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-5.1">G_X and G_Y are the ECDH ephemeral public keys of I and R, respectively.<a href="#section-2-5.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-5.2">CRED_I and CRED_R are the credentials containing the public authentication keys of I and R, respectively.<a href="#section-2-5.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-5.3">ID_CRED_I and ID_CRED_R are data enabling the recipient party to retrieve the credential of I and R, respectively.<a href="#section-2-5.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-5.4">Sig(I; . ) and S(R; . ) denote signatures made with the private authentication key of I and R, respectively.<a href="#section-2-5.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-5.5">AEAD(K; . ) denotes authenticated encryption with additional data using a key K derived from the shared secret.<a href="#section-2-5.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-6">In order to create a "full-fledged" protocol some additional protocol elements are needed. EDHOC adds:<a href="#section-2-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-7.1">Explicit connection identifiers C_I, C_R chosen by I and R, respectively, enabling the recipient to find the protocol state.<a href="#section-2-7.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-7.2">Transcript hashes (hashes of message data) TH_2, TH_3, TH_4 used for key derivation and as additional authenticated data.<a href="#section-2-7.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-7.3">Computationally independent keys derived from the ECDH shared secret and used for authenticated encryption of different messages.<a href="#section-2-7.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-7.4">
          <p id="section-2-7.4.1">Verification of a common preferred cipher suite:<a href="#section-2-7.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-7.4.2.1">The Initiator lists supported cipher suites in order of preference<a href="#section-2-7.4.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2-7.4.2.2">The Responder verifies that the selected cipher suite is the first supported cipher suite<a href="#section-2-7.4.2.2" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="section-2-7.5">Method types and error handling.<a href="#section-2-7.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-7.6">Transport of opaque auxiliary data.<a href="#section-2-7.6" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-8">EDHOC is designed to encrypt and integrity protect as much information as possible, and all symmetric keys are derived using as much previous information as possible. EDHOC is furthermore designed to be as compact and lightweight as possible, in terms of message sizes, processing, and the ability to reuse already existing CBOR, COSE, and CoAP libraries.<a href="#section-2-8" class="pilcrow">¶</a></p>
<p id="section-2-9">To simplify for implementors, the use of CBOR in EDHOC is summarized in <a href="#CBORandCOSE" class="xref">Appendix A</a> and test vectors including CBOR diagnostic notation are given in <a href="#vectors" class="xref">Appendix B</a>.<a href="#section-2-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="overview">
<section id="section-3">
      <h2 id="name-edhoc-overview">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-edhoc-overview" class="section-name selfRef">EDHOC Overview</a>
      </h2>
<p id="section-3-1">EDHOC consists of three messages (message_1, message_2, message_3) that maps directly to the three messages in SIGMA-I, plus an EDHOC error message. EDHOC messages are CBOR Sequences <span>[<a href="#RFC8742" class="xref">RFC8742</a>]</span>, where the first data item (METHOD_CORR) of message_1 is an int specifying the method and the correlation properties of the transport used, see <a href="#transport" class="xref">Section 3.1</a>. The method specifies the authentication methods used (signature, static DH), see <a href="#method-types" class="xref">Section 8.2</a>. An implementation may support only Initiator or Responder. An implementation may support only a single method. The Initiator and the Responder need to have agreed on a single method to be used for EDHOC.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">While EDHOC uses the COSE_Key, COSE_Sign1, and COSE_Encrypt0 structures, only a subset of the parameters is included in the EDHOC messages. The unprotected COSE header in COSE_Sign1, and COSE_Encrypt0 (not included in the EDHOC message) MAY contain parameters (e.g. 'alg'). After creating EDHOC message_3, the Initiator can derive symmetric application keys, and application protected data can therefore be sent in parallel with EDHOC message_3. The application may protect data using the algorithms (AEAD, hash, etc.) in the selected cipher suite  and the connection identifiers (C_I, C_R). EDHOC may be used with the media type application/edhoc defined in <a href="#iana" class="xref">Section 8</a>.<a href="#section-3-2" class="pilcrow">¶</a></p>
<span id="name-edhoc-message-flow"></span><div id="fig-flow">
<figure id="figure-3">
        <div class="artwork art-text alignCenter" id="section-3-3.1">
<pre>
Initiator                                             Responder
   |                                                       |
   | ------------------ EDHOC message_1 -----------------&gt; |
   |                                                       |
   | &lt;----------------- EDHOC message_2 ------------------ |
   |                                                       |
   | ------------------ EDHOC message_3 -----------------&gt; |
   |                                                       |
   | &lt;----------- Application Protected Data ------------&gt; |
   |                                                       |
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-edhoc-message-flow" class="selfRef">EDHOC message flow</a>
        </figcaption></figure>
</div>
<div id="transport">
<section id="section-3.1">
        <h3 id="name-transport-and-message-corre">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-transport-and-message-corre" class="section-name selfRef">Transport and Message Correlation</a>
        </h3>
<p id="section-3.1-1">Cryptographically, EDHOC does not put requirements on the lower layers. EDHOC is not bound to a particular transport layer, and can be used in environments without IP. The transport is responsible to handle message loss, reordering, message duplication, fragmentation, and denial of service protection, where necessary. The Initiator and the Responder need to have agreed on a transport to be used for EDHOC. It is recommended to transport EDHOC in CoAP payloads, see <a href="#transfer" class="xref">Section 6</a>.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">EDHOC includes connection identifiers (C_I, C_R) to correlate messages. The connection identifiers C_I and C_R do not have any cryptographic purpose in EDHOC. They contain information facilitating retrieval of the protocol state and may therefore be very short. The connection identifier MAY be used with an application protocol (e.g. OSCORE) for which EDHOC establishes keys, in which case the connection identifiers SHALL adhere to the requirements for that protocol. Each party choses a connection identifier it desires the other party to use in outgoing messages. (For OSCORE this results in the endpoint selecting its Recipient ID, see Section 3.1 of <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>).<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">If the transport provides a mechanism for correlating messages, some of the connection identifiers may be omitted. There are four cases:<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-4.1">corr = 0, the transport does not provide a correlation mechanism.<a href="#section-3.1-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-4.2">corr = 1, the transport provides a correlation mechanism that enables the Responder to correlate message_2 and message_1.<a href="#section-3.1-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-4.3">corr = 2, the transport provides a correlation mechanism that enables the Initiator to correlate message_3 and message_2.<a href="#section-3.1-4.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-4.4">corr = 3, the transport provides a correlation mechanism that enables both parties to correlate all three messages.<a href="#section-3.1-4.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.1-5">For example, if the key exchange is transported over CoAP, the CoAP Token can be used to correlate messages, see <a href="#coap" class="xref">Section 6.1</a>.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="auth-key-id">
<section id="section-3.2">
        <h3 id="name-authentication-keys-and-ide">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-authentication-keys-and-ide" class="section-name selfRef">Authentication Keys and Identities</a>
        </h3>
<p id="section-3.2-1">The EDHOC message exchange may be authenticated using raw public keys (RPK) or public key certificates. The certificates and RPKs can contain signature keys or static Diffie-Hellman keys. In X.509 certificates, signature keys typically have key usage "digitalSignature" and Diffie-Hellman keys typically have key usage "keyAgreement".<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">EDHOC assumes the existence of mechanisms (certification authority, trusted third party, manual distribution, etc.) for specifying and distributing authentication keys and identities. Policies are set based on the identity of the other party, and parties typically only allow connections from a specific identity or a small restricted set of identities. For example, in the case of a device connecting to a network, the network may only allow connections from devices which authenticate with certificates having a particular range of serial numbers in the subject field and signed by a particular CA. On the other side, the device may only be allowed to connect to a network which authenticate with a particular public key (information of which may be provisioned, e.g., out of band or in the Auxiliary Data, see <a href="#AD" class="xref">Section 3.6</a>).<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">The EDHOC implementation must be able to receive and enforce information from the application about what is the intended peer endpoint, and in particular whether it is a specific identity or a set of identities.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-4.1">When a Public Key Infrastructure (PKI) is used, the trust anchor is a Certification Authority (CA) certificate, and the identity is the subject whose unique name (e.g. a domain name, NAI, or EUI) is included in the endpoint's certificate. Before running EDHOC each party needs at least one CA public key certificate, or just the public key, and a specific identity or set of identities it is allowed to communicate with. Only validated public-key certificates with an allowed subject name, as specified by the application, are to be accepted. EDHOC provides proof that the other party possesses the private authentication key corresponding to the public authentication key in its certificate. The certification path provides proof that the subject of the certificate owns the public key in the certificate.<a href="#section-3.2-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-4.2">When public keys are used but not with a PKI (RPK, self-signed certificate), the trust anchor is the public authentication key of the other party. In this case, the identity is typically directly associated to the public authentication key of the other party. For example, the name of the subject may be a canonical representation of the public key. Alternatively, if identities can be expressed in the form of unique subject names assigned to public keys, then a binding to identity can be achieved by including both public key and associated subject name in the protocol message computation: CRED_I or CRED_R may be a self-signed certificate or COSE_Key containing the public authentication key and the subject name, see <a href="#fig-sigma" class="xref">Figure 2</a>. Before running EDHOC, each endpoint needs a specific public authentication key/unique associated subject name, or a set of public authentication keys/unique associated subject names, which it is allowed to communicate with. EDHOC provides proof that the other party possesses the private authentication key corresponding to the public authentication key.<a href="#section-3.2-4.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="identifiers">
<section id="section-3.3">
        <h3 id="name-identifiers">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-identifiers" class="section-name selfRef">Identifiers</a>
        </h3>
<p id="section-3.3-1">One byte connection and credential identifiers are realistic in many scenarios as most constrained devices only have a few keys and connections. In cases where a node only has one connection or key, the identifiers may even be the empty byte string.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cs">
<section id="section-3.4">
        <h3 id="name-cipher-suites">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-cipher-suites" class="section-name selfRef">Cipher Suites</a>
        </h3>
<p id="section-3.4-1">EDHOC cipher suites consist of an ordered set of COSE algorithms: an EDHOC AEAD algorithm, an EDHOC hash algorithm, an EDHOC ECDH curve, an EDHOC signature algorithm, an EDHOC signature algorithm curve, an application AEAD algorithm, and an application hash algorithm from the COSE Algorithms and Elliptic Curves registries. Each cipher suite is identified with a pre-defined int label. This document specifies four pre-defined cipher suites.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4-2">
<pre>
   0. ( 10, -16, 4, -8, 6, 10, -16 )
      (AES-CCM-16-64-128, SHA-256, X25519, EdDSA, Ed25519,
       AES-CCM-16-64-128, SHA-256)

   1. ( 30, -16, 4, -8, 6, 10, -16 )
      (AES-CCM-16-128-128, SHA-256, X25519, EdDSA, Ed25519,
       AES-CCM-16-64-128, SHA-256)

   2. ( 10, -16, 1, -7, 1, 10, -16 )
      (AES-CCM-16-64-128, SHA-256, P-256, ES256, P-256,
       AES-CCM-16-64-128, SHA-256)

   3. ( 30, -16, 1, -7, 1, 10, -16 )
      (AES-CCM-16-128-128, SHA-256, P-256, ES256, P-256,
       AES-CCM-16-64-128, SHA-256)
</pre><a href="#section-3.4-2" class="pilcrow">¶</a>
</div>
<p id="section-3.4-3">The different methods use the same cipher suites, but some algorithms are not used in some methods. The EDHOC signature algorithm and the EDHOC signature algorithm curve are not used is methods without signature authentication.<a href="#section-3.4-3" class="pilcrow">¶</a></p>
<p id="section-3.4-4">The Initiator need to have a list of cipher suites it supports in order of preference. The Responder need to have a list of cipher suites it supports.<a href="#section-3.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="communicationnegotiation-of-protocol-features">
<section id="section-3.5">
        <h3 id="name-communication-negotiation-o">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-communication-negotiation-o" class="section-name selfRef">Communication/Negotiation of Protocol Features</a>
        </h3>
<p id="section-3.5-1">EDHOC allows the communication or negotiation of various protocol features during the execution of the protocol.<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.5-2.1">The Initiator proposes a cipher suite (see <a href="#cs" class="xref">Section 3.4</a>), and the Responder either accepts or rejects, and may make a counter proposal.<a href="#section-3.5-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.5-2.2">The Initiator decides on the correlation parameter corr (see <a href="#transport" class="xref">Section 3.1</a>). This is typically given by the transport which the Initiator and the Responder have agreed on beforehand. The Responder either accepts or rejects.<a href="#section-3.5-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.5-2.3">The Initiator decides on the method parameter, see <a href="#method-types" class="xref">Section 8.2</a>. The Responder either accepts or rejects.<a href="#section-3.5-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.5-2.4">The Initiator and the Responder decide on the representation of the identifier of their respective credentials, ID_CRED_I and ID_CRED_R. The decision is reflected by the label used in the CBOR map, see for example <a href="#id_cred" class="xref">Section 4.2</a>.<a href="#section-3.5-2.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="AD">
<section id="section-3.6">
        <h3 id="name-auxiliary-data">
<a href="#section-3.6" class="section-number selfRef">3.6. </a><a href="#name-auxiliary-data" class="section-name selfRef">Auxiliary Data</a>
        </h3>
<p id="section-3.6-1">In order to reduce round trips and number of messages, and in some cases also streamline processing, certain security applications may be integrated into EDHOC by transporting auxiliary data together with the messages. One example is the transport of third-party authorization information protected outside of EDHOC <span>[<a href="#I-D.selander-ace-ake-authz" class="xref">I-D.selander-ace-ake-authz</a>]</span>. Another example is the embedding of a certificate enrolment request or a newly issued certificate.<a href="#section-3.6-1" class="pilcrow">¶</a></p>
<p id="section-3.6-2">EDHOC allows opaque auxiliary data (AD) to be sent in the EDHOC messages. Unprotected Auxiliary Data (AD_1, AD_2) may be sent in message_1 and message_2, respectively. Protected Auxiliary Data (AD_3) may be sent in message_3.<a href="#section-3.6-2" class="pilcrow">¶</a></p>
<p id="section-3.6-3">Since data carried in AD_1 and AD_2 may not be protected, and the content of AD_3 is available to both the Initiator and the Responder, special considerations need to be made such that the availability of the data a) does not violate security and privacy requirements of the service which uses this data, and b) does not violate the security properties of EDHOC.<a href="#section-3.6-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cose_key">
<section id="section-3.7">
        <h3 id="name-ephemeral-public-keys">
<a href="#section-3.7" class="section-number selfRef">3.7. </a><a href="#name-ephemeral-public-keys" class="section-name selfRef">Ephemeral Public Keys</a>
        </h3>
<p id="section-3.7-1">The ECDH ephemeral public keys are formatted as a COSE_Key of type EC2 or OKP according to Sections 13.1 and 13.2 of <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>, but only the 'x' parameter is included in the EDHOC messages. For Elliptic Curve Keys of type EC2, compact representation as per <span>[<a href="#RFC6090" class="xref">RFC6090</a>]</span> MAY be used also in the COSE_Key. If the COSE implementation requires an 'y' parameter, any of the possible values of the y-coordinate can be used, see Appendix C of <span>[<a href="#RFC6090" class="xref">RFC6090</a>]</span>. COSE <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span> always use compact output for Elliptic Curve Keys of type EC2.<a href="#section-3.7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="key-der">
<section id="section-3.8">
        <h3 id="name-key-derivation">
<a href="#section-3.8" class="section-number selfRef">3.8. </a><a href="#name-key-derivation" class="section-name selfRef">Key Derivation</a>
        </h3>
<p id="section-3.8-1">EDHOC uses HKDF <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span> with the EDHOC hash algorithm in the selected cipher suite to derive keys. HKDF-Extract is used to derive fixed-length uniformly pseudorandom keys (PRK) from ECDH shared secrets. HKDF-Expand is used to derive additional output keying material (OKM) from the PRKs. The PRKs are derived using HKDF-Extract <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span>.<a href="#section-3.8-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.8-2">
<pre>
   PRK = HKDF-Extract( salt, IKM )
</pre><a href="#section-3.8-2" class="pilcrow">¶</a>
</div>
<p id="section-3.8-3">PRK_2e is used to derive key and IV to encrypt message_2. PRK_3e2m is used to derive keys and IVs produce a MAC in message_2 and to encrypt message_3. PRK_4x3m is used to derive keys and IVs produce a MAC in message_3 and to derive application specific data.<a href="#section-3.8-3" class="pilcrow">¶</a></p>
<p id="section-3.8-4">PRK_2e is derived with the following input:<a href="#section-3.8-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.8-5.1">The salt SHALL be the empty byte string. Note that <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span> specifies that if the salt is not provided, it is set to a string of zeros (see Section 2.2 of <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span>). For implementation purposes, not providing the salt is the same as setting the salt to the empty byte string.<a href="#section-3.8-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.8-5.2">The input keying material (IKM) SHALL be the ECDH shared secret G_XY (calculated from G_X and Y or G_Y and X) as defined in Section 12.4.1 of <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>.<a href="#section-3.8-5.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.8-6">Example: Assuming the use of SHA-256 the extract phase of HKDF produces PRK_2e as follows:<a href="#section-3.8-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.8-7">
<pre>
   PRK_2e = HMAC-SHA-256( salt, G_XY )
</pre><a href="#section-3.8-7" class="pilcrow">¶</a>
</div>
<p id="section-3.8-8">where salt = 0x (the empty byte string).<a href="#section-3.8-8" class="pilcrow">¶</a></p>
<p id="section-3.8-9">The pseudorandom keys PRK_3e2m and PRK_4x3m are defined as follow:<a href="#section-3.8-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.8-10.1">If the Reponder authenticates with a static Diffie-Hellman key, then PRK_3e2m = HKDF-Extract( PRK_2e, G_RX ), where G_RX is the ECDH shared secret calculated from G_R and X, or G_X and R, else PRK_3e2m = PRK_2e.<a href="#section-3.8-10.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.8-10.2">If the Initiator authenticates with a static Diffie-Hellman key, then PRK_4x3m = HKDF-Extract( PRK_3e2m, G_IY ), where G_IY is the ECDH shared secret calculated from G_I and Y, or G_Y and I, else PRK_4x3m = PRK_3e2m.<a href="#section-3.8-10.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.8-11">Example: Assuming the use of curve25519, the ECDH shared secrets G_XY, G_RX, and G_IY are the outputs of the X25519 function <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>:<a href="#section-3.8-11" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.8-12">
<pre>
   G_XY = X25519( Y, G_X ) = X25519( X, G_Y )
</pre><a href="#section-3.8-12" class="pilcrow">¶</a>
</div>
<p id="section-3.8-13">The keys and IVs used in EDHOC are derived from PRK using HKDF-Expand <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span> where the EDHOC-KDF is instantiated with the EDHOC AEAD algorithm in the selected cipher suite.<a href="#section-3.8-13" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.8-14">
<pre>
   OKM = EDHOC-KDF( PRK, transcript_hash, label, length )
       = HKDF-Expand( PRK, info, length )
</pre><a href="#section-3.8-14" class="pilcrow">¶</a>
</div>
<p id="section-3.8-15">where info is the CBOR encoding of<a href="#section-3.8-15" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.8-16">
<pre>
info = [
   edhoc_aead_id : int / tstr,
   transcript_hash : bstr,
   label : tstr,
   length : uint
]
</pre><a href="#section-3.8-16" class="pilcrow">¶</a>
</div>
<p id="section-3.8-17">where<a href="#section-3.8-17" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.8-18.1">edhoc_aead_id is an int or tstr containing the algorithm identifier of the EDHOC AEAD algorithm in the selected cipher suite encoded as defined in <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>. Note that a single fixed edhoc_aead_id is used in all invocations of EDHOC-KDF, including the derivation of K_2e and invocations of the EDHOC-Exporter.<a href="#section-3.8-18.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.8-18.2">transcript_hash is a bstr set to one of the transcript hashes TH_2, TH_3, or TH_4 as defined in Sections <a href="#asym-msg2-form" class="xref">4.5.1</a>, <a href="#asym-msg3-form" class="xref">4.6.1</a>, and <a href="#exporter" class="xref">3.8.1</a>.<a href="#section-3.8-18.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.8-18.3">label is a tstr set to the name of the derived key or IV, i.e. "K_2m", "IV_2m", "K_2e", "K_3m", "IV_3m", "K_3ae", or "IV_3ae".<a href="#section-3.8-18.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.8-18.4">length is the length of output keying material (OKM) in bytes<a href="#section-3.8-18.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.8-19">K_2m and IV_2m are derived using the transcript hash TH_2 and the pseudorandom key PRK_3e2m. K_3ae and IV_3ae are derived using the transcript hash TH_3 and the pseudorandom key PRK_3e2m. K_3m and IV_3m are derived using the transcript hash TH_3 and the pseudorandom key PRK_4x3m. IVs are only used if the EDHOC AEAD algorithm uses IVs.<a href="#section-3.8-19" class="pilcrow">¶</a></p>
<div id="exporter">
<section id="section-3.8.1">
          <h4 id="name-edhoc-exporter-interface">
<a href="#section-3.8.1" class="section-number selfRef">3.8.1. </a><a href="#name-edhoc-exporter-interface" class="section-name selfRef">EDHOC-Exporter Interface</a>
          </h4>
<p id="section-3.8.1-1">Application keys and other application specific data can be derived using the EDHOC-Exporter interface defined as:<a href="#section-3.8.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.8.1-2">
<pre>
   EDHOC-Exporter(label, length)
     = EDHOC-KDF(PRK_4x3m, TH_4, label, length)
</pre><a href="#section-3.8.1-2" class="pilcrow">¶</a>
</div>
<p id="section-3.8.1-3">where label is a tstr defined by the application and length is a uint defined by the application. The label SHALL be different for each different exporter value. The transcript hash TH_4 is a CBOR encoded bstr and the input to the hash function is a CBOR Sequence.<a href="#section-3.8.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.8.1-4">
<pre>
   TH_4 = H( TH_3, CIPHERTEXT_3 )
</pre><a href="#section-3.8.1-4" class="pilcrow">¶</a>
</div>
<p id="section-3.8.1-5">where H() is the hash function in the selected cipher suite. Example use of the EDHOC-Exporter is given in Sections <a href="#oscore" class="xref">6.1.1</a>.<a href="#section-3.8.1-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="asym">
<section id="section-4">
      <h2 id="name-edhoc-authenticated-with-as">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-edhoc-authenticated-with-as" class="section-name selfRef">EDHOC Authenticated with Asymmetric Keys</a>
      </h2>
<div id="asym-overview">
<section id="section-4.1">
        <h3 id="name-overview">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
        </h3>
<p id="section-4.1-1">This section specifies authentication method = 0, 1, 2, and 3, see <a href="#method-types" class="xref">Section 8.2</a>. EDHOC supports authentication with signature or static Diffie-Hellman keys in the form of raw public keys (RPK) and public key certificates with the requirements that:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.1">Only the Responder SHALL have access to the Responder's private authentication key,<a href="#section-4.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-2.2">Only the Initiator SHALL have access to the Initiator's private authentication key,<a href="#section-4.1-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-2.3">The Initiator is able to retrieve the Responder's public authentication key using ID_CRED_R,<a href="#section-4.1-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-2.4">The Responder is able to retrieve the Initiator's public authentication key using ID_CRED_I,<a href="#section-4.1-2.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.1-3">where ID_CRED_I and ID_CRED_R are the identifiers of the public authentication keys. Their encoding is specified in <a href="#id_cred" class="xref">Section 4.2</a>.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<span id="name-overview-of-edhoc-with-asym"></span><div id="fig-asym">
<figure id="figure-4">
          <div class="artwork art-text alignCenter" id="section-4.1-4.1">
<pre>
Initiator                                                   Responder
|               METHOD_CORR, SUITES_I, G_X, C_I, AD_1               |
+------------------------------------------------------------------&gt;|
|                             message_1                             |
|                                                                   |
|   C_I, G_Y, C_R, Enc(K_2e; ID_CRED_R, Signature_or_MAC_2, AD_2)   |
|&lt;------------------------------------------------------------------+
|                             message_2                             |
|                                                                   |
|       C_R, AEAD(K_3ae; ID_CRED_I, Signature_or_MAC_3, AD_3)       |
+------------------------------------------------------------------&gt;|
|                             message_3                             |
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-overview-of-edhoc-with-asym" class="selfRef">Overview of EDHOC with asymmetric key authentication.</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="id_cred">
<section id="section-4.2">
        <h3 id="name-encoding-of-public-authenti">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-encoding-of-public-authenti" class="section-name selfRef">Encoding of Public Authentication Key Identifiers</a>
        </h3>
<p id="section-4.2-1">The identifiers ID_CRED_I and ID_CRED_R are COSE header_maps, i.e. CBOR maps containing COSE Common Header Parameters, see Section 3.1 of <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>). ID_CRED_I and ID_CRED_R need to contain parameters that can identify a public authentication key. In the following paragraph we give some examples of possible COSE header parameters used.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">Raw public keys are most optimally stored as COSE_Key objects and identified with a 'kid' parameter:<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-3.1">ID_CRED_x = { 4 : kid_x }, where kid_x : bstr, for x = I or R.<a href="#section-4.2-3.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.2-4">Public key certificates can be identified in different ways. Header parameters for identifying X.509 certificates are defined in <span>[<a href="#I-D.ietf-cose-x509" class="xref">I-D.ietf-cose-x509</a>]</span>, for example:<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-5.1">
            <p id="section-4.2-5.1.1">by a hash value with the 'x5t' parameter;<a href="#section-4.2-5.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-5.1.2.1">ID_CRED_x = { 34 : COSE_CertHash }, for x = I or R,<a href="#section-4.2-5.1.2.1" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-4.2-5.2">
            <p id="section-4.2-5.2.1">by a URL with the 'x5u' parameter;<a href="#section-4.2-5.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-5.2.2.1">ID_CRED_x = { 35 : uri }, for x = I or R,<a href="#section-4.2-5.2.2.1" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
<p id="section-4.2-6">The purpose of ID_CRED_I and ID_CRED_R is to facilitate retrieval of a public authentication key and when they do not contain the actual credential, they may be very short. ID_CRED_I and ID_CRED_R MAY contain the actual credential used for authentication. It is RECOMMENDED that they uniquely identify the public authentication key as the recipient may otherwise have to try several keys. ID_CRED_I and ID_CRED_R are transported in the ciphertext, see <a href="#asym-msg2-proc" class="xref">Section 4.5.2</a> and <a href="#asym-msg3-proc" class="xref">Section 4.6.2</a>.<a href="#section-4.2-6" class="pilcrow">¶</a></p>
<p id="section-4.2-7">The authentication key MUST be a signature key or static Diffie-Hellman key. The Initiator and the Responder
 MAY use different types of authentication keys, e.g. one uses a signature key and the other uses a static Diffie-Hellman key. When using a signature key, the authentication is provided by a signature. When using a static Diffie-Hellman key the authentication is provided by a Message Authentication Code (MAC) computed from an ephemeral-static ECDH shared secret which enables significant reductions in message sizes. The MAC is implemented with an AEAD algorithm. When using a static Diffie-Hellman keys the Initiator's and Responder's private authentication keys are called I and R, respectively, and the public authentication keys are called G_I and G_R, respectively.<a href="#section-4.2-7" class="pilcrow">¶</a></p>
<p id="section-4.2-8">The actual credentials CRED_I and CRED_R are signed or MAC:ed by the Initiator and the Responder respectively, see <a href="#asym-msg3-form" class="xref">Section 4.6.1</a> and <a href="#asym-msg2-form" class="xref">Section 4.5.1</a>. The Initiator and the Responder MAY use different types of credentials, e.g. one uses RPK and the other uses certificate. When the credential is a certificate, CRED_x is end-entity certificate (i.e. not the certificate chain) encoded as a CBOR bstr. When the credential is a COSE_Key, CRED_x is a CBOR map only contains specific fields from the COSE_Key. For COSE_Keys of type OKP the CBOR map SHALL only include the parameters 1 (kty), -1 (crv), and -2 (x-coordinate). For COSE_Keys of type EC2 the CBOR map SHALL only include the parameters 1 (kty), -1 (crv), -2 (x-coordinate), and -3 (y-coordinate). If the parties have agreed on an identity besides the public key, the indentity is included in the CBOR map with the label "subject name", otherwise the subject name is the empty text string. The parameters SHALL be encoded in decreasing order with int labels first and text string labels last. An example of CRED_x when the RPK contains an X25519 static Diffie-Hellman key and the parties have agreed on an EUI-64 identity is shown below:<a href="#section-4.2-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.2-9">
<pre>
CRED_x = {
  1:  1,
 -1:  4,
 -2:  h'b1a3e89460e88d3a8d54211dc95f0b90
        3ff205eb71912d6db8f4af980d2db83a',
 "subject name" : "42-50-31-FF-EF-37-32-39"
}
</pre><a href="#section-4.2-9" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="bstr_id">
<section id="section-4.3">
        <h3 id="name-encoding-of-bstr_identifier">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-encoding-of-bstr_identifier" class="section-name selfRef">Encoding of bstr_identifier</a>
        </h3>
<p id="section-4.3-1">A bstr_identifier is a special encoding for byte strings, used throughout the protocol to encode those short byte strings that can as CBOR ints in the interval -24 to 23, which only require one byte.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">Byte strings of length greater than one are encoded as CBOR byte strings.
Byte strings of length one are encoded as the corresponding integer - 24.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">For example, the byte string h'59e9' encoded as a bstr_identifier is equal to h'59e9', while the byte string h'2a' is encoded as the integer 18.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">The CDDL definition of the bstr_identifier is given below:<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft art-CDDL" id="section-4.3-5">
<pre>
bstr_identifier = bstr / int
</pre><a href="#section-4.3-5" class="pilcrow">¶</a>
</div>
<p id="section-4.3-6">Note that, despite what could be interpreted by the CDDL definition only, bstr_identifier once decoded are always byte strings.<a href="#section-4.3-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="edhoc-message-1">
<section id="section-4.4">
        <h3 id="name-edhoc-message-1">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-edhoc-message-1" class="section-name selfRef">EDHOC Message 1</a>
        </h3>
<div id="asym-msg1-form">
<section id="section-4.4.1">
          <h4 id="name-formatting-of-message-1">
<a href="#section-4.4.1" class="section-number selfRef">4.4.1. </a><a href="#name-formatting-of-message-1" class="section-name selfRef">Formatting of Message 1</a>
          </h4>
<p id="section-4.4.1-1">message_1 SHALL be a CBOR Sequence (see <a href="#CBOR" class="xref">Appendix A.1</a>) as defined below<a href="#section-4.4.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft art-CDDL" id="section-4.4.1-2">
<pre>
message_1 = (
  METHOD_CORR : int,
  SUITES_I : [ selected : suite, supported : 2* suite ] / suite,
  G_X : bstr,
  C_I : bstr_identifier,
  ? AD_1 : bstr,
)

suite = int
</pre><a href="#section-4.4.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.4.1-3">where:<a href="#section-4.4.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1-4.1">METHOD_CORR = 4 * method + corr, where method = 0, 1, 2, or 3 (see <a href="#method-types" class="xref">Section 8.2</a>) and the correlation parameter corr is chosen based on the transport and determines which connection identifiers that are omitted (see <a href="#transport" class="xref">Section 3.1</a>).<a href="#section-4.4.1-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.1-4.2">SUITES_I - cipher suites which the Initiator supports in order of (decreasing) preference. The list of supported cipher suites can be truncated at the end, as is detailed in the processing steps below. One of the supported cipher suites is selected. The selected suite is the first suite in the SUITES_I CBOR array. If a single supported cipher suite is conveyed then that cipher suite is selected and the selected cipher suite is encoded as an int instead of an array.<a href="#section-4.4.1-4.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.1-4.3">G_X - the ephemeral public key of the Initiator<a href="#section-4.4.1-4.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.1-4.4">C_I - variable length connection identifier, encoded as a bstr_identifier (see <a href="#bstr_id" class="xref">Section 4.3</a>).<a href="#section-4.4.1-4.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.1-4.5">AD_1 - bstr containing unprotected opaque auxiliary data<a href="#section-4.4.1-4.5" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="init-proc-msg1">
<section id="section-4.4.2">
          <h4 id="name-initiator-processing-of-mes">
<a href="#section-4.4.2" class="section-number selfRef">4.4.2. </a><a href="#name-initiator-processing-of-mes" class="section-name selfRef">Initiator Processing of Message 1</a>
          </h4>
<p id="section-4.4.2-1">The Initiator SHALL compose message_1 as follows:<a href="#section-4.4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.2-2.1">The supported cipher suites and the order of preference MUST NOT be changed based on previous error messages. However, the list SUITES_I sent to the Responder MAY be truncated such that cipher suites which are the least preferred are omitted. The amount of truncation MAY be changed between sessions, e.g. based on previous error messages (see next bullet), but all cipher suites which are more preferred than the least preferred cipher suite in the list MUST be included in the list.<a href="#section-4.4.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.2-2.2">Determine the cipher suite to use with the Responder in message_1. If the Initiator previously received from the Responder an error message to a message_1 with diagnostic payload identifying a cipher suite that the Initiator supports, then the Initiator SHALL use that cipher suite. Otherwise the first supported (i.e. the most preferred) cipher suite in SUITES_I MUST be used.<a href="#section-4.4.2-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.2-2.3">Generate an ephemeral ECDH key pair as specified in Section 5 of <span>[<a href="#SP-800-56A" class="xref">SP-800-56A</a>]</span> using the curve in the selected cipher suite and format it as a COSE_Key. Let G_X be the 'x' parameter of the COSE_Key.<a href="#section-4.4.2-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.2-2.4">Choose a connection identifier C_I and store it for the length of the protocol.<a href="#section-4.4.2-2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.2-2.5">Encode message_1 as a sequence of CBOR encoded data items as specified in <a href="#asym-msg1-form" class="xref">Section 4.4.1</a><a href="#section-4.4.2-2.5" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="resp-proc-msg1">
<section id="section-4.4.3">
          <h4 id="name-responder-processing-of-mes">
<a href="#section-4.4.3" class="section-number selfRef">4.4.3. </a><a href="#name-responder-processing-of-mes" class="section-name selfRef">Responder Processing of Message 1</a>
          </h4>
<p id="section-4.4.3-1">The Responder SHALL process message_1 as follows:<a href="#section-4.4.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.3-2.1">Decode message_1 (see <a href="#CBOR" class="xref">Appendix A.1</a>).<a href="#section-4.4.3-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.3-2.2">Verify that the selected cipher suite is supported and that no prior cipher suite in SUITES_I is supported.<a href="#section-4.4.3-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.3-2.3">Pass AD_1 to the security application.<a href="#section-4.4.3-2.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.4.3-3">If any verification step fails, the Initiator MUST send an EDHOC error message back, formatted as defined in <a href="#error" class="xref">Section 5</a>, and the protocol MUST be discontinued. If the Responder does not support the selected cipher suite, then SUITES_R MUST include one or more supported cipher suites. If the Responder does not support the selected cipher suite, but supports another cipher suite in SUITES_I, then SUITES_R MUST include the first supported cipher suite in SUITES_I.<a href="#section-4.4.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="edhoc-message-2">
<section id="section-4.5">
        <h3 id="name-edhoc-message-2">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-edhoc-message-2" class="section-name selfRef">EDHOC Message 2</a>
        </h3>
<div id="asym-msg2-form">
<section id="section-4.5.1">
          <h4 id="name-formatting-of-message-2">
<a href="#section-4.5.1" class="section-number selfRef">4.5.1. </a><a href="#name-formatting-of-message-2" class="section-name selfRef">Formatting of Message 2</a>
          </h4>
<p id="section-4.5.1-1">message_2 and data_2 SHALL be CBOR Sequences (see <a href="#CBOR" class="xref">Appendix A.1</a>) as defined below<a href="#section-4.5.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft art-CDDL" id="section-4.5.1-2">
<pre>
message_2 = (
  data_2,
  CIPHERTEXT_2 : bstr,
)
</pre><a href="#section-4.5.1-2" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft art-CDDL" id="section-4.5.1-3">
<pre>
data_2 = (
  ? C_I : bstr_identifier,
  G_Y : bstr,
  C_R : bstr_identifier,
)
</pre><a href="#section-4.5.1-3" class="pilcrow">¶</a>
</div>
<p id="section-4.5.1-4">where:<a href="#section-4.5.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.1-5.1">G_Y - the ephemeral public key of the Responder<a href="#section-4.5.1-5.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.1-5.2">C_R - variable length connection identifier, encoded as a bstr_identifier (see <a href="#bstr_id" class="xref">Section 4.3</a>).<a href="#section-4.5.1-5.2" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="asym-msg2-proc">
<section id="section-4.5.2">
          <h4 id="name-responder-processing-of-mess">
<a href="#section-4.5.2" class="section-number selfRef">4.5.2. </a><a href="#name-responder-processing-of-mess" class="section-name selfRef">Responder Processing of Message 2</a>
          </h4>
<p id="section-4.5.2-1">The Responder SHALL compose message_2 as follows:<a href="#section-4.5.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-2.1">If corr (METHOD_CORR mod 4) equals 1 or 3, C_I is omitted, otherwise C_I is not omitted.<a href="#section-4.5.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.2-2.2">Generate an ephemeral ECDH key pair as specified in Section 5 of <span>[<a href="#SP-800-56A" class="xref">SP-800-56A</a>]</span> using the curve in the selected cipher suite and format it as a COSE_Key. Let G_Y be the 'x' parameter of the COSE_Key.<a href="#section-4.5.2-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.2-2.3">Choose a connection identifier C_R and store it for the length of the protocol.<a href="#section-4.5.2-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.2-2.4">Compute the transcript hash TH_2 = H(message_1, data_2) where H() is the hash function in the selected cipher suite. The transcript hash TH_2 is a CBOR encoded bstr and the input to the hash function is a CBOR Sequence.<a href="#section-4.5.2-2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.2-2.5">
              <p id="section-4.5.2-2.5.1">Compute an inner COSE_Encrypt0 as defined in Section 5.3 of <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>, with the EDHOC AEAD algorithm in the selected cipher suite, K_2m, IV_2m, and the following parameters:<a href="#section-4.5.2-2.5.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-2.5.2.1">
                  <p id="section-4.5.2-2.5.2.1.1">protected =  &lt;&lt; ID_CRED_R &gt;&gt;<a href="#section-4.5.2-2.5.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-2.5.2.1.2.1">ID_CRED_R - identifier to facilitate retrieval of CRED_R, see <a href="#id_cred" class="xref">Section 4.2</a><a href="#section-4.5.2-2.5.2.1.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
                <li class="normal" id="section-4.5.2-2.5.2.2">
                  <p id="section-4.5.2-2.5.2.2.1">external_aad = &lt;&lt; TH_2, CRED_R, ? AD_2 &gt;&gt;<a href="#section-4.5.2-2.5.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-2.5.2.2.2.1">CRED_R - bstr containing the credential of the Responder, see <a href="#id_cred" class="xref">Section 4.2</a>.<a href="#section-4.5.2-2.5.2.2.2.1" class="pilcrow">¶</a>
</li>
                    <li class="normal" id="section-4.5.2-2.5.2.2.2.2">AD_2 = bstr containing opaque unprotected auxiliary data<a href="#section-4.5.2-2.5.2.2.2.2" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
                <li class="normal" id="section-4.5.2-2.5.2.3">plaintext = h''<a href="#section-4.5.2-2.5.2.3" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-4.5.2-2.5.3">
COSE constructs the input to the AEAD <span>[<a href="#RFC5116" class="xref">RFC5116</a>]</span> as follows:<a href="#section-4.5.2-2.5.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-2.5.4.1">Key K = EDHOC-KDF( PRK_3e2m, TH_2, "K_2m", length )<a href="#section-4.5.2-2.5.4.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.5.2-2.5.4.2">Nonce N = EDHOC-KDF( PRK_3e2m, TH_2, "IV_2m", length )<a href="#section-4.5.2-2.5.4.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.5.2-2.5.4.3">Plaintext P = 0x (the empty string)<a href="#section-4.5.2-2.5.4.3" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.5.2-2.5.4.4">
                  <p id="section-4.5.2-2.5.4.4.1">Associated data A =<a href="#section-4.5.2-2.5.4.4.1" class="pilcrow">¶</a></p>
<p id="section-4.5.2-2.5.4.4.2">
[ "Encrypt0", &lt;&lt; ID_CRED_R &gt;&gt;, &lt;&lt; TH_2, CRED_R, ? AD_2 &gt;&gt; ]<a href="#section-4.5.2-2.5.4.4.2" class="pilcrow">¶</a></p>
</li>
              </ul>
<p id="section-4.5.2-2.5.5">
MAC_2 is the 'ciphertext' of the inner COSE_Encrypt0.<a href="#section-4.5.2-2.5.5" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.5.2-2.6">
              <p id="section-4.5.2-2.6.1">If the Reponder authenticates with a static Diffie-Hellman key (method equals 1 or 3), then Signature_or_MAC_2 is MAC_2. If the Reponder authenticates with a signature key (method equals 0 or 2), then Signature_or_MAC_2 is the 'signature' of a COSE_Sign1 object as defined in Section 4.4 of <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span> using the signature algorithm in the selected cipher suite, the private authentication key of the Responder, and the following parameters:<a href="#section-4.5.2-2.6.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-2.6.2.1">protected =  &lt;&lt; ID_CRED_R &gt;&gt;<a href="#section-4.5.2-2.6.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.5.2-2.6.2.2">external_aad = &lt;&lt; TH_2, CRED_R, ? AD_2 &gt;&gt;<a href="#section-4.5.2-2.6.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.5.2-2.6.2.3">payload = MAC_2<a href="#section-4.5.2-2.6.2.3" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-4.5.2-2.6.3">
COSE constructs the input to the Signature Algorithm as:<a href="#section-4.5.2-2.6.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-2.6.4.1">The key is the private authentication key of the Responder.<a href="#section-4.5.2-2.6.4.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.5.2-2.6.4.2">
                  <p id="section-4.5.2-2.6.4.2.1">The message M to be signed =<a href="#section-4.5.2-2.6.4.2.1" class="pilcrow">¶</a></p>
<p id="section-4.5.2-2.6.4.2.2">
[ "Signature1", &lt;&lt; ID_CRED_R &gt;&gt;, &lt;&lt; TH_2, CRED_R, ? AD_2 &gt;&gt;, MAC_2 ]<a href="#section-4.5.2-2.6.4.2.2" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.5.2-2.7">
              <p id="section-4.5.2-2.7.1">CIPHERTEXT_2 is the ciphertext resulting from XOR encrypting a plaintext with the following common parameters:<a href="#section-4.5.2-2.7.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-2.7.2.1">
                  <p id="section-4.5.2-2.7.2.1.1">plaintext = ( ID_CRED_R / bstr_identifier, Signature_or_MAC_2, ? AD_2 )<a href="#section-4.5.2-2.7.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-2.7.2.1.2.1">Note that if ID_CRED_R contains a single 'kid' parameter, i.e., ID_CRED_R = { 4 : kid_R }, only the byte string kid_R is conveyed in the plaintext encoded as a bstr_identifier, see <a href="#id_cred" class="xref">Section 4.2</a> and <a href="#bstr_id" class="xref">Section 4.3</a>.<a href="#section-4.5.2-2.7.2.1.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
                <li class="normal" id="section-4.5.2-2.7.2.2">CIPHERTEXT_2 = plaintext XOR K_2e<a href="#section-4.5.2-2.7.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.5.2-2.7.2.3">K_2e = EDHOC-KDF( PRK_2e, TH_2, "K_2e", length ), where length is the length of the plaintext.<a href="#section-4.5.2-2.7.2.3" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.5.2-2.8">Encode message_2 as a sequence of CBOR encoded data items as specified in <a href="#asym-msg2-form" class="xref">Section 4.5.1</a>.<a href="#section-4.5.2-2.8" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="initiator-processing-of-message-2">
<section id="section-4.5.3">
          <h4 id="name-initiator-processing-of-mess">
<a href="#section-4.5.3" class="section-number selfRef">4.5.3. </a><a href="#name-initiator-processing-of-mess" class="section-name selfRef">Initiator Processing of Message 2</a>
          </h4>
<p id="section-4.5.3-1">The Initiator SHALL process message_2 as follows:<a href="#section-4.5.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.3-2.1">Decode message_2 (see <a href="#CBOR" class="xref">Appendix A.1</a>).<a href="#section-4.5.3-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.3-2.2">Retrieve the protocol state using the connection identifier C_I and/or other external information such as the CoAP Token and the 5-tuple.<a href="#section-4.5.3-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.3-2.3">Decrypt CIPHERTEXT_2. The decryption process depends on the method, see <a href="#asym-msg2-proc" class="xref">Section 4.5.2</a>.<a href="#section-4.5.3-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.3-2.4">Verify that the identity of the Responder is an allowed identity for this connection, see <a href="#auth-key-id" class="xref">Section 3.2</a>.<a href="#section-4.5.3-2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.3-2.5">Verify Signature_or_MAC_2 using the algorithm in the selected cipher suite. The verification process depends on the method, see <a href="#asym-msg2-proc" class="xref">Section 4.5.2</a>.<a href="#section-4.5.3-2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.3-2.6">Pass AD_2 to the security application.<a href="#section-4.5.3-2.6" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.5.3-3">If any verification step fails, the Responder MUST send an EDHOC error message back, formatted as defined in <a href="#error" class="xref">Section 5</a>, and the protocol MUST be discontinued.<a href="#section-4.5.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="edhoc-message-3">
<section id="section-4.6">
        <h3 id="name-edhoc-message-3">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-edhoc-message-3" class="section-name selfRef">EDHOC Message 3</a>
        </h3>
<div id="asym-msg3-form">
<section id="section-4.6.1">
          <h4 id="name-formatting-of-message-3">
<a href="#section-4.6.1" class="section-number selfRef">4.6.1. </a><a href="#name-formatting-of-message-3" class="section-name selfRef">Formatting of Message 3</a>
          </h4>
<p id="section-4.6.1-1">message_3 and data_3 SHALL be CBOR Sequences (see <a href="#CBOR" class="xref">Appendix A.1</a>) as defined below<a href="#section-4.6.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft art-CDDL" id="section-4.6.1-2">
<pre>
message_3 = (
  data_3,
  CIPHERTEXT_3 : bstr,
)
</pre><a href="#section-4.6.1-2" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft art-CDDL" id="section-4.6.1-3">
<pre>
data_3 = (
  ? C_R : bstr_identifier,
)
</pre><a href="#section-4.6.1-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="asym-msg3-proc">
<section id="section-4.6.2">
          <h4 id="name-initiator-processing-of-messa">
<a href="#section-4.6.2" class="section-number selfRef">4.6.2. </a><a href="#name-initiator-processing-of-messa" class="section-name selfRef">Initiator Processing of Message 3</a>
          </h4>
<p id="section-4.6.2-1">The Initiator  SHALL compose message_3 as follows:<a href="#section-4.6.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.2-2.1">If corr (METHOD_CORR mod 4) equals 2 or 3, C_R is omitted, otherwise C_R is not omitted.<a href="#section-4.6.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.6.2-2.2">Compute the transcript hash TH_3 = H(TH_2 , CIPHERTEXT_2, data_3) where H() is the hash function in the the selected cipher suite. The transcript hash TH_3 is a CBOR encoded bstr and the input to the hash function is a CBOR Sequence.<a href="#section-4.6.2-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.6.2-2.3">
              <p id="section-4.6.2-2.3.1">Compute an inner COSE_Encrypt0 as defined in Section 5.3 of <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>, with the EDHOC AEAD algorithm in the selected cipher suite, K_3m, IV_3m, and the following parameters:<a href="#section-4.6.2-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.2-2.3.2.1">
                  <p id="section-4.6.2-2.3.2.1.1">protected =  &lt;&lt; ID_CRED_I &gt;&gt;<a href="#section-4.6.2-2.3.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.2-2.3.2.1.2.1">ID_CRED_I - identifier to facilitate retrieval of CRED_I, see <a href="#id_cred" class="xref">Section 4.2</a><a href="#section-4.6.2-2.3.2.1.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
                <li class="normal" id="section-4.6.2-2.3.2.2">
                  <p id="section-4.6.2-2.3.2.2.1">external_aad = &lt;&lt; TH_3, CRED_I, ? AD_3 &gt;&gt;<a href="#section-4.6.2-2.3.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.2-2.3.2.2.2.1">CRED_I - bstr containing the credential of the Initiator, see <a href="#id_cred" class="xref">Section 4.2</a>.<a href="#section-4.6.2-2.3.2.2.2.1" class="pilcrow">¶</a>
</li>
                    <li class="normal" id="section-4.6.2-2.3.2.2.2.2">AD_3 = bstr containing opaque protected auxiliary data<a href="#section-4.6.2-2.3.2.2.2.2" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
                <li class="normal" id="section-4.6.2-2.3.2.3">plaintext = h''<a href="#section-4.6.2-2.3.2.3" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-4.6.2-2.3.3">
COSE constructs the input to the AEAD <span>[<a href="#RFC5116" class="xref">RFC5116</a>]</span> as follows:<a href="#section-4.6.2-2.3.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.2-2.3.4.1">Key K = EDHOC-KDF( PRK_4x3m, TH_3, "K_3m", length )<a href="#section-4.6.2-2.3.4.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.6.2-2.3.4.2">Nonce N = EDHOC-KDF( PRK_4x3m, TH_3, "IV_3m", length )<a href="#section-4.6.2-2.3.4.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.6.2-2.3.4.3">Plaintext P = 0x (the empty string)<a href="#section-4.6.2-2.3.4.3" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.6.2-2.3.4.4">
                  <p id="section-4.6.2-2.3.4.4.1">Associated data A =<a href="#section-4.6.2-2.3.4.4.1" class="pilcrow">¶</a></p>
<p id="section-4.6.2-2.3.4.4.2">
[ "Encrypt0", &lt;&lt; ID_CRED_I &gt;&gt;, &lt;&lt; TH_3, CRED_I, ? AD_3 &gt;&gt; ]<a href="#section-4.6.2-2.3.4.4.2" class="pilcrow">¶</a></p>
</li>
              </ul>
<p id="section-4.6.2-2.3.5">
MAC_3 is the 'ciphertext' of the inner COSE_Encrypt0.<a href="#section-4.6.2-2.3.5" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.6.2-2.4">
              <p id="section-4.6.2-2.4.1">If the Initiator authenticates with a static Diffie-Hellman key (method equals 2 or 3), then Signature_or_MAC_3 is MAC_3. If the Initiator authenticates with a signature key (method equals 0 or 1), then Signature_or_MAC_3 is the 'signature' of a COSE_Sign1 object as defined in Section 4.4 of <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span> using the signature algorithm in the selected cipher suite, the private authentication key of the Initiator, and the following parameters:<a href="#section-4.6.2-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.2-2.4.2.1">protected =  &lt;&lt; ID_CRED_I &gt;&gt;<a href="#section-4.6.2-2.4.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.6.2-2.4.2.2">external_aad = &lt;&lt; TH_3, CRED_I, ? AD_3 &gt;&gt;<a href="#section-4.6.2-2.4.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.6.2-2.4.2.3">payload = MAC_3<a href="#section-4.6.2-2.4.2.3" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-4.6.2-2.4.3">
COSE constructs the input to the Signature Algorithm as:<a href="#section-4.6.2-2.4.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.2-2.4.4.1">The key is the private authentication key of the Initiator.<a href="#section-4.6.2-2.4.4.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.6.2-2.4.4.2">
                  <p id="section-4.6.2-2.4.4.2.1">The message M to be signed =<a href="#section-4.6.2-2.4.4.2.1" class="pilcrow">¶</a></p>
<p id="section-4.6.2-2.4.4.2.2">
[ "Signature1", &lt;&lt; ID_CRED_I &gt;&gt;, &lt;&lt; TH_3, CRED_I, ? AD_3 &gt;&gt;, MAC_3 ]<a href="#section-4.6.2-2.4.4.2.2" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.6.2-2.5">
              <p id="section-4.6.2-2.5.1">Compute an outer COSE_Encrypt0 as defined in Section 5.3 of <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>, with the EDHOC AEAD algorithm in the selected cipher suite, K_3ae, IV_3ae, and the following parameters. The protected header SHALL be empty.<a href="#section-4.6.2-2.5.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.2-2.5.2.1">external_aad = TH_3<a href="#section-4.6.2-2.5.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.6.2-2.5.2.2">
                  <p id="section-4.6.2-2.5.2.2.1">plaintext = ( ID_CRED_I / bstr_identifier, Signature_or_MAC_3, ? AD_3 )<a href="#section-4.6.2-2.5.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.2-2.5.2.2.2.1">Note that if ID_CRED_I contains a single 'kid' parameter, i.e., ID_CRED_I = { 4 : kid_I }, only the byte string kid_I is conveyed in the plaintext encoded as a bstr_identifier, see <a href="#id_cred" class="xref">Section 4.2</a> and <a href="#bstr_id" class="xref">Section 4.3</a>.<a href="#section-4.6.2-2.5.2.2.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
              </ul>
<p id="section-4.6.2-2.5.3">
COSE constructs the input to the AEAD <span>[<a href="#RFC5116" class="xref">RFC5116</a>]</span> as follows:<a href="#section-4.6.2-2.5.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.2-2.5.4.1">Key K = EDHOC-KDF( PRK_3e2m, TH_3, "K_3ae", length )<a href="#section-4.6.2-2.5.4.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.6.2-2.5.4.2">Nonce N = EDHOC-KDF( PRK_3e2m, TH_3, "IV_3ae", length )<a href="#section-4.6.2-2.5.4.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.6.2-2.5.4.3">Plaintext P = ( ID_CRED_I / bstr_identifier, Signature_or_MAC_3, ? AD_3 )<a href="#section-4.6.2-2.5.4.3" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.6.2-2.5.4.4">Associated data A = [ "Encrypt0", h'', TH_3 ]<a href="#section-4.6.2-2.5.4.4" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-4.6.2-2.5.5">
CIPHERTEXT_3 is the 'ciphertext' of the outer COSE_Encrypt0.<a href="#section-4.6.2-2.5.5" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.6.2-2.6">Encode message_3 as a sequence of CBOR encoded data items as specified in <a href="#asym-msg3-form" class="xref">Section 4.6.1</a>.<a href="#section-4.6.2-2.6" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.6.2-3">Pass the connection identifiers (C_I, C_R) and the application algorithms in the selected cipher suite to the application. The application can now derive application keys using the EDHOC-Exporter interface.<a href="#section-4.6.2-3" class="pilcrow">¶</a></p>
<p id="section-4.6.2-4">After sending message_3, the Initiator is assured that no other party than the Responder can compute the key PRK_4x3m (implicit key authentication). The Initiator does however not know that the Responder has actually computed the key PRK_4x3m. While the Initiator can securely send protected application data, the Initiator SHOULD NOT store the keying material PRK_4x3m and TH_4 until the Initiator is assured that the Responder has actually computed the key PRK_4x3m (explicit key confirmation). Explicit key confirmation is e.g. assured when the Initiator has verified an OSCORE message from the Responder.<a href="#section-4.6.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="responder-processing-of-message-3">
<section id="section-4.6.3">
          <h4 id="name-responder-processing-of-messa">
<a href="#section-4.6.3" class="section-number selfRef">4.6.3. </a><a href="#name-responder-processing-of-messa" class="section-name selfRef">Responder Processing of Message 3</a>
          </h4>
<p id="section-4.6.3-1">The Responder SHALL process message_3 as follows:<a href="#section-4.6.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.3-2.1">Decode message_3 (see <a href="#CBOR" class="xref">Appendix A.1</a>).<a href="#section-4.6.3-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.6.3-2.2">Retrieve the protocol state using the connection identifier C_R and/or other external information such as the CoAP Token and the 5-tuple.<a href="#section-4.6.3-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.6.3-2.3">Decrypt and verify the outer COSE_Encrypt0 as defined in Section 5.3 of <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>, with the EDHOC AEAD algorithm in the selected cipher suite, K_3ae, and IV_3ae.<a href="#section-4.6.3-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.6.3-2.4">Verify that the identity of the Initiator is an allowed identity for this connection, see <a href="#auth-key-id" class="xref">Section 3.2</a>.<a href="#section-4.6.3-2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.6.3-2.5">Verify Signature_or_MAC_3 using the algorithm in the selected cipher suite. The verification process depends on the method, see <a href="#asym-msg3-proc" class="xref">Section 4.6.2</a>.<a href="#section-4.6.3-2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.6.3-2.6">Pass AD_3, the connection identifiers (C_I, C_R), and the application algorithms in the selected cipher suite to the security application. The application can now derive application keys using the EDHOC-Exporter interface.<a href="#section-4.6.3-2.6" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.6.3-3">If any verification step fails, the Responder MUST send an EDHOC error message back, formatted as defined in <a href="#error" class="xref">Section 5</a>, and the protocol MUST be discontinued.<a href="#section-4.6.3-3" class="pilcrow">¶</a></p>
<p id="section-4.6.3-4">After verifying message_3, the Responder is assured that the Initiator has calculated the key PRK_4x3m (explicit key confirmation) and that no other party than the Responder can compute the key. The Responder can securely send protected application data and store the keying material PRK_4x3m and TH_4.<a href="#section-4.6.3-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="error">
<section id="section-5">
      <h2 id="name-error-handling">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-error-handling" class="section-name selfRef">Error Handling</a>
      </h2>
<div id="edhoc-error-message">
<section id="section-5.1">
        <h3 id="name-edhoc-error-message">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-edhoc-error-message" class="section-name selfRef">EDHOC Error Message</a>
        </h3>
<p id="section-5.1-1">This section defines a message format for the EDHOC error message, used during the protocol. An EDHOC error message can be sent by both parties as a reply to any non-error EDHOC message. After sending an error message, the protocol MUST be discontinued. Errors at the EDHOC layer are sent as normal successful messages in the lower layers (e.g. CoAP POST and 2.04 Changed). An advantage of using such a construction is to avoid issues created by usage of cross protocol proxies (e.g. UDP to TCP).<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">error SHALL be a CBOR Sequence (see <a href="#CBOR" class="xref">Appendix A.1</a>) as defined below<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft art-CDDL" id="section-5.1-3">
<pre>
error = (
  ? C_x : bstr_identifier,
  ERR_MSG : tstr,
  ? SUITES_R : [ supported : 2* suite ] / suite,
)
</pre><a href="#section-5.1-3" class="pilcrow">¶</a>
</div>
<p id="section-5.1-4">where:<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-5.1">C_x - variable length connection identifier, encoded as a bstr_identifier (see <a href="#bstr_id" class="xref">Section 4.3</a>). If error is sent by the Responder and corr (METHOD_CORR mod 4) equals 0 or 2 then C_x is set to C_I, else if error is sent by the Initiator and corr (METHOD_CORR mod 4) equals 0 or 1 then C_x is set to C_R, else C_x is omitted.<a href="#section-5.1-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-5.2">ERR_MSG - text string containing the diagnostic payload, defined in the same way as in Section 5.5.2 of <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span>. ERR_MSG MAY be a 0-length text string.<a href="#section-5.1-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-5.3">SUITES_R - cipher suites from SUITES_I or the EDHOC cipher suites registry that the Responder supports. SUITES_R MUST only be included in replies to message_1. If a single supported cipher suite is conveyed then the supported cipher suite is encoded as an int instead of an array.<a href="#section-5.1-5.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.1-6">After receiving SUITES_R, the Initiator can determine which selected cipher suite to use for the next EDHOC run with the Responder. If the Initiator intends to contact the Responder in the future, the Initiator SHOULD remember which selected cipher suite to use until the next message_1 has been sent, otherwise the Initiator and Responder will likely run into an infinite loop. After a successful run of EDHOC, the Initiator MAY remember the selected cipher suite to use in future EDHOC runs. Note that if the Initiator or Responder is updated with new cipher suite policies, any cached information may be outdated.<a href="#section-5.1-6" class="pilcrow">¶</a></p>
<div id="example-use-of-edhoc-error-message-with-suitesr">
<section id="section-5.1.1">
          <h4 id="name-example-use-of-edhoc-error-">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-example-use-of-edhoc-error-" class="section-name selfRef">Example Use of EDHOC Error Message with SUITES_R</a>
          </h4>
<p id="section-5.1.1-1">Assuming that the Initiator supports the five cipher suites 5, 6, 7, 8, and 9 in decreasing order of preference, Figures <a href="#fig-error1" class="xref">5</a> and <a href="#fig-error2" class="xref">6</a> show examples of how the Initiator can truncate SUITES_I and how SUITES_R is used by the Responder to give the Initiator information about the cipher suites that the Responder supports. In <a href="#fig-error1" class="xref">Figure 5</a>, the Responder supports cipher suite 6 but not the selected cipher suite 5.<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<span id="name-example-use-of-error-messag"></span><div id="fig-error1">
<figure id="figure-5">
            <div class="artwork art-text alignCenter" id="section-5.1.1-2.1">
<pre>
Initiator                                                   Responder
|        METHOD_CORR, SUITES_I = [5, 5, 6, 7], G_X, C_I, AD_1       |
+------------------------------------------------------------------&gt;|
|                             message_1                             |
|                                                                   |
|                     C_I, ERR_MSG, SUITES_R = 6                    |
|&lt;------------------------------------------------------------------+
|                               error                               |
|                                                                   |
|         METHOD_CORR, SUITES_I = [6, 5, 6], G_X, C_I, AD_1         |
+------------------------------------------------------------------&gt;|
|                             message_1                             |
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-example-use-of-error-messag" class="selfRef">Example use of error message with SUITES_R.</a>
            </figcaption></figure>
</div>
<p id="section-5.1.1-3">In <a href="#fig-error2" class="xref">Figure 6</a>, the Responder supports cipher suite 7 but not cipher suites 5 and 6.<a href="#section-5.1.1-3" class="pilcrow">¶</a></p>
<span id="name-example-use-of-error-message"></span><div id="fig-error2">
<figure id="figure-6">
            <div class="artwork art-text alignCenter" id="section-5.1.1-4.1">
<pre>
Initiator                                                   Responder
|         METHOD_CORR, SUITES_I = [5, 5, 6], G_X, C_I, AD_1         |
+------------------------------------------------------------------&gt;|
|                             message_1                             |
|                                                                   |
|                  C_I, ERR_MSG, SUITES_R = [7, 9]                  |
|&lt;------------------------------------------------------------------+
|                               error                               |
|                                                                   |
|        METHOD_CORR, SUITES_I = [7, 5, 6, 7], G_X, C_I, AD_1       |
+------------------------------------------------------------------&gt;|
|                             message_1                             |
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-example-use-of-error-message" class="selfRef">Example use of error message with SUITES_R.</a>
            </figcaption></figure>
</div>
<p id="section-5.1.1-5">Note that the Initiator's list of supported cipher suites and order of preference is fixed (see <a href="#asym-msg1-form" class="xref">Section 4.4.1</a> and <a href="#init-proc-msg1" class="xref">Section 4.4.2</a>). Furthermore, the Responder shall only accept message_1 if the selected cipher suite is the first cipher suite in SUITES_I that the Responder supports (see <a href="#resp-proc-msg1" class="xref">Section 4.4.3</a>). Following this procedure ensures that the selected cipher suite is the most preferred (by the Initiator) cipher suite supported by both parties. If the selected cipher suite is not the first cipher suite which the Responder supports in SUITES_I, then Responder will discontinue the protocol. If SUITES_I in message_1 is manipulated then the integrity verification of message_2 containing the transcript hash TH_2 = H( message_1, data_2 ) will fail and the Initiator will discontinue the protocol.<a href="#section-5.1.1-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="transfer">
<section id="section-6">
      <h2 id="name-transferring-edhoc-and-deri">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-transferring-edhoc-and-deri" class="section-name selfRef">Transferring EDHOC and Deriving an OSCORE Context</a>
      </h2>
<div id="coap">
<section id="section-6.1">
        <h3 id="name-transferring-edhoc-in-coap">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-transferring-edhoc-in-coap" class="section-name selfRef">Transferring EDHOC in CoAP</a>
        </h3>
<p id="section-6.1-1">It is recommended to transport EDHOC as an exchange of CoAP <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> messages. CoAP is a reliable transport that can preserve packet ordering and handle message duplication. CoAP can also perform fragmentation and protect against denial of service attacks. It is recommended to carry the EDHOC messages in Confirmable messages, especially if fragmentation is used.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">By default, the CoAP client is the Initiator and the CoAP server is the Responder, but the roles SHOULD be chosen to protect the most sensitive identity, see <a href="#security" class="xref">Section 7</a>. By default, EDHOC is transferred in POST requests and 2.04 (Changed) responses to the Uri-Path: "/.well-known/edhoc", but an application may define its own path that can be discovered e.g. using resource directory <span>[<a href="#I-D.ietf-core-resource-directory" class="xref">I-D.ietf-core-resource-directory</a>]</span>.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">By default, the message flow is as follows: EDHOC message_1 is sent in the payload of a POST request from the client to the server's resource for EDHOC. EDHOC message_2 or the EDHOC error message is sent from the server to the client in the payload of a 2.04 (Changed) response. EDHOC message_3 or the EDHOC error message is sent from the client to the server's resource in the payload of a POST request. If needed, an EDHOC error message is sent from the server to the client in the payload of a 2.04 (Changed) response.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4">An example of a successful EDHOC exchange using CoAP is shown in <a href="#fig-coap1" class="xref">Figure 7</a>. In this case the CoAP Token enables the Initiator to correlate message_1 and message_2 so the correlation parameter corr = 1.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<span id="name-transferring-edhoc-in-coap-"></span><div id="fig-coap1">
<figure id="figure-7">
          <div class="artwork art-text alignCenter" id="section-6.1-5.1">
<pre>
Client    Server
  |          |
  +---------&gt;| Header: POST (Code=0.02)
  |   POST   | Uri-Path: "/.well-known/edhoc"
  |          | Content-Format: application/edhoc
  |          | Payload: EDHOC message_1
  |          |
  |&lt;---------+ Header: 2.04 Changed
  |   2.04   | Content-Format: application/edhoc
  |          | Payload: EDHOC message_2
  |          |
  +---------&gt;| Header: POST (Code=0.02)
  |   POST   | Uri-Path: "/.well-known/edhoc"
  |          | Content-Format: application/edhoc
  |          | Payload: EDHOC message_3
  |          |
  |&lt;---------+ Header: 2.04 Changed
  |   2.04   |
  |          |
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-transferring-edhoc-in-coap-" class="selfRef">Transferring EDHOC in CoAP when the Initiator is CoAP Client</a>
          </figcaption></figure>
</div>
<p id="section-6.1-6">The exchange in <a href="#fig-coap1" class="xref">Figure 7</a> protects the client identity against active attackers and the server identity against passive attackers. An alternative exchange that protects the server identity against active attackers and the client identity against passive attackers is shown in <a href="#fig-coap2" class="xref">Figure 8</a>. In this case the CoAP Token enables the Responder to correlate message_2 and message_3 so the correlation parameter corr = 2.<a href="#section-6.1-6" class="pilcrow">¶</a></p>
<span id="name-transferring-edhoc-in-coap-w"></span><div id="fig-coap2">
<figure id="figure-8">
          <div class="artwork art-text alignCenter" id="section-6.1-7.1">
<pre>
Client    Server
  |          |
  +---------&gt;| Header: POST (Code=0.02)
  |   POST   | Uri-Path: "/.well-known/edhoc"
  |          |
  |&lt;---------+ Header: 2.04 Changed
  |   2.04   | Content-Format: application/edhoc
  |          | Payload: EDHOC message_1
  |          |
  +---------&gt;| Header: POST (Code=0.02)
  |   POST   | Uri-Path: "/.well-known/edhoc"
  |          | Content-Format: application/edhoc
  |          | Payload: EDHOC message_2
  |          |
  |&lt;---------+ Header: 2.04 Changed
  |   2.04   | Content-Format: application/edhoc
  |          | Payload: EDHOC message_3
  |          |
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-transferring-edhoc-in-coap-w" class="selfRef">Transferring EDHOC in CoAP when the Initiator is CoAP Server</a>
          </figcaption></figure>
</div>
<p id="section-6.1-8">To protect against denial-of-service attacks, the CoAP server MAY respond to the first POST request with a 4.01 (Unauthorized) containing an Echo option <span>[<a href="#I-D.ietf-core-echo-request-tag" class="xref">I-D.ietf-core-echo-request-tag</a>]</span>. This forces the initiator to demonstrate its reachability at its apparent network address. If message fragmentation is needed, the EDHOC messages may be fragmented using the CoAP Block-Wise Transfer mechanism <span>[<a href="#RFC7959" class="xref">RFC7959</a>]</span>.<a href="#section-6.1-8" class="pilcrow">¶</a></p>
<div id="oscore">
<section id="section-6.1.1">
          <h4 id="name-deriving-an-oscore-context-">
<a href="#section-6.1.1" class="section-number selfRef">6.1.1. </a><a href="#name-deriving-an-oscore-context-" class="section-name selfRef">Deriving an OSCORE Context from EDHOC</a>
          </h4>
<p id="section-6.1.1-1">When EDHOC is used to derive parameters for OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>, the parties  make sure that the EDHOC connection identifiers are unique, i.e. C_R MUST NOT be equal to C_I. The CoAP client and server MUST be able to retrieve the OSCORE protocol state using its chosen connection identifier and optionally other information such as the 5-tuple. In case that the CoAP client is the Initiator and the CoAP server is the Responder:<a href="#section-6.1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.1-2.1">The client's OSCORE Sender ID is C_R and the server's OSCORE Sender ID is C_I, as defined in this document<a href="#section-6.1.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.1.1-2.2">The AEAD Algorithm and the hash algorithm are the application AEAD and hash algorithms in the selected cipher suite.<a href="#section-6.1.1-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.1.1-2.3">The Master Secret and Master Salt are derived as follows where length is the key length (in bytes) of the application AEAD Algorithm.<a href="#section-6.1.1-2.3" class="pilcrow">¶</a>
</li>
          </ul>
<div class="artwork art-text alignLeft" id="section-6.1.1-3">
<pre>
   Master Secret = EDHOC-Exporter( "OSCORE Master Secret", length )
   Master Salt   = EDHOC-Exporter( "OSCORE Master Salt", 8 )
</pre><a href="#section-6.1.1-3" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="security">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="sec-prop">
<section id="section-7.1">
        <h3 id="name-security-properties">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-security-properties" class="section-name selfRef">Security Properties</a>
        </h3>
<p id="section-7.1-1">EDHOC inherits its security properties from the theoretical SIGMA-I protocol <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span>. Using the terminology from <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span>, EDHOC provides perfect forward secrecy, mutual authentication with aliveness, consistency, peer awareness. As described in <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span>, peer awareness is provided to the Responder, but not to the Initiator.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">EDHOC protects the credential identifier of the Initiator against active attacks and the credential identifier of the Responder against passive attacks. The roles should be assigned to protect the most sensitive identity/identifier, typically that which is not possible to infer from routing information in the lower layers.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1-3">Compared to <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span>, EDHOC adds an explicit method type and expands the message authentication coverage to additional elements such as algorithms, auxiliary data, and previous messages. This protects against an attacker replaying messages or injecting messages from another session.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
<p id="section-7.1-4">EDHOC also adds negotiation of connection identifiers and downgrade protected negotiation of cryptographic parameters, i.e. an attacker cannot affect the negotiated parameters. A single session of EDHOC does not include negotiation of cipher suites, but it enables the Responder to verify that the selected cipher suite is the most preferred cipher suite by the Initiator which is supported by both the Initiator and the Responder.<a href="#section-7.1-4" class="pilcrow">¶</a></p>
<p id="section-7.1-5">As required by <span>[<a href="#RFC7258" class="xref">RFC7258</a>]</span>, IETF protocols need to mitigate pervasive monitoring when possible. One way to mitigate pervasive monitoring is to use a key exchange that provides perfect forward secrecy. EDHOC therefore only supports methods with perfect forward secrecy. To limit the effect of breaches, it is important to limit the use of symmetrical group keys for bootstrapping. EDHOC therefore strives to make the additional cost of using raw public keys and self-signed certificates as small as possible. Raw public keys and self-signed certificates are not a replacement for a public key infrastructure, but SHOULD be used instead of symmetrical group keys for bootstrapping.<a href="#section-7.1-5" class="pilcrow">¶</a></p>
<p id="section-7.1-6">Compromise of the long-term keys (private signature or static DH keys) does not compromise the security of completed EDHOC exchanges. Compromising the private authentication keys of one party lets an active attacker impersonate that compromised party in EDHOC exchanges with other parties, but does not let the attacker impersonate other parties in EDHOC exchanges with the compromised party. Compromise of the long-term keys does not enable a passive attacker to compromise future session keys. Compromise of the HDKF input parameters (ECDH shared secret) leads to compromise of all session keys derived from that compromised shared secret. Compromise of one session key does not compromise other session keys.<a href="#section-7.1-6" class="pilcrow">¶</a></p>
<p id="section-7.1-7">If supported by the device, it is RECOMMENDED that at least the long-term private keys is stored in a Trusted Execution Environment (TEE) and that sensitive operations using these keys are performed inside the TEE. To achieve even higher security additional operation such as ephemeral key generation, all computations of shared secrets, and storage of the PRK keys can be done inside the TEE. Optimally, the whole EDHOC protocol can be implemented inside the TEE. Typically an adversary with physical access to a device can be assumed to gain access to all information outside of the TEE, but none of the information inside the TEE.<a href="#section-7.1-7" class="pilcrow">¶</a></p>
<p id="section-7.1-8">Key compromise impersonation (KCI): In EDHOC authenticated with signature keys, EDHOC provides KCI protection against an attacker having access to the long term key or the ephemeral secret key. With static Diffie-Hellman key authentication, KCI protection would be provided against an attacker having access to the long-term Diffie-Hellman key, but not to an attacker having access to the ephemeral secret key. Note that the term KCI has typically been used for compromise of long-term keys, and that an attacker with access to the ephemeral secret key can only attack that specific protocol run.<a href="#section-7.1-8" class="pilcrow">¶</a></p>
<p id="section-7.1-9">Repudiation: In EDHOC authenticated with signature keys, the Initiator could theoretically prove that the Responder performed a run of the protocol by presenting the private ephemeral key, and vice versa. Note that storing the private ephemeral keys violates the protocol requirements. With static Diffie-Hellman key authentication, both parties can always deny having participated in the protocol.<a href="#section-7.1-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cryptographic-considerations">
<section id="section-7.2">
        <h3 id="name-cryptographic-consideration">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-cryptographic-consideration" class="section-name selfRef">Cryptographic Considerations</a>
        </h3>
<p id="section-7.2-1">The security of the SIGMA protocol requires the MAC to be bound to the identity of the signer. Hence the message authenticating functionality of the authenticated encryption in EDHOC is critical: authenticated encryption MUST NOT be replaced by plain encryption only, even if authentication is provided at another level or through a different mechanism. EDHOC implements SIGMA-I using the same Sign-then-MAC approach as TLS 1.3.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">To reduce message overhead EDHOC does not use explicit nonces and instead rely on the ephemeral public keys to provide randomness to each session. A good amount of randomness is important for the key generation, to provide liveness, and to protect against interleaving attacks. For this reason, the ephemeral keys MUST NOT be reused, and both parties SHALL generate fresh random ephemeral key pairs.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
<p id="section-7.2-3">The choice of key length used in the different algorithms needs to be harmonized, so that a sufficient security level is maintained for certificates, EDHOC, and the protection of application data. The Initiator and the Responder should enforce a minimum security level.<a href="#section-7.2-3" class="pilcrow">¶</a></p>
<p id="section-7.2-4">The data rates in many IoT deployments are very limited. Given that the application keys are protected as well as the long-term authentication keys they can often be used for years or even decades before the cryptographic limits are reached. If the application keys established through EDHOC need to be renewed, the communicating parties can derive application keys with other labels or run EDHOC again.<a href="#section-7.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cipher-suites">
<section id="section-7.3">
        <h3 id="name-cipher-suites-2">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-cipher-suites-2" class="section-name selfRef">Cipher Suites</a>
        </h3>
<p id="section-7.3-1">Cipher suite number 0 (AES-CCM-16-64-128, SHA-256, X25519, EdDSA, Ed25519, AES-CCM-16-64-128, SHA-256) is mandatory to implement. Implementations only need to implement the algorithms needed for their supported methods. For many constrained IoT devices it is problematic to support more than one cipher suites, so some deployments with P-256 may not support the mandatory cipher suite. This is not a problem for local deployments.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<p id="section-7.3-2">The HMAC algorithm HMAC 256/64 (HMAC w/ SHA-256 truncated to 64 bits) SHALL NOT be supported for use in EDHOC.<a href="#section-7.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="unprotected-data">
<section id="section-7.4">
        <h3 id="name-unprotected-data">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-unprotected-data" class="section-name selfRef">Unprotected Data</a>
        </h3>
<p id="section-7.4-1">The Initiator and the Responder must make sure that unprotected data and metadata do not reveal any sensitive information. This also applies for encrypted data sent to an unauthenticated party. In particular, it applies to AD_1, ID_CRED_R, AD_2, and ERR_MSG. Using the same AD_1 in several EDHOC sessions allows passive eavesdroppers to correlate the different sessions. Another consideration is that the list of supported cipher suites may potentially be used to identify the application.<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<p id="section-7.4-2">The Initiator and the Responder must also make sure that unauthenticated data does not trigger any harmful actions. In particular, this applies to AD_1 and ERR_MSG.<a href="#section-7.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="denial-of-service">
<section id="section-7.5">
        <h3 id="name-denial-of-service">
<a href="#section-7.5" class="section-number selfRef">7.5. </a><a href="#name-denial-of-service" class="section-name selfRef">Denial-of-Service</a>
        </h3>
<p id="section-7.5-1">EDHOC itself does not provide countermeasures against Denial-of-Service attacks. By sending a number of new or replayed message_1 an attacker may cause the Responder to allocate state, perform cryptographic operations, and amplify messages. To mitigate such attacks, an implementation SHOULD rely on lower layer mechanisms such as the Echo option in CoAP <span>[<a href="#I-D.ietf-core-echo-request-tag" class="xref">I-D.ietf-core-echo-request-tag</a>]</span> that forces the initiator to demonstrate reachability at its apparent network address.<a href="#section-7.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="implementation-considerations">
<section id="section-7.6">
        <h3 id="name-implementation-consideratio">
<a href="#section-7.6" class="section-number selfRef">7.6. </a><a href="#name-implementation-consideratio" class="section-name selfRef">Implementation Considerations</a>
        </h3>
<p id="section-7.6-1">The availability of a secure pseudorandom number generator and truly random seeds are essential for the security of EDHOC. If no true random number generator is available, a truly random seed must be provided from an external source. As each pseudorandom number must only be used once, an implementation need to get a new truly random seed after reboot, or continuously store state in nonvolatile memory, see (<span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>, Appendix B.1.1) for issues and solution approaches for writing to nonvolatile memory. If ECDSA is supported, "deterministic ECDSA" as specified in <span>[<a href="#RFC6979" class="xref">RFC6979</a>]</span> is RECOMMENDED.<a href="#section-7.6-1" class="pilcrow">¶</a></p>
<p id="section-7.6-2">The referenced processing instructions in <span>[<a href="#SP-800-56A" class="xref">SP-800-56A</a>]</span> must be complied with, including deleting the intermediate computed values along with any ephemeral ECDH secrets after the key derivation is completed. The ECDH shared secret, keys, and IVs MUST be secret. Implementations should provide countermeasures to side-channel attacks such as timing attacks. Depending on the selected curve, the parties should perform various validations of each other's public keys, see e.g. Section 5 of <span>[<a href="#SP-800-56A" class="xref">SP-800-56A</a>]</span>.<a href="#section-7.6-2" class="pilcrow">¶</a></p>
<p id="section-7.6-3">The Initiator and the Responder are responsible for verifying the integrity of certificates. The selection of trusted CAs should be done very carefully and certificate revocation should be supported. The private authentication keys MUST be kept secret.<a href="#section-7.6-3" class="pilcrow">¶</a></p>
<p id="section-7.6-4">The Initiator and the Responder are allowed to select the connection identifiers C_I and C_R, respectively, for the other party to use in the ongoing EDHOC protocol as well as in a subsequent application protocol (e.g. OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>). The choice of connection identifier is not security critical in EDHOC but intended to simplify the retrieval of the right security context in combination with using short identifiers. If the wrong connection identifier of the other party is used in a protocol message it will result in the receiving party not being able to retrieve a security context (which will terminate the protocol) or retrieve the wrong security context (which also terminates the protocol as the message cannot be verified).<a href="#section-7.6-4" class="pilcrow">¶</a></p>
<p id="section-7.6-5">The Responder MUST finish the verification step of message_3 before passing AD_3 to the application.<a href="#section-7.6-5" class="pilcrow">¶</a></p>
<p id="section-7.6-6">If two nodes unintentionally initiate two simultaneous EDHOC message exchanges with each other even if they only want to complete a single EDHOC message exchange, they MAY terminate the exchange with the lexicographically smallest G_X. If the two G_X values are equal, the received message_1 MUST be discarded to mitigate reflection attacks. Note that in the case of two simultaneous EDHOC exchanges where the nodes only complete one and where the nodes have different preferred cipher suites, an attacker can affect which of the two nodes' preferred cipher suites will be used by blocking the other exchange.<a href="#section-7.6-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="other-documents-referencing-edhoc">
<section id="section-7.7">
        <h3 id="name-other-documents-referencing">
<a href="#section-7.7" class="section-number selfRef">7.7. </a><a href="#name-other-documents-referencing" class="section-name selfRef">Other Documents Referencing EDHOC</a>
        </h3>
<p id="section-7.7-1">EDHOC has been analyzed in several other documents. A formal verification of EDHOC was done in <span>[<a href="#SSR18" class="xref">SSR18</a>]</span>, an analysis of EDHOC for certificate enrollment was done in <span>[<a href="#Kron18" class="xref">Kron18</a>]</span>, the use of EDHOC in LoRaWAN is analyzed in <span>[<a href="#LoRa1" class="xref">LoRa1</a>]</span> and <span>[<a href="#LoRa2" class="xref">LoRa2</a>]</span>, the use of EDHOC in IoT bootstrapping is analyzed in <span>[<a href="#Perez18" class="xref">Perez18</a>]</span>, and the use of EDHOC in 6TiSCH is described in <span>[<a href="#I-D.ietf-6tisch-dtsecurity-zerotouch-join" class="xref">I-D.ietf-6tisch-dtsecurity-zerotouch-join</a>]</span>.<a href="#section-7.7-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="edhoc-cipher-suites-registry">
<section id="section-8.1">
        <h3 id="name-edhoc-cipher-suites-registr">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-edhoc-cipher-suites-registr" class="section-name selfRef">EDHOC Cipher Suites Registry</a>
        </h3>
<p id="section-8.1-1">IANA has created a new registry titled "EDHOC Cipher Suites" under the new heading "EDHOC". The registration procedure is "Expert Review". The columns of the registry are Value, Array, Description, and Reference, where Value is an integer and the other columns are text strings. The initial contents of the registry are:<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.1-2">
<pre>
Value: -24
Algorithms: N/A
Desc: Reserved for Private Use
Reference: [[this document]]
</pre><a href="#section-8.1-2" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-8.1-3">
<pre>
Value: -23
Algorithms: N/A
Desc: Reserved for Private Use
Reference: [[this document]]
</pre><a href="#section-8.1-3" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-8.1-4">
<pre>
Value: 0
Array: 10, 5, 4, -8, 6, 10, 5
Desc: AES-CCM-16-64-128, SHA-256, X25519, EdDSA, Ed25519,
      AES-CCM-16-64-128, SHA-256
Reference: [[this document]]
</pre><a href="#section-8.1-4" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-8.1-5">
<pre>
Value: 1
Array: 30, 5, 4, -8, 6, 10, 5
Desc: AES-CCM-16-128-128, SHA-256, X25519, EdDSA, Ed25519,
      AES-CCM-16-64-128, SHA-256
Reference: [[this document]]
</pre><a href="#section-8.1-5" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-8.1-6">
<pre>
Value: 2
Array: 10, 5, 1, -7, 1, 10, 5
Desc: AES-CCM-16-64-128, SHA-256, P-256, ES256, P-256,
      AES-CCM-16-64-128, SHA-256
Reference: [[this document]]
</pre><a href="#section-8.1-6" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-8.1-7">
<pre>
Value: 3
Array: 30, 5, 1, -7, 1, 10, 5
Desc: AES-CCM-16-128-128, SHA-256, P-256, ES256, P-256,
      AES-CCM-16-64-128, SHA-256
Reference: [[this document]]
</pre><a href="#section-8.1-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="method-types">
<section id="section-8.2">
        <h3 id="name-edhoc-method-type-registry">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-edhoc-method-type-registry" class="section-name selfRef">EDHOC Method Type Registry</a>
        </h3>
<p id="section-8.2-1">IANA has created a new registry titled "EDHOC Method Type" under the new heading "EDHOC". The registration procedure is "Expert Review". The columns of the registry are Value, Description, and Reference, where Value is an integer and the other columns are text strings. The initial contents of the registry are:<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<span id="name-method-types"></span><div id="fig-method-types">
<figure id="figure-9">
          <div class="artwork art-text alignCenter" id="section-8.2-2.1">
<pre>
+-------+-------------------+-------------------+-------------------+
| Value | Initiator         | Responder         | Reference         |
+-------+-------------------+-------------------+-------------------+
|     0 | Signature Key     | Signature Key     | [[this document]] |
|     1 | Signature Key     | Static DH Key     | [[this document]] |
|     2 | Static DH Key     | Signature Key     | [[this document]] |
|     3 | Static DH Key     | Static DH Key     | [[this document]] |
+-------+-------------------+-------------------+-------------------+
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-method-types" class="selfRef">Method Types</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="the-well-known-uri-registry">
<section id="section-8.3">
        <h3 id="name-the-well-known-uri-registry">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-the-well-known-uri-registry" class="section-name selfRef">The Well-Known URI Registry</a>
        </h3>
<p id="section-8.3-1">IANA has added the well-known URI 'edhoc' to the Well-Known URIs registry.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.3-2.1">URI suffix: edhoc<a href="#section-8.3-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.3-2.2">Change controller: IETF<a href="#section-8.3-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.3-2.3">Specification document(s): [[this document]]<a href="#section-8.3-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.3-2.4">Related information: None<a href="#section-8.3-2.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="media-types-registry">
<section id="section-8.4">
        <h3 id="name-media-types-registry">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-media-types-registry" class="section-name selfRef">Media Types Registry</a>
        </h3>
<p id="section-8.4-1">IANA has added the media type 'application/edhoc' to the Media Types registry.<a href="#section-8.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.4-2.1">Type name: application<a href="#section-8.4-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.4-2.2">Subtype name: edhoc<a href="#section-8.4-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.4-2.3">Required parameters: N/A<a href="#section-8.4-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.4-2.4">Optional parameters: N/A<a href="#section-8.4-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.4-2.5">Encoding considerations: binary<a href="#section-8.4-2.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.4-2.6">Security considerations: See Section 7 of this document.<a href="#section-8.4-2.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.4-2.7">Interoperability considerations: N/A<a href="#section-8.4-2.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.4-2.8">Published specification: [[this document]] (this document)<a href="#section-8.4-2.8" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.4-2.9">Applications that use this media type: To be identified<a href="#section-8.4-2.9" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.4-2.10">Fragment identifier considerations: N/A<a href="#section-8.4-2.10" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.4-2.11">
            <p id="section-8.4-2.11.1">Additional information:<a href="#section-8.4-2.11.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.4-2.11.2.1">Magic number(s): N/A<a href="#section-8.4-2.11.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-8.4-2.11.2.2">File extension(s): N/A<a href="#section-8.4-2.11.2.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-8.4-2.11.2.3">Macintosh file type code(s): N/A<a href="#section-8.4-2.11.2.3" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-8.4-2.12">Person &amp; email address to contact for further information: See "Authors' Addresses" section.<a href="#section-8.4-2.12" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.4-2.13">Intended usage: COMMON<a href="#section-8.4-2.13" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.4-2.14">Restrictions on usage: N/A<a href="#section-8.4-2.14" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.4-2.15">Author: See "Authors' Addresses" section.<a href="#section-8.4-2.15" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.4-2.16">Change Controller: IESG<a href="#section-8.4-2.16" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="coap-content-formats-registry">
<section id="section-8.5">
        <h3 id="name-coap-content-formats-regist">
<a href="#section-8.5" class="section-number selfRef">8.5. </a><a href="#name-coap-content-formats-regist" class="section-name selfRef">CoAP Content-Formats Registry</a>
        </h3>
<p id="section-8.5-1">IANA has added the media type 'application/edhoc' to the CoAP Content-Formats registry.<a href="#section-8.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.5-2.1">Media Type: application/edhoc<a href="#section-8.5-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.5-2.2">Encoding:<a href="#section-8.5-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.5-2.3">ID: TBD42<a href="#section-8.5-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.5-2.4">Reference: [[this document]]<a href="#section-8.5-2.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="expert-review-instructions">
<section id="section-8.6">
        <h3 id="name-expert-review-instructions">
<a href="#section-8.6" class="section-number selfRef">8.6. </a><a href="#name-expert-review-instructions" class="section-name selfRef">Expert Review Instructions</a>
        </h3>
<p id="section-8.6-1">The IANA Registries established in this document is defined as "Expert Review". This section gives some general guidelines for what the experts should be looking for, but they are being designated as experts for a reason so they should be given substantial latitude.<a href="#section-8.6-1" class="pilcrow">¶</a></p>
<p id="section-8.6-2">Expert reviewers should take into consideration the following points:<a href="#section-8.6-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.6-3.1">Clarity and correctness of registrations. Experts are expected to check the clarity of purpose and use of the requested entries. Expert needs to make sure the values of algorithms are taken from the right registry, when that's required. Expert should consider requesting an opinion on the correctness of registered parameters from relevant IETF working groups. Encodings that do not meet these objective of clarity and completeness should not be registered.<a href="#section-8.6-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.6-3.2">Experts should take into account the expected usage of fields when approving point assignment. The length of the encoded value should be weighed against how many code points of that length are left, the size of device it will be used on, and the number of code points left that encode to that size.<a href="#section-8.6-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.6-3.3">Specifications are recommended. When specifications are not provided, the description provided needs to have sufficient information to verify the points above.<a href="#section-8.6-3.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-core-echo-request-tag">[I-D.ietf-core-echo-request-tag]</dt>
        <dd>
<span class="refAuthor">Amsuess, C.</span><span class="refAuthor">, Mattsson, J.</span><span class="refAuthor">, and G. Selander</span>, <span class="refTitle">"CoAP: Echo, Request-Tag, and Token Processing"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-echo-request-tag-11</span>, <time datetime="2020-11-02" class="refDate">2 November 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-core-echo-request-tag-11.txt">http://www.ietf.org/internet-drafts/draft-ietf-core-echo-request-tag-11.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-cose-x509">[I-D.ietf-cose-x509]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Header parameters for carrying and referencing X.509 certificates"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cose-x509-07</span>, <time datetime="2020-09-17" class="refDate">17 September 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-cose-x509-07.txt">http://www.ietf.org/internet-drafts/draft-ietf-cose-x509-07.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-lake-reqs">[I-D.ietf-lake-reqs]</dt>
        <dd>
<span class="refAuthor">Vucinic, M.</span><span class="refAuthor">, Selander, G.</span><span class="refAuthor">, Mattsson, J.</span><span class="refAuthor">, and D. Garcia-Carillo</span>, <span class="refTitle">"Requirements for a Lightweight AKE for OSCORE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lake-reqs-04</span>, <time datetime="2020-06-08" class="refDate">8 June 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lake-reqs-04.txt">http://www.ietf.org/internet-drafts/draft-ietf-lake-reqs-04.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5116">[RFC5116]</dt>
        <dd>
<span class="refAuthor">McGrew, D.</span>, <span class="refTitle">"An Interface and Algorithms for Authenticated Encryption"</span>, <span class="seriesInfo">RFC 5116</span>, <span class="seriesInfo">DOI 10.17487/RFC5116</span>, <time datetime="2008-01" class="refDate">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5116">https://www.rfc-editor.org/info/rfc5116</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5869">[RFC5869]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span><span class="refAuthor"> and P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5869">https://www.rfc-editor.org/info/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6090">[RFC6090]</dt>
        <dd>
<span class="refAuthor">McGrew, D.</span><span class="refAuthor">, Igoe, K.</span><span class="refAuthor">, and M. Salter</span>, <span class="refTitle">"Fundamental Elliptic Curve Cryptography Algorithms"</span>, <span class="seriesInfo">RFC 6090</span>, <span class="seriesInfo">DOI 10.17487/RFC6090</span>, <time datetime="2011-02" class="refDate">February 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6090">https://www.rfc-editor.org/info/rfc6090</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6979">[RFC6979]</dt>
        <dd>
<span class="refAuthor">Pornin, T.</span>, <span class="refTitle">"Deterministic Usage of the Digital Signature Algorithm (DSA) and Elliptic Curve Digital Signature Algorithm (ECDSA)"</span>, <span class="seriesInfo">RFC 6979</span>, <span class="seriesInfo">DOI 10.17487/RFC6979</span>, <time datetime="2013-08" class="refDate">August 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6979">https://www.rfc-editor.org/info/rfc6979</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7049">[RFC7049]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span><span class="refAuthor"> and P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">RFC 7049</span>, <span class="seriesInfo">DOI 10.17487/RFC7049</span>, <time datetime="2013-10" class="refDate">October 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7049">https://www.rfc-editor.org/info/rfc7049</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span><span class="refAuthor">, Hartke, K.</span><span class="refAuthor">, and C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7252">https://www.rfc-editor.org/info/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7748">[RFC7748]</dt>
        <dd>
<span class="refAuthor">Langley, A.</span><span class="refAuthor">, Hamburg, M.</span><span class="refAuthor">, and S. Turner</span>, <span class="refTitle">"Elliptic Curves for Security"</span>, <span class="seriesInfo">RFC 7748</span>, <span class="seriesInfo">DOI 10.17487/RFC7748</span>, <time datetime="2016-01" class="refDate">January 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7748">https://www.rfc-editor.org/info/rfc7748</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7959">[RFC7959]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span><span class="refAuthor"> and Z. Shelby, Ed.</span>, <span class="refTitle">"Block-Wise Transfers in the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7959</span>, <span class="seriesInfo">DOI 10.17487/RFC7959</span>, <time datetime="2016-08" class="refDate">August 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7959">https://www.rfc-editor.org/info/rfc7959</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8152">[RFC8152]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE)"</span>, <span class="seriesInfo">RFC 8152</span>, <span class="seriesInfo">DOI 10.17487/RFC8152</span>, <time datetime="2017-07" class="refDate">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8152">https://www.rfc-editor.org/info/rfc8152</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8376">[RFC8376]</dt>
        <dd>
<span class="refAuthor">Farrell, S., Ed.</span>, <span class="refTitle">"Low-Power Wide Area Network (LPWAN) Overview"</span>, <span class="seriesInfo">RFC 8376</span>, <span class="seriesInfo">DOI 10.17487/RFC8376</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8376">https://www.rfc-editor.org/info/rfc8376</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span><span class="refAuthor">, Vigano, C.</span><span class="refAuthor">, and C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8610">https://www.rfc-editor.org/info/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8613">[RFC8613]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span><span class="refAuthor">, Mattsson, J.</span><span class="refAuthor">, Palombini, F.</span><span class="refAuthor">, and L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time datetime="2019-07" class="refDate">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8613">https://www.rfc-editor.org/info/rfc8613</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8742">[RFC8742]</dt>
      <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR) Sequences"</span>, <span class="seriesInfo">RFC 8742</span>, <span class="seriesInfo">DOI 10.17487/RFC8742</span>, <time datetime="2020-02" class="refDate">February 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8742">https://www.rfc-editor.org/info/rfc8742</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="CborMe">[CborMe]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refTitle">"CBOR Playground"</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="http://cbor.me/">http://cbor.me/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-6tisch-dtsecurity-zerotouch-join">[I-D.ietf-6tisch-dtsecurity-zerotouch-join]</dt>
        <dd>
<span class="refAuthor">Richardson, M.</span>, <span class="refTitle">"6tisch Zero-Touch Secure Join protocol"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-6tisch-dtsecurity-zerotouch-join-04</span>, <time datetime="2019-07-08" class="refDate">8 July 2019</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-6tisch-dtsecurity-zerotouch-join-04.txt">http://www.ietf.org/internet-drafts/draft-ietf-6tisch-dtsecurity-zerotouch-join-04.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-oauth-authz">[I-D.ietf-ace-oauth-authz]</dt>
        <dd>
<span class="refAuthor">Seitz, L.</span><span class="refAuthor">, Selander, G.</span><span class="refAuthor">, Wahlstroem, E.</span><span class="refAuthor">, Erdtman, S.</span><span class="refAuthor">, and H. Tschofenig</span>, <span class="refTitle">"Authentication and Authorization for Constrained Environments (ACE) using the OAuth 2.0 Framework (ACE-OAuth)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-oauth-authz-35</span>, <time datetime="2020-06-24" class="refDate">24 June 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-ace-oauth-authz-35.txt">http://www.ietf.org/internet-drafts/draft-ietf-ace-oauth-authz-35.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-resource-directory">[I-D.ietf-core-resource-directory]</dt>
        <dd>
<span class="refAuthor">Amsuess, C.</span><span class="refAuthor">, Shelby, Z.</span><span class="refAuthor">, Koster, M.</span><span class="refAuthor">, Bormann, C.</span><span class="refAuthor">, and P. Stok</span>, <span class="refTitle">"CoRE Resource Directory"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-resource-directory-26</span>, <time datetime="2020-11-02" class="refDate">2 November 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-core-resource-directory-26.txt">http://www.ietf.org/internet-drafts/draft-ietf-core-resource-directory-26.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-lwig-security-protocol-comparison">[I-D.ietf-lwig-security-protocol-comparison]</dt>
        <dd>
<span class="refAuthor">Mattsson, J.</span><span class="refAuthor">, Palombini, F.</span><span class="refAuthor">, and M. Vucinic</span>, <span class="refTitle">"Comparison of CoAP Security Protocols"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lwig-security-protocol-comparison-05</span>, <time datetime="2020-11-02" class="refDate">2 November 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lwig-security-protocol-comparison-05.txt">http://www.ietf.org/internet-drafts/draft-ietf-lwig-security-protocol-comparison-05.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-tls-dtls13">[I-D.ietf-tls-dtls13]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span><span class="refAuthor">, Tschofenig, H.</span><span class="refAuthor">, and N. Modadugu</span>, <span class="refTitle">"The Datagram Transport Layer Security (DTLS) Protocol Version 1.3"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-dtls13-39</span>, <time datetime="2020-11-02" class="refDate">2 November 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-tls-dtls13-39.txt">http://www.ietf.org/internet-drafts/draft-ietf-tls-dtls13-39.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.selander-ace-ake-authz">[I-D.selander-ace-ake-authz]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span><span class="refAuthor">, Mattsson, J.</span><span class="refAuthor">, Vucinic, M.</span><span class="refAuthor">, Richardson, M.</span><span class="refAuthor">, and A. Schellenbaum</span>, <span class="refTitle">"Lightweight Authorization for Authenticated Key Exchange."</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-selander-ace-ake-authz-02</span>, <time datetime="2020-11-02" class="refDate">2 November 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-selander-ace-ake-authz-02.txt">http://www.ietf.org/internet-drafts/draft-selander-ace-ake-authz-02.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Kron18">[Kron18]</dt>
        <dd>
<span class="refAuthor">Krontiris, A.</span>, <span class="refTitle">"Evaluation of Certificate Enrollment over Application Layer Security"</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.nada.kth.se/~ann/exjobb/alexandros_krontiris.pdf">https://www.nada.kth.se/~ann/exjobb/alexandros_krontiris.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="LoRa1">[LoRa1]</dt>
        <dd>
<span class="refAuthor">Sanchez-Iborra, R.</span><span class="refAuthor">, Sánchez-Gómez, J.</span><span class="refAuthor">, Pérez, S.</span><span class="refAuthor">, Fernández, P.J.</span><span class="refAuthor">, Santa, J.</span><span class="refAuthor">, Hernández-Ramos, J.L.</span><span class="refAuthor">, and A.F. Skarmeta</span>, <span class="refTitle">"Enhancing LoRaWAN Security through a Lightweight and Authenticated Key Management Approach"</span>, <time datetime="2018-06" class="refDate">June 2018</time>, <span>&lt;<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6021899/pdf/sensors-18-01833.pdf">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6021899/pdf/sensors-18-01833.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="LoRa2">[LoRa2]</dt>
        <dd>
<span class="refAuthor">Sanchez-Iborra, R.</span><span class="refAuthor">, Sánchez-Gómez, J.</span><span class="refAuthor">, Pérez, S.</span><span class="refAuthor">, Fernández, P.J.</span><span class="refAuthor">, Santa, J.</span><span class="refAuthor">, Hernández-Ramos, J.L.</span><span class="refAuthor">, and A.F. Skarmeta</span>, <span class="refTitle">"Internet Access for LoRaWAN Devices Considering Security Issues"</span>, <time datetime="2018-06" class="refDate">June 2018</time>, <span>&lt;<a href="https://ants.inf.um.es/~josesanta/doc/GIoTS1.pdf">https://ants.inf.um.es/~josesanta/doc/GIoTS1.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Perez18">[Perez18]</dt>
        <dd>
<span class="refAuthor">Pérez, S.</span><span class="refAuthor">, Garcia-Carrillo, D.</span><span class="refAuthor">, Marín-López, R.</span><span class="refAuthor">, Hernández-Ramos, J.</span><span class="refAuthor">, Marín-Pérez, R.</span><span class="refAuthor">, and A. Skarmeta</span>, <span class="refTitle">"Architecture of security association establishment based on bootstrapping technologies for enabling critical IoT K"</span>, <time datetime="2018-10" class="refDate">October 2018</time>, <span>&lt;<a href="http://www.anastacia-h2020.eu/publications/Architecture_of_security_association_establishment_based_on_bootstrapping_technologies_for_enabling_critical_IoT_infrastructures.pdf">http://www.anastacia-h2020.eu/publications/Architecture_of_security_association_establishment_based_on_bootstrapping_technologies_for_enabling_critical_IoT_infrastructures.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7228">[RFC7228]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span><span class="refAuthor">, Ersue, M.</span><span class="refAuthor">, and A. Keranen</span>, <span class="refTitle">"Terminology for Constrained-Node Networks"</span>, <span class="seriesInfo">RFC 7228</span>, <span class="seriesInfo">DOI 10.17487/RFC7228</span>, <time datetime="2014-05" class="refDate">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7228">https://www.rfc-editor.org/info/rfc7228</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7258">[RFC7258]</dt>
        <dd>
<span class="refAuthor">Farrell, S.</span><span class="refAuthor"> and H. Tschofenig</span>, <span class="refTitle">"Pervasive Monitoring Is an Attack"</span>, <span class="seriesInfo">BCP 188</span>, <span class="seriesInfo">RFC 7258</span>, <span class="seriesInfo">DOI 10.17487/RFC7258</span>, <time datetime="2014-05" class="refDate">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7258">https://www.rfc-editor.org/info/rfc7258</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7296">[RFC7296]</dt>
        <dd>
<span class="refAuthor">Kaufman, C.</span><span class="refAuthor">, Hoffman, P.</span><span class="refAuthor">, Nir, Y.</span><span class="refAuthor">, Eronen, P.</span><span class="refAuthor">, and T. Kivinen</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">STD 79</span>, <span class="seriesInfo">RFC 7296</span>, <span class="seriesInfo">DOI 10.17487/RFC7296</span>, <time datetime="2014-10" class="refDate">October 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7296">https://www.rfc-editor.org/info/rfc7296</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SIGMA">[SIGMA]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span>, <span class="refTitle">"SIGMA - The 'SIGn-and-MAc' Approach to Authenticated Diffie-Hellman and Its Use in the IKE-Protocols (Long version)"</span>, <time datetime="2003-06" class="refDate">June 2003</time>, <span>&lt;<a href="http://webee.technion.ac.il/~hugo/sigma-pdf.pdf">http://webee.technion.ac.il/~hugo/sigma-pdf.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SP-800-56A">[SP-800-56A]</dt>
        <dd>
<span class="refAuthor">Barker, E.</span><span class="refAuthor">, Chen, L.</span><span class="refAuthor">, Roginsky, A.</span><span class="refAuthor">, Vassilev, A.</span><span class="refAuthor">, and R. Davis</span>, <span class="refTitle">"Recommendation for Pair-Wise Key-Establishment Schemes Using Discrete Logarithm Cryptography"</span>, <span class="seriesInfo">NIST Special Publication 800-56A Revision 3</span>, <time datetime="2018-04" class="refDate">April 2018</time>, <span>&lt;<a href="https://doi.org/10.6028/NIST.SP.800-56Ar3">https://doi.org/10.6028/NIST.SP.800-56Ar3</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SSR18">[SSR18]</dt>
      <dd>
<span class="refAuthor">Bruni, A.</span><span class="refAuthor">, Sahl Jørgensen, T.</span><span class="refAuthor">, Grønbech Petersen, T.</span><span class="refAuthor">, and C. Schürmann</span>, <span class="refTitle">"Formal Verification of Ephemeral Diffie-Hellman Over COSE (EDHOC)"</span>, <time datetime="2018-11" class="refDate">November 2018</time>, <span>&lt;<a href="https://www.springerprofessional.de/en/formal-verification-of-ephemeral-diffie-hellman-over-cose-edhoc/16284348">https://www.springerprofessional.de/en/formal-verification-of-ephemeral-diffie-hellman-over-cose-edhoc/16284348</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="CBORandCOSE">
<section id="section-appendix.a">
      <h2 id="name-use-of-cbor-cddl-and-cose-i">
<a href="#section-appendix.a" class="section-number selfRef">Appendix A. </a><a href="#name-use-of-cbor-cddl-and-cose-i" class="section-name selfRef">Use of CBOR, CDDL and COSE in EDHOC</a>
      </h2>
<p id="section-appendix.a-1">This Appendix is intended to simplify for implementors not familiar with CBOR <span>[<a href="#RFC7049" class="xref">RFC7049</a>]</span>, CDDL <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span>, COSE <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>, and HKDF <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span>.<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
<div id="CBOR">
<section id="section-a.1">
        <h2 id="name-cbor-and-cddl">
<a href="#section-a.1" class="section-number selfRef">A.1. </a><a href="#name-cbor-and-cddl" class="section-name selfRef">CBOR and CDDL</a>
        </h2>
<p id="section-a.1-1">The Concise Binary Object Representation (CBOR) <span>[<a href="#RFC7049" class="xref">RFC7049</a>]</span> is a data format designed for small code size and small message size. CBOR builds on the JSON data model but extends it by e.g. encoding binary data directly without base64 conversion. In addition to the binary CBOR encoding, CBOR also has a diagnostic notation that is readable and editable by humans. The Concise Data Definition Language (CDDL) <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span> provides a way to express structures for protocol messages and APIs that use CBOR. <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span> also extends the diagnostic notation.<a href="#section-a.1-1" class="pilcrow">¶</a></p>
<p id="section-a.1-2">CBOR data items are encoded to or decoded from byte strings using a type-length-value encoding scheme, where the three highest order bits of the initial byte contain information about the major type. CBOR supports several different types of data items, in addition to integers (int, uint), simple values (e.g. null), byte strings (bstr), and text strings (tstr), CBOR also supports arrays []  of data items, maps {} of pairs of data items, and sequences <span>[<a href="#RFC8742" class="xref">RFC8742</a>]</span> of data items. Some examples are given below. For a complete specification and more examples, see <span>[<a href="#RFC7049" class="xref">RFC7049</a>]</span> and <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span>. We recommend implementors to get used to CBOR by using the CBOR playground <span>[<a href="#CborMe" class="xref">CborMe</a>]</span>.<a href="#section-a.1-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignCenter" id="section-a.1-3">
<pre>
Diagnostic          Encoded              Type
------------------------------------------------------------------
1                   0x01                 unsigned integer
24                  0x1818               unsigned integer
-24                 0x37                 negative integer
-25                 0x3818               negative integer
null                0xf6                 simple value
h'12cd'             0x4212cd             byte string
'12cd'              0x4431326364         byte string
"12cd"              0x6431326364         text string
{ 4 : h'cd' }       0xa10441cd           map
&lt;&lt; 1, 2, null &gt;&gt;    0x430102f6           byte string
[ 1, 2, null ]      0x830102f6           array
( 1, 2, null )      0x0102f6             sequence
1, 2, null          0x0102f6             sequence
------------------------------------------------------------------
</pre><a href="#section-a.1-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="COSE">
<section id="section-a.2">
        <h2 id="name-cose">
<a href="#section-a.2" class="section-number selfRef">A.2. </a><a href="#name-cose" class="section-name selfRef">COSE</a>
        </h2>
<p id="section-a.2-1">CBOR Object Signing and Encryption (COSE) <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span> describes how to create and process signatures, message authentication codes, and encryption using CBOR. COSE builds on JOSE, but is adapted to allow more efficient processing in constrained devices. EDHOC makes use of COSE_Key, COSE_Encrypt0, and COSE_Sign1 objects.<a href="#section-a.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="vectors">
<section id="section-appendix.b">
      <h2 id="name-test-vectors">
<a href="#section-appendix.b" class="section-number selfRef">Appendix B. </a><a href="#name-test-vectors" class="section-name selfRef">Test Vectors</a>
      </h2>
<p id="section-appendix.b-1">This appendix provides detailed test vectors to ease implementation and ensure interoperability. In addition to hexadecimal, all CBOR data items and sequences are given in CBOR diagnostic notation. The test vectors use the default mapping to CoAP where the Initiator acts as CoAP client (this means that corr = 1).<a href="#section-appendix.b-1" class="pilcrow">¶</a></p>
<p id="section-appendix.b-2">A more extensive test vector suite covering more combinations of authentication method used between Initiator and Responder and related code to generate them can be found at https://github.com/EricssonResearch/EDHOC/tree/master/Test%20Vectors .<a href="#section-appendix.b-2" class="pilcrow">¶</a></p>
<div id="test-vectors-for-edhoc-authenticated-with-signature-keys-x5t">
<section id="section-b.1">
        <h2 id="name-test-vectors-for-edhoc-auth">
<a href="#section-b.1" class="section-number selfRef">B.1. </a><a href="#name-test-vectors-for-edhoc-auth" class="section-name selfRef">Test Vectors for EDHOC Authenticated with Signature Keys (x5t)</a>
        </h2>
<p id="section-b.1-1">EDHOC with signature authentication and X.509 certificates is used. In this test vector, the hash value 'x5t' is used to identify the certificate.<a href="#section-b.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1-2">
<pre>
method (Signature Authentication)
0
</pre><a href="#section-b.1-2" class="pilcrow">¶</a>
</div>
<p id="section-b.1-3">CoAP is used as transport and the Initiator acts as CoAP client:<a href="#section-b.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1-4">
<pre>
corr (the Initiator can correlate message_1 and message_2)
1
</pre><a href="#section-b.1-4" class="pilcrow">¶</a>
</div>
<p id="section-b.1-5">From there, METHOD_CORR has the following value:<a href="#section-b.1-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1-6">
<pre>
METHOD_CORR (4 * method + corr) (int)
1
</pre><a href="#section-b.1-6" class="pilcrow">¶</a>
</div>
<p id="section-b.1-7">No unprotected opaque auxiliary data is sent in the message exchanges.<a href="#section-b.1-7" class="pilcrow">¶</a></p>
<p id="section-b.1-8">The list of supported cipher suites of the Initiator in order of preference is the following:<a href="#section-b.1-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1-9">
<pre>
Supported Cipher Suites (4 bytes)
00 01 02 03
</pre><a href="#section-b.1-9" class="pilcrow">¶</a>
</div>
<p id="section-b.1-10">The cipher suite selected by the Initiator is the most preferred:<a href="#section-b.1-10" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1-11">
<pre>
Selected Cipher Suite (int)
0
</pre><a href="#section-b.1-11" class="pilcrow">¶</a>
</div>
<p id="section-b.1-12">The mandatory-to-implement cipher suite 0 is supported by both the Initiator and the Responder, see <a href="#cipher-suites" class="xref">Section 7.3</a>.<a href="#section-b.1-12" class="pilcrow">¶</a></p>
<div id="message1">
<section id="section-b.1.1">
          <h3 id="name-message_1">
<a href="#section-b.1.1" class="section-number selfRef">B.1.1. </a><a href="#name-message_1" class="section-name selfRef">Message_1</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-b.1.1-1">
<pre>
X (Initiator's ephemeral private key) (32 bytes)
8f 78 1a 09 53 72 f8 5b 6d 9f 61 09 ae 42 26 11 73 4d 7d bf a0 06 9a 2d
f2 93 5b b2 e0 53 bf 35
</pre><a href="#section-b.1.1-1" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.1.1-2">
<pre>
G_X (Initiator's ephemeral public key) (32 bytes)
89 8f f7 9a 02 06 7a 16 ea 1e cc b9 0f a5 22 46 f5 aa 4d d6 ec 07 6b ba
02 59 d9 04 b7 ec 8b 0c
</pre><a href="#section-b.1.1-2" class="pilcrow">¶</a>
</div>
<p id="section-b.1.1-3">The Initiator chooses a connection identifier C_I:<a href="#section-b.1.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.1-4">
<pre>
Connection identifier chosen by Initiator (0 bytes)

</pre><a href="#section-b.1.1-4" class="pilcrow">¶</a>
</div>
<p id="section-b.1.1-5">Since no unprotected opaque auxiliary data is sent in the message exchanges:<a href="#section-b.1.1-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.1-6">
<pre>
AD_1 (0 bytes)
</pre><a href="#section-b.1.1-6" class="pilcrow">¶</a>
</div>
<p id="section-b.1.1-7">Since the list of supported cipher suites needs to contain the selected cipher suite, the initiator truncates the list of supported cipher suites to one cipher suite only, 00.<a href="#section-b.1.1-7" class="pilcrow">¶</a></p>
<p id="section-b.1.1-8">Because one single selected cipher suite is conveyed, it is encoded as an int instead of an array:<a href="#section-b.1.1-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.1-9">
<pre>
SUITES_I (int)
0
</pre><a href="#section-b.1.1-9" class="pilcrow">¶</a>
</div>
<p id="section-b.1.1-10">With SUITES_I = 0, message_1 is constructed, as the CBOR Sequence of the CBOR data items above.<a href="#section-b.1.1-10" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.1-11">
<pre>
message_1 =
(
  1,
  0,
  h'898ff79a02067a16ea1eccb90fa52246f5aa4dd6ec076bba0259d904b7ec8b0c',
  h''
)
</pre><a href="#section-b.1.1-11" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.1.1-12">
<pre>
message_1 (CBOR Sequence) (37 bytes)
01 00 58 20 89 8f f7 9a 02 06 7a 16 ea 1e cc b9 0f a5 22 46 f5 aa 4d d6
ec 07 6b ba 02 59 d9 04 b7 ec 8b 0c 40
</pre><a href="#section-b.1.1-12" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="message2">
<section id="section-b.1.2">
          <h3 id="name-message_2">
<a href="#section-b.1.2" class="section-number selfRef">B.1.2. </a><a href="#name-message_2" class="section-name selfRef">Message_2</a>
          </h3>
<p id="section-b.1.2-1">Since METHOD_CORR mod 4 equals 1, C_I is omitted from data_2.<a href="#section-b.1.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-2">
<pre>
Y (Responder's ephemeral private key) (32 bytes)
fd 8c d8 77 c9 ea 38 6e 6a f3 4f f7 e6 06 c4 b6 4c a8 31 c8 ba 33 13 4f
d4 cd 71 67 ca ba ec da
</pre><a href="#section-b.1.2-2" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.1.2-3">
<pre>
G_Y (Responder's ephemeral public key) (32 bytes)
71 a3 d5 99 c2 1d a1 89 02 a1 ae a8 10 b2 b6 38 2c cd 8d 5f 9b f0 19 52
81 75 4c 5e bc af 30 1e
</pre><a href="#section-b.1.2-3" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-4">From G_X and Y or from G_Y and X the ECDH shared secret is computed:<a href="#section-b.1.2-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-5">
<pre>
G_XY (ECDH shared secret) (32 bytes)
2b b7 fa 6e 13 5b c3 35 d0 22 d6 34 cb fb 14 b3 f5 82 f3 e2 e3 af b2 b3
15 04 91 49 5c 61 78 2b
</pre><a href="#section-b.1.2-5" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-6">The key and nonce for calculating the ciphertext are calculated as follows, as specified in <a href="#key-der" class="xref">Section 3.8</a>.<a href="#section-b.1.2-6" class="pilcrow">¶</a></p>
<p id="section-b.1.2-7">HKDF SHA-256 is the HKDF used (as defined by cipher suite 0).<a href="#section-b.1.2-7" class="pilcrow">¶</a></p>
<p id="section-b.1.2-8">PRK_2e = HMAC-SHA-256(salt, G_XY)<a href="#section-b.1.2-8" class="pilcrow">¶</a></p>
<p id="section-b.1.2-9">Salt is the empty byte string.<a href="#section-b.1.2-9" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-10">
<pre>
salt (0 bytes)
</pre><a href="#section-b.1.2-10" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-11">From there, PRK_2e is computed:<a href="#section-b.1.2-11" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-12">
<pre>
PRK_2e (32 bytes)
ec 62 92 a0 67 f1 37 fc 7f 59 62 9d 22 6f bf c4 e0 68 89 49 f6 62 a9 7f
d8 2f be b7 99 71 39 4a
</pre><a href="#section-b.1.2-12" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.1.2-13">
<pre>
SK_R (Responders's private authentication key) (32 bytes)
df 69 27 4d 71 32 96 e2 46 30 63 65 37 2b 46 83 ce d5 38 1b fc ad cd 44
0a 24 c3 91 d2 fe db 94
</pre><a href="#section-b.1.2-13" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-14">Since neither the Initiator nor the Responder authenticates with a static Diffie-Hellman key, PRK_3e2m = PRK_2e<a href="#section-b.1.2-14" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-15">
<pre>
PRK_3e2m (32 bytes)
ec 62 92 a0 67 f1 37 fc 7f 59 62 9d 22 6f bf c4 e0 68 89 49 f6 62 a9 7f
d8 2f be b7 99 71 39 4a
</pre><a href="#section-b.1.2-15" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-16">The Responder chooses a connection identifier C_R.<a href="#section-b.1.2-16" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-17">
<pre>
Connection identifier chosen by Responder (1 byte)
2b
</pre><a href="#section-b.1.2-17" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-18">Note that since C_R is a byte string of length one, it is encoded as the corresponding integer subtracted by 24 (see bstr_identifier in <a href="#bstr_id" class="xref">Section 4.3</a>). Thus 0x2b = 43, 43 - 24 = 19, and 19 in CBOR encoding is equal to 0x13.<a href="#section-b.1.2-18" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-19">
<pre>
C_R (1 byte)
13
</pre><a href="#section-b.1.2-19" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-20">Data_2 is constructed, as the CBOR Sequence of G_Y and C_R.<a href="#section-b.1.2-20" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-21">
<pre>
data_2 =
(
  h'71a3d599c21da18902a1aea810b2b6382ccd8d5f9bf0195281754c5ebcaf301e',
  h'13'
)
</pre><a href="#section-b.1.2-21" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.1.2-22">
<pre>
data_2 (CBOR Sequence) (35 bytes)
58 20 71 a3 d5 99 c2 1d a1 89 02 a1 ae a8 10 b2 b6 38 2c cd 8d 5f 9b f0
19 52 81 75 4c 5e bc af 30 1e 13
</pre><a href="#section-b.1.2-22" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-23">From data_2 and message_1, compute the input to the transcript hash TH_2 = H( message_1, data_2 ), as a CBOR Sequence of these 2 data items.<a href="#section-b.1.2-23" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-24">
<pre>
Input to calculate TH_2 (CBOR Sequence) (72 bytes)
01 00 58 20 89 8f f7 9a 02 06 7a 16 ea 1e cc b9 0f a5 22 46 f5 aa 4d d6
ec 07 6b ba 02 59 d9 04 b7 ec 8b 0c 40 58 20 71 a3 d5 99 c2 1d a1 89 02
a1 ae a8 10 b2 b6 38 2c cd 8d 5f 9b f0 19 52 81 75 4c 5e bc af 30 1e 13
</pre><a href="#section-b.1.2-24" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-25">And from there, compute the transcript hash TH_2 = SHA-256( message_1, data_2 )<a href="#section-b.1.2-25" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-26">
<pre>
TH_2 (32 bytes)
b0 dc 6c 1b a0 ba e6 e2 88 86 10 fa 0b 27 bf c5 2e 31 1a 47 b9 ca fb 60
9d e4 f6 a1 76 0d 6c f7
</pre><a href="#section-b.1.2-26" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-27">The Responder's subject name is the empty string:<a href="#section-b.1.2-27" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-28">
<pre>
Responders's subject name (text string)
""
</pre><a href="#section-b.1.2-28" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-29">CRED_R is the certificate (X509_R) encoded as a CBOR byte string:<a href="#section-b.1.2-29" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-30">
<pre>
X509_R (110 bytes)
47 62 4d c9 cd c6 82 4b 2a 4c 52 e9 5e c9 d6 b0 53 4b 71 c2 b4 9e 4b f9
03 15 00 ce e6 86 99 79 c2 97 bb 5a 8b 38 1e 98 db 71 41 08 41 5e 5c 50
db 78 97 4c 27 15 79 b0 16 33 a3 ef 62 71 be 5c 22 5e b2 8f 9c f6 18 0b
5a 6a f3 1e 80 20 9a 08 5c fb f9 5f 3f dc f9 b1 8b 69 3d 6c 0e 0d 0f fb
8e 3f 9a 32 a5 08 59 ec d0 bf cf f2 c2 18
</pre><a href="#section-b.1.2-30" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.1.2-31">
<pre>
CRED_R (112 bytes)
58 6e 47 62 4d c9 cd c6 82 4b 2a 4c 52 e9 5e c9 d6 b0 53 4b 71 c2 b4 9e
4b f9 03 15 00 ce e6 86 99 79 c2 97 bb 5a 8b 38 1e 98 db 71 41 08 41 5e
5c 50 db 78 97 4c 27 15 79 b0 16 33 a3 ef 62 71 be 5c 22 5e b2 8f 9c f6
18 0b 5a 6a f3 1e 80 20 9a 08 5c fb f9 5f 3f dc f9 b1 8b 69 3d 6c 0e 0d
0f fb 8e 3f 9a 32 a5 08 59 ec d0 bf cf f2 c2 18
</pre><a href="#section-b.1.2-31" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-32">And because certificates are identified by a hash value with the 'x5t' parameter, ID_CRED_R is the following:<a href="#section-b.1.2-32" class="pilcrow">¶</a></p>
<p id="section-b.1.2-33">ID_CRED_R = { 34 : COSE_CertHash }. In this example, the hash algorithm used is SHA-2 256-bit with hash truncated to 64-bits (value -15). The hash value is calculated over the certificate X509_R.<a href="#section-b.1.2-33" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-34">
<pre>
ID_CRED_R =
{
  34: [-15, h'FC79990F2431A3F5']
}
</pre><a href="#section-b.1.2-34" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.1.2-35">
<pre>
ID_CRED_R (14 bytes)
a1 18 22 82 2e 48 fc 79 99 0f 24 31 a3 f5
</pre><a href="#section-b.1.2-35" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-36">Since no unprotected opaque auxiliary data is sent in the message exchanges:<a href="#section-b.1.2-36" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-37">
<pre>
AD_2  (0 bytes)
</pre><a href="#section-b.1.2-37" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-38">The Plaintext is defined as the empty string:<a href="#section-b.1.2-38" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-39">
<pre>
P_2m (0 bytes)
</pre><a href="#section-b.1.2-39" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-40">The Enc_structure is defined as follows: [ "Encrypt0", &lt;&lt; ID_CRED_R &gt;&gt;, &lt;&lt; TH_2, CRED_R &gt;&gt; ]<a href="#section-b.1.2-40" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-41">
<pre>
A_2m =
[
  "Encrypt0",
  h'A11822822E48FC79990F2431A3F5',
  h'5820B0DC6C1BA0BAE6E2888610FA0B27BFC52E311A47B9CAFB609DE4F6A1760D6CF
  7586E47624DC9CDC6824B2A4C52E95EC9D6B0534B71C2B49E4BF9031500CEE6869979
  C297BB5A8B381E98DB714108415E5C50DB78974C271579B01633A3EF6271BE5C225EB
  28F9CF6180B5A6AF31E80209A085CFBF95F3FDCF9B18B693D6C0E0D0FFB8E3F9A32A5
  0859ECD0BFCFF2C218'
  ]
</pre><a href="#section-b.1.2-41" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-42">Which encodes to the following byte string to be used as Additional Authenticated Data:<a href="#section-b.1.2-42" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-43">
<pre>
A_2m (CBOR-encoded) (173 bytes)
83 68 45 6e 63 72 79 70 74 30 4e a1 18 22 82 2e 48 fc 79 99 0f 24 31 a3
f5 58 92 58 20 b0 dc 6c 1b a0 ba e6 e2 88 86 10 fa 0b 27 bf c5 2e 31 1a
47 b9 ca fb 60 9d e4 f6 a1 76 0d 6c f7 58 6e 47 62 4d c9 cd c6 82 4b 2a
4c 52 e9 5e c9 d6 b0 53 4b 71 c2 b4 9e 4b f9 03 15 00 ce e6 86 99 79 c2
97 bb 5a 8b 38 1e 98 db 71 41 08 41 5e 5c 50 db 78 97 4c 27 15 79 b0 16
33 a3 ef 62 71 be 5c 22 5e b2 8f 9c f6 18 0b 5a 6a f3 1e 80 20 9a 08 5c
fb f9 5f 3f dc f9 b1 8b 69 3d 6c 0e 0d 0f fb 8e 3f 9a 32 a5 08 59 ec d0
bf cf f2 c2 18
</pre><a href="#section-b.1.2-43" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-44">info for K_2m is defined as follows:<a href="#section-b.1.2-44" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-45">
<pre>
info for K_2m =
[
  10,
  h'B0DC6C1BA0BAE6E2888610FA0B27BFC52E311A47B9CAFB609DE4F6A1760D6CF7',
  "K_2m",
  16
]
</pre><a href="#section-b.1.2-45" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-46">Which as a CBOR encoded data item is:<a href="#section-b.1.2-46" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-47">
<pre>
info for K_2m (CBOR-encoded) (42 bytes)
84 0a 58 20 b0 dc 6c 1b a0 ba e6 e2 88 86 10 fa 0b 27 bf c5 2e 31 1a 47
b9 ca fb 60 9d e4 f6 a1 76 0d 6c f7 64 4b 5f 32 6d 10
</pre><a href="#section-b.1.2-47" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-48">From these parameters, K_2m is computed. Key K_2m is the output of HKDF-Expand(PRK_3e2m, info, L), where L is the length of K_2m, so 16 bytes.<a href="#section-b.1.2-48" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-49">
<pre>
K_2m (16 bytes)
b7 48 6a 94 a3 6c f6 9e 67 3f c4 57 55 ee 6b 95
</pre><a href="#section-b.1.2-49" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-50">info for IV_2m is defined as follows:<a href="#section-b.1.2-50" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-51">
<pre>
info for IV_2m =
[
  10,
  h'B0DC6C1BA0BAE6E2888610FA0B27BFC52E311A47B9CAFB609DE4F6A1760D6CF7',
  "IV_2m",
  13
]
</pre><a href="#section-b.1.2-51" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-52">Which as a CBOR encoded data item is:<a href="#section-b.1.2-52" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-53">
<pre>
info for IV_2m (CBOR-encoded) (43 bytes)
84 0a 58 20 b0 dc 6c 1b a0 ba e6 e2 88 86 10 fa 0b 27 bf c5 2e 31 1a 47
b9 ca fb 60 9d e4 f6 a1 76 0d 6c f7 65 49 56 5f 32 6d 0d
</pre><a href="#section-b.1.2-53" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-54">From these parameters, IV_2m is computed. IV_2m is the output of HKDF-Expand(PRK_3e2m, info, L), where L is the length of IV_2m, so 13 bytes.<a href="#section-b.1.2-54" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-55">
<pre>
IV_2m (13 bytes)
c5 b7 17 0e 65 d5 4f 1a e0 5d 10 af 56
</pre><a href="#section-b.1.2-55" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-56">Finally, COSE_Encrypt0 is computed from the parameters above.<a href="#section-b.1.2-56" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-b.1.2-57.1">protected header = CBOR-encoded ID_CRED_R<a href="#section-b.1.2-57.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-b.1.2-57.2">external_aad = A_2m<a href="#section-b.1.2-57.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-b.1.2-57.3">empty plaintext = P_2m<a href="#section-b.1.2-57.3" class="pilcrow">¶</a>
</li>
          </ul>
<div class="artwork art-text alignLeft" id="section-b.1.2-58">
<pre>
MAC_2 (8 bytes)
cf 99 99 ae 75 9e c0 d8
</pre><a href="#section-b.1.2-58" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-59">To compute the Signature_or_MAC_2, the key is the private authentication key of the Responder and 
the message M_2 to be signed = [ "Signature1", &lt;&lt; ID_CRED_R &gt;&gt;, &lt;&lt; TH_2, CRED_R, ? AD_2 &gt;&gt;, MAC_2 ]<a href="#section-b.1.2-59" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-60">
<pre>
M_2 =
[
  "Signature1",
  h'A11822822E48FC79990F2431A3F5',
  h'5820B0DC6C1BA0BAE6E2888610FA0B27BFC52E311A47B9CAFB609DE4F6A1760D6CF
  7586E47624DC9CDC6824B2A4C52E95EC9D6B0534B71C2B49E4BF9031500CEE6869979
  C297BB5A8B381E98DB714108415E5C50DB78974C271579B01633A3EF6271BE5C225EB
  28F9CF6180B5A6AF31E80209A085CFBF95F3FDCF9B18B693D6C0E0D0FFB8E3F9A32A5
  0859ECD0BFCFF2C218',
  h'CF9999AE759EC0D8'
]
</pre><a href="#section-b.1.2-60" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-61">Which as a CBOR encoded data item is:<a href="#section-b.1.2-61" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-62">
<pre>
M_2 (184 bytes)
84 6a 53 69 67 6e 61 74 75 72 65 31 4e a1 18 22 82 2e 48 fc 79 99 0f 24
31 a3 f5 58 92 58 20 b0 dc 6c 1b a0 ba e6 e2 88 86 10 fa 0b 27 bf c5 2e
31 1a 47 b9 ca fb 60 9d e4 f6 a1 76 0d 6c f7 58 6e 47 62 4d c9 cd c6 82
4b 2a 4c 52 e9 5e c9 d6 b0 53 4b 71 c2 b4 9e 4b f9 03 15 00 ce e6 86 99
79 c2 97 bb 5a 8b 38 1e 98 db 71 41 08 41 5e 5c 50 db 78 97 4c 27 15 79
b0 16 33 a3 ef 62 71 be 5c 22 5e b2 8f 9c f6 18 0b 5a 6a f3 1e 80 20 9a
08 5c fb f9 5f 3f dc f9 b1 8b 69 3d 6c 0e 0d 0f fb 8e 3f 9a 32 a5 08 59
ec d0 bf cf f2 c2 18 48 cf 99 99 ae 75 9e c0 d8
</pre><a href="#section-b.1.2-62" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-63">From there Signature_or_MAC_2 is a signature (since method = 0):<a href="#section-b.1.2-63" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-64">
<pre>
Signature_or_MAC_2 (64 bytes)
45 47 81 ec ef eb b4 83 e6 90 83 9d 57 83 8d fe 24 a8 cf 3f 66 42 8a a0
16 20 4a 22 61 84 4a f8 4f 98 b8 c6 83 4f 38 7f dd 60 6a 29 41 3a dd e3
a2 07 74 02 13 74 01 19 6f 6a 50 24 06 6f ac 0e
</pre><a href="#section-b.1.2-64" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-65">CIPHERTEXT_2 is the ciphertext resulting from XOR encrypting a plaintext constructed from the following parameters and the key K_2e.<a href="#section-b.1.2-65" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-b.1.2-66.1">plaintext = CBOR Sequence of the items ID_CRED_R and Singature_or_MAC_2, in this order.<a href="#section-b.1.2-66.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-b.1.2-67">The plaintext is the following:<a href="#section-b.1.2-67" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-68">
<pre>
P_2e (CBOR Sequence) (80 bytes)
a1 18 22 82 2e 48 fc 79 99 0f 24 31 a3 f5 58 40 45 47 81 ec ef eb b4 83
e6 90 83 9d 57 83 8d fe 24 a8 cf 3f 66 42 8a a0 16 20 4a 22 61 84 4a f8
4f 98 b8 c6 83 4f 38 7f dd 60 6a 29 41 3a dd e3 a2 07 74 02 13 74 01 19
6f 6a 50 24 06 6f ac 0e
</pre><a href="#section-b.1.2-68" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-69">K_2e = HKDF-Expand( PRK, info, length ), where length is the length of the plaintext, so 80.<a href="#section-b.1.2-69" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-70">
<pre>
info for K_2e =
[
  10,
  h'B0DC6C1BA0BAE6E2888610FA0B27BFC52E311A47B9CAFB609DE4F6A1760D6CF7',
  "K_2e",
  80
]
</pre><a href="#section-b.1.2-70" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-71">Which as a CBOR encoded data item is:<a href="#section-b.1.2-71" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-72">
<pre>
info for K_2e (CBOR-encoded) (43 bytes)
84 0a 58 20 b0 dc 6c 1b a0 ba e6 e2 88 86 10 fa 0b 27 bf c5 2e 31 1a 47
b9 ca fb 60 9d e4 f6 a1 76 0d 6c f7 64 4b 5f 32 65 18 50
</pre><a href="#section-b.1.2-72" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-73">From there, K_2e is computed:<a href="#section-b.1.2-73" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-74">
<pre>
K_2e (80 bytes)
38 cd 1a 83 89 6d 43 af 3d e8 39 35 27 42 0d ac 7d 7a 76 96 7e 85 74 58
26 bb 39 e1 76 21 8d 7e 5f e7 97 60 14 c9 ed ba c0 58 ee 18 cd 57 71 80
a4 4d de 0b 83 00 fe 8e 09 66 9a 34 d6 3e 3a e6 10 12 26 ab f8 5c eb 28
05 dc 00 13 d1 78 2a 20
</pre><a href="#section-b.1.2-74" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-75">Using the parameters above, the ciphertext CIPHERTEXT_2 can be computed:<a href="#section-b.1.2-75" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-76">
<pre>
CIPHERTEXT_2 (80 bytes)
99 d5 38 01 a7 25 bf d6 a4 e7 1d 04 84 b7 55 ec 38 3d f7 7a 91 6e c0 db
c0 2b ba 7c 21 a2 00 80 7b 4f 58 5f 72 8b 67 1a d6 78 a4 3a ac d3 3b 78
eb d5 66 cd 00 4f c6 f1 d4 06 f0 1d 97 04 e7 05 b2 15 52 a9 eb 28 ea 31
6a b6 50 37 d7 17 86 2e
</pre><a href="#section-b.1.2-76" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-77">message_2 is the CBOR Sequence of data_2 and CIPHERTEXT_2, in this order:<a href="#section-b.1.2-77" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-78">
<pre>
message_2 =
(
 data_2,
 h'99d53801a725bfd6a4e71d0484b755ec383df77a916ec0dbc02bba7c21a200807b4f
585f728b671ad678a43aacd33b78ebd566cd004fc6f1d406f01d9704e705b21552a9eb
28ea316ab65037d717862e'
)
</pre><a href="#section-b.1.2-78" class="pilcrow">¶</a>
</div>
<p id="section-b.1.2-79">Which as a CBOR encoded data item is:<a href="#section-b.1.2-79" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.2-80">
<pre>
message_2 (CBOR Sequence) (117 bytes)
58 20 71 a3 d5 99 c2 1d a1 89 02 a1 ae a8 10 b2 b6 38 2c cd 8d 5f 9b f0
19 52 81 75 4c 5e bc af 30 1e 13 58 50 99 d5 38 01 a7 25 bf d6 a4 e7 1d
04 84 b7 55 ec 38 3d f7 7a 91 6e c0 db c0 2b ba 7c 21 a2 00 80 7b 4f 58
5f 72 8b 67 1a d6 78 a4 3a ac d3 3b 78 eb d5 66 cd 00 4f c6 f1 d4 06 f0
1d 97 04 e7 05 b2 15 52 a9 eb 28 ea 31 6a b6 50 37 d7 17 86 2e
</pre><a href="#section-b.1.2-80" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="message3">
<section id="section-b.1.3">
          <h3 id="name-message_3">
<a href="#section-b.1.3" class="section-number selfRef">B.1.3. </a><a href="#name-message_3" class="section-name selfRef">Message_3</a>
          </h3>
<p id="section-b.1.3-1">Since corr equals 1, C_R is not omitted from data_3.<a href="#section-b.1.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-2">
<pre>
SK_I (Initiator's private authentication key) (32 bytes)
2f fc e7 a0 b2 b8 25 d3 97 d0 cb 54 f7 46 e3 da 3f 27 59 6e e0 6b 53 71
48 1d c0 e0 12 bc 34 d7
</pre><a href="#section-b.1.3-2" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-3">HKDF SHA-256 is the HKDF used (as defined by cipher suite 0).<a href="#section-b.1.3-3" class="pilcrow">¶</a></p>
<p id="section-b.1.3-4">PRK_4x3m = HMAC-SHA-256 (PRK_3e2m, G_IY)<a href="#section-b.1.3-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-5">
<pre>
PRK_4x3m (32 bytes)
ec 62 92 a0 67 f1 37 fc 7f 59 62 9d 22 6f bf c4 e0 68 89 49 f6 62 a9 7f
d8 2f be b7 99 71 39 4a
</pre><a href="#section-b.1.3-5" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-6">data 3 is equal to C_R.<a href="#section-b.1.3-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-7">
<pre>
data_3 (CBOR Sequence) (1 bytes)
13
</pre><a href="#section-b.1.3-7" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-8">From data_3, CIPHERTEXT_2, and TH_2, compute the input to the transcript hash TH_3 = H(TH_2 , CIPHERTEXT_2, data_3), as a CBOR Sequence of these 3 data items.<a href="#section-b.1.3-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-9">
<pre>
Input to calculate TH_3 (CBOR Sequence) (117 bytes)
58 20 b0 dc 6c 1b a0 ba e6 e2 88 86 10 fa 0b 27 bf c5 2e 31 1a 47 b9 ca
fb 60 9d e4 f6 a1 76 0d 6c f7 58 50 99 d5 38 01 a7 25 bf d6 a4 e7 1d 04
84 b7 55 ec 38 3d f7 7a 91 6e c0 db c0 2b ba 7c 21 a2 00 80 7b 4f 58 5f
72 8b 67 1a d6 78 a4 3a ac d3 3b 78 eb d5 66 cd 00 4f c6 f1 d4 06 f0 1d
97 04 e7 05 b2 15 52 a9 eb 28 ea 31 6a b6 50 37 d7 17 86 2e 13
</pre><a href="#section-b.1.3-9" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-10">And from there, compute the transcript hash TH_3 = SHA-256(TH_2 , CIPHERTEXT_2, data_3)<a href="#section-b.1.3-10" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-11">
<pre>
TH_3 (32 bytes)
a2 39 a6 27 ad a3 80 2d b8 da e5 1e c3 92 bf eb 92 6d 39 3e f6 ee e4 dd
b3 2e 4a 27 ce 93 58 da
</pre><a href="#section-b.1.3-11" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-12">The initiator's subject name is the empty string:<a href="#section-b.1.3-12" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-13">
<pre>
Initiator's subject name (text string)
""
</pre><a href="#section-b.1.3-13" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-14">CRED_I is the certificate (X509_I) encoded as a CBOR byte string:<a href="#section-b.1.3-14" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-15">
<pre>
X509_I (101 bytes)
fa 34 b2 2a 9c a4 a1 e1 29 24 ea e1 d1 76 60 88 09 84 49 cb 84 8f fc 79
5f 88 af c4 9c be 8a fd d1 ba 00 9f 21 67 5e 8f 6c 77 a4 a2 c3 01 95 60
1f 6f 0a 08 52 97 8b d4 3d 28 20 7d 44 48 65 02 ff 7b dd a6 32 c7 88 37
00 16 b8 96 5b db 20 74 bf f8 2e 5a 20 e0 9b ec 21 f8 40 6e 86 44 2b 87
ec 3f f2 45 b7
</pre><a href="#section-b.1.3-15" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.1.3-16">
<pre>
CRED_I (103 bytes)
58 65 fa 34 b2 2a 9c a4 a1 e1 29 24 ea e1 d1 76 60 88 09 84 49 cb 84 8f
fc 79 5f 88 af c4 9c be 8a fd d1 ba 00 9f 21 67 5e 8f 6c 77 a4 a2 c3 01
95 60 1f 6f 0a 08 52 97 8b d4 3d 28 20 7d 44 48 65 02 ff 7b dd a6 32 c7
88 37 00 16 b8 96 5b db 20 74 bf f8 2e 5a 20 e0 9b ec 21 f8 40 6e 86 44
2b 87 ec 3f f2 45 b7
</pre><a href="#section-b.1.3-16" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-17">And because certificates are identified by a hash value with the 'x5t' parameter, ID_CRED_I is the following:<a href="#section-b.1.3-17" class="pilcrow">¶</a></p>
<p id="section-b.1.3-18">ID_CRED_I = { 34 : COSE_CertHash }. In this example, the hash algorithm used is SHA-2 256-bit with hash truncated to 64-bits (value -15). The hash value is calculated over the certificate X509_I.<a href="#section-b.1.3-18" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-19">
<pre>
ID_CRED_I =
{
  34: [-15, h'FC79990F2431A3F5']
}
</pre><a href="#section-b.1.3-19" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.1.3-20">
<pre>
ID_CRED_I (14 bytes)
a1 18 22 82 2e 48 5b 78 69 88 43 9e bc f2
</pre><a href="#section-b.1.3-20" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-21">Since no opaque auxiliary data is exchanged:<a href="#section-b.1.3-21" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-22">
<pre>
AD_3 (0 bytes)
</pre><a href="#section-b.1.3-22" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-23">The Plaintext of the COSE_Encrypt is the empty string:<a href="#section-b.1.3-23" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-24">
<pre>
P_3m (0 bytes)
</pre><a href="#section-b.1.3-24" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-25">The external_aad is the CBOR Sequence od CRED_I and TH_3, in this order:<a href="#section-b.1.3-25" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-26">
<pre>
A_3m (CBOR-encoded) (164 bytes)
83 68 45 6e 63 72 79 70 74 30 4e a1 18 22 82 2e 48 5b 78 69 88 43 9e bc
f2 58 89 58 20 a2 39 a6 27 ad a3 80 2d b8 da e5 1e c3 92 bf eb 92 6d 39
3e f6 ee e4 dd b3 2e 4a 27 ce 93 58 da 58 65 fa 34 b2 2a 9c a4 a1 e1 29
24 ea e1 d1 76 60 88 09 84 49 cb 84 8f fc 79 5f 88 af c4 9c be 8a fd d1
ba 00 9f 21 67 5e 8f 6c 77 a4 a2 c3 01 95 60 1f 6f 0a 08 52 97 8b d4 3d
28 20 7d 44 48 65 02 ff 7b dd a6 32 c7 88 37 00 16 b8 96 5b db 20 74 bf
f8 2e 5a 20 e0 9b ec 21 f8 40 6e 86 44 2b 87 ec 3f f2 45 b7
</pre><a href="#section-b.1.3-26" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-27">Info for K_3m is computed as follows:<a href="#section-b.1.3-27" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-28">
<pre>
info for K_3m =
[
  10,
  h'A239A627ADA3802DB8DAE51EC392BFEB926D393EF6EEE4DDB32E4A27CE9358DA',
  "K_3m",
  16
]
</pre><a href="#section-b.1.3-28" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-29">Which as a CBOR encoded data item is:<a href="#section-b.1.3-29" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-30">
<pre>
info for K_3m (CBOR-encoded) (42 bytes)
84 0a 58 20 a2 39 a6 27 ad a3 80 2d b8 da e5 1e c3 92 bf eb 92 6d 39 3e
f6 ee e4 dd b3 2e 4a 27 ce 93 58 da 64 4b 5f 33 6d 10
</pre><a href="#section-b.1.3-30" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-31">From these parameters, K_3m is computed. Key K_3m is the output of HKDF-Expand(PRK_4x3m, info, L), where L is the length of K_2m, so 16 bytes.<a href="#section-b.1.3-31" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-32">
<pre>
K_3m (16 bytes)
3d bb f0 d6 01 03 26 e8 27 3f c6 c6 c3 b0 de cd
</pre><a href="#section-b.1.3-32" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-33">Nonce IV_3m is the output of HKDF-Expand(PRK_4x3m, info, L), where L = 13 bytes.<a href="#section-b.1.3-33" class="pilcrow">¶</a></p>
<p id="section-b.1.3-34">Info for IV_3m is defined as follows:<a href="#section-b.1.3-34" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-35">
<pre>
info for IV_3m =
[
  10,
  h'A239A627ADA3802DB8DAE51EC392BFEB926D393EF6EEE4DDB32E4A27CE9358DA',
  "IV_3m",
  13
]
</pre><a href="#section-b.1.3-35" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-36">Which as a CBOR encoded data item is:<a href="#section-b.1.3-36" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-37">
<pre>
info for IV_3m (CBOR-encoded) (43 bytes)
84 0a 58 20 a2 39 a6 27 ad a3 80 2d b8 da e5 1e c3 92 bf eb 92 6d 39 3e
f6 ee e4 dd b3 2e 4a 27 ce 93 58 da 65 49 56 5f 33 6d 0d
</pre><a href="#section-b.1.3-37" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-38">From these parameters, IV_3m is computed:<a href="#section-b.1.3-38" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-39">
<pre>
IV_3m (13 bytes)
10 b6 f4 41 4a 2c 91 3c cd a1 96 42 e3
</pre><a href="#section-b.1.3-39" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-40">MAC_3 is the ciphertext of the COSE_Encrypt0:<a href="#section-b.1.3-40" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-41">
<pre>
MAC_3 (8 bytes)
5e ef b8 85 98 3c 22 d9
</pre><a href="#section-b.1.3-41" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-42">Since the method = 0, Signature_or_Mac_3 is a signature:<a href="#section-b.1.3-42" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-b.1.3-43.1">The message M_3 to be signed = [ "Signature1", &lt;&lt; ID_CRED_I &gt;&gt;, &lt;&lt; TH_3, CRED_I &gt;&gt;, MAC_3 ]<a href="#section-b.1.3-43.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-b.1.3-43.2">The signing key is the private authentication key of the Initiator.<a href="#section-b.1.3-43.2" class="pilcrow">¶</a>
</li>
          </ul>
<div class="artwork art-text alignLeft" id="section-b.1.3-44">
<pre>
M_3 =
[
  "Signature1",
  h'A11822822E485B786988439EBCF2',
  h'5820A239A627ADA3802DB8DAE51EC392BFEB926D393EF6EEE4DDB32E4A27CE9358D
  A5865FA34B22A9CA4A1E12924EAE1D1766088098449CB848FFC795F88AFC49CBE8AFD
  D1BA009F21675E8F6C77A4A2C30195601F6F0A0852978BD43D28207D44486502FF7BD
  DA632C788370016B8965BDB2074BFF82E5A20E09BEC21F8406E86442B87EC3FF245
  B7',
  h'5EEFB885983C22D9']
</pre><a href="#section-b.1.3-44" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-45">Which as a CBOR encoded data item is:<a href="#section-b.1.3-45" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-46">
<pre>
M_3 (175 bytes)
84 6a 53 69 67 6e 61 74 75 72 65 31 4e a1 18 22 82 2e 48 5b 78 69 88 43
9e bc f2 58 89 58 20 a2 39 a6 27 ad a3 80 2d b8 da e5 1e c3 92 bf eb 92
6d 39 3e f6 ee e4 dd b3 2e 4a 27 ce 93 58 da 58 65 fa 34 b2 2a 9c a4 a1
e1 29 24 ea e1 d1 76 60 88 09 84 49 cb 84 8f fc 79 5f 88 af c4 9c be 8a
fd d1 ba 00 9f 21 67 5e 8f 6c 77 a4 a2 c3 01 95 60 1f 6f 0a 08 52 97 8b
d4 3d 28 20 7d 44 48 65 02 ff 7b dd a6 32 c7 88 37 00 16 b8 96 5b db 20
74 bf f8 2e 5a 20 e0 9b ec 21 f8 40 6e 86 44 2b 87 ec 3f f2 45 b7 48 5e
ef b8 85 98 3c 22 d9
</pre><a href="#section-b.1.3-46" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-47">From there, the signature can be computed:<a href="#section-b.1.3-47" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-48">
<pre>
Signature_or_MAC_3 (64 bytes)
b3 31 76 33 fa eb c7 f4 24 9c f3 ab 95 96 fd ae 2b eb c8 e7 27 5d 39 9f
42 00 04 f3 76 7b 88 d6 0f fe 37 dc f3 90 a0 00 d8 5a b0 ad b0 d7 24 e3
a5 7c 4d fe 24 14 a4 1e 79 78 91 b9 55 35 89 06
</pre><a href="#section-b.1.3-48" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-49">Finally, the outer COSE_Encrypt0 is computed.<a href="#section-b.1.3-49" class="pilcrow">¶</a></p>
<p id="section-b.1.3-50">The Plaintext is the following CBOR Sequence: 
plaintext = ( ID_CRED_I , Signature_or_MAC_3 )<a href="#section-b.1.3-50" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-51">
<pre>
P_3ae (CBOR Sequence) (80 bytes)
a1 18 22 82 2e 48 5b 78 69 88 43 9e bc f2 58 40 b3 31 76 33 fa eb c7 f4
24 9c f3 ab 95 96 fd ae 2b eb c8 e7 27 5d 39 9f 42 00 04 f3 76 7b 88 d6
0f fe 37 dc f3 90 a0 00 d8 5a b0 ad b0 d7 24 e3 a5 7c 4d fe 24 14 a4 1e
79 78 91 b9 55 35 89 06
</pre><a href="#section-b.1.3-51" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-52">The Associated data A is the following:
Associated data A = [ "Encrypt0", h'', TH_3 ]<a href="#section-b.1.3-52" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-53">
<pre>
A_3ae (CBOR-encoded) (45 bytes)
83 68 45 6e 63 72 79 70 74 30 40 58 20 a2 39 a6 27 ad a3 80 2d b8 da e5
1e c3 92 bf eb 92 6d 39 3e f6 ee e4 dd b3 2e 4a 27 ce 93 58 da
</pre><a href="#section-b.1.3-53" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-54">Key K_3ae is the output of HKDF-Expand(PRK_3e2m, info, L).<a href="#section-b.1.3-54" class="pilcrow">¶</a></p>
<p id="section-b.1.3-55">info is defined as follows:<a href="#section-b.1.3-55" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-56">
<pre>
info for K_3ae =
[
  10,
  h'A239A627ADA3802DB8DAE51EC392BFEB926D393EF6EEE4DDB32E4A27CE9358DA',
  "K_3ae",
  16
]
</pre><a href="#section-b.1.3-56" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-57">Which as a CBOR encoded data item is:<a href="#section-b.1.3-57" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-58">
<pre>
info for K_3ae (CBOR-encoded) (43 bytes)
84 0a 58 20 a2 39 a6 27 ad a3 80 2d b8 da e5 1e c3 92 bf eb 92 6d 39 3e
f6 ee e4 dd b3 2e 4a 27 ce 93 58 da 65 4b 5f 33 61 65 10
</pre><a href="#section-b.1.3-58" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-59">L is the length of K_3ae, so 16 bytes.<a href="#section-b.1.3-59" class="pilcrow">¶</a></p>
<p id="section-b.1.3-60">From these parameters, K_3ae is computed:<a href="#section-b.1.3-60" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-61">
<pre>
K_3ae (16 bytes)
58 b5 2f 94 5b 30 9d 85 4c a7 36 cd 06 a9 62 95
</pre><a href="#section-b.1.3-61" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-62">Nonce IV_3ae is the output of HKDF-Expand(PRK_3e2m, info, L).<a href="#section-b.1.3-62" class="pilcrow">¶</a></p>
<p id="section-b.1.3-63">info is defined as follows:<a href="#section-b.1.3-63" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-64">
<pre>
info for IV_3ae =
[
  10,
  h'A239A627ADA3802DB8DAE51EC392BFEB926D393EF6EEE4DDB32E4A27CE9358DA',
  "IV_3ae",
  13
]
</pre><a href="#section-b.1.3-64" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-65">Which as a CBOR encoded data item is:<a href="#section-b.1.3-65" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-66">
<pre>
info for IV_3ae (CBOR-encoded) (44 bytes)
84 0a 58 20 a2 39 a6 27 ad a3 80 2d b8 da e5 1e c3 92 bf eb 92 6d 39 3e
f6 ee e4 dd b3 2e 4a 27 ce 93 58 da 66 49 56 5f 33 61 65 0d
</pre><a href="#section-b.1.3-66" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-67">L is the length of IV_3ae, so 13 bytes.<a href="#section-b.1.3-67" class="pilcrow">¶</a></p>
<p id="section-b.1.3-68">From these parameters, IV_3ae is computed:<a href="#section-b.1.3-68" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-69">
<pre>
IV_3ae (13 bytes)
cf a9 a5 85 58 10 d6 dc e9 74 3c 3b c3
</pre><a href="#section-b.1.3-69" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-70">Using the parameters above, the ciphertext CIPHERTEXT_3 can be computed:<a href="#section-b.1.3-70" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-71">
<pre>
CIPHERTEXT_3 (88 bytes)
2d 88 ff 86 da 47 48 2c 0d fa 55 9a c8 24 a4 a7 83 d8 70 c9 db a4 78 05
e8 aa fb ad 69 74 c4 96 46 58 65 03 fa 9b bf 3e 00 01 2c 03 7e af 56 e4
5e 30 19 20 83 9b 81 3a 53 f6 d4 c5 57 48 0f 6c 79 7d 5b 76 f0 e4 62 f5
f5 7a 3d b6 d2 b5 0c 32 31 9f 34 0f 4a c5 af 9a
</pre><a href="#section-b.1.3-71" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-72">From the parameter above, message_3 is computed, as the CBOR Sequence of the following items: (C_R, CIPHERTEXT_3).<a href="#section-b.1.3-72" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-73">
<pre>
message_3 =
(
  h'13',
  h''
)
</pre><a href="#section-b.1.3-73" class="pilcrow">¶</a>
</div>
<p id="section-b.1.3-74">Which encodes to the following byte string:<a href="#section-b.1.3-74" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1.3-75">
<pre>
message_3 (CBOR Sequence) (91 bytes)
13 58 58 2d 88 ff 86 da 47 48 2c 0d fa 55 9a c8 24 a4 a7 83 d8 70 c9 db
a4 78 05 e8 aa fb ad 69 74 c4 96 46 58 65 03 fa 9b bf 3e 00 01 2c 03 7e
af 56 e4 5e 30 19 20 83 9b 81 3a 53 f6 d4 c5 57 48 0f 6c 79 7d 5b 76 f0
e4 62 f5 f5 7a 3d b6 d2 b5 0c 32 31 9f 34 0f 4a c5 af 9a
</pre><a href="#section-b.1.3-75" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="test-vectors-for-edhoc-authenticated-with-static-diffie-hellman-keys">
<section id="section-b.2">
        <h2 id="name-test-vectors-for-edhoc-authe">
<a href="#section-b.2" class="section-number selfRef">B.2. </a><a href="#name-test-vectors-for-edhoc-authe" class="section-name selfRef">Test Vectors for EDHOC Authenticated with Static Diffie-Hellman Keys</a>
        </h2>
<p id="section-b.2-1">EDHOC with static Diffie-Hellman keys is used.<a href="#section-b.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2-2">
<pre>
method (Static DH Based Authentication)
3
</pre><a href="#section-b.2-2" class="pilcrow">¶</a>
</div>
<p id="section-b.2-3">CoAP is used as transport and the Initiator acts as CoAP client:<a href="#section-b.2-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2-4">
<pre>
corr (the Initiator can correlate message_1 and message_2)
1
</pre><a href="#section-b.2-4" class="pilcrow">¶</a>
</div>
<p id="section-b.2-5">From there, METHOD_CORR has the following value:<a href="#section-b.2-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2-6">
<pre>
METHOD_CORR (4 * method + corr) (int)
13
</pre><a href="#section-b.2-6" class="pilcrow">¶</a>
</div>
<p id="section-b.2-7">No unprotected opaque auxiliary data is sent in the message exchanges.<a href="#section-b.2-7" class="pilcrow">¶</a></p>
<p id="section-b.2-8">The list of supported cipher suites of the Initiator in order of preference is the following:<a href="#section-b.2-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2-9">
<pre>
Supported Cipher Suites (4 bytes)
00 01 02 03
</pre><a href="#section-b.2-9" class="pilcrow">¶</a>
</div>
<p id="section-b.2-10">The cipher suite selected by the Initiator is the most preferred:<a href="#section-b.2-10" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2-11">
<pre>
Selected Cipher Suite (int)
0
</pre><a href="#section-b.2-11" class="pilcrow">¶</a>
</div>
<p id="section-b.2-12">The mandatory-to-implement cipher suite 0 is supported by both the Initiator and the Responder, see <a href="#cipher-suites" class="xref">Section 7.3</a>.<a href="#section-b.2-12" class="pilcrow">¶</a></p>
<div id="dh-ss-m1">
<section id="section-b.2.1">
          <h3 id="name-message_1-2">
<a href="#section-b.2.1" class="section-number selfRef">B.2.1. </a><a href="#name-message_1-2" class="section-name selfRef">Message_1</a>
          </h3>
<div class="artwork art-text alignLeft" id="section-b.2.1-1">
<pre>
X (Initiator's ephemeral private key) (32 bytes)
ae 11 a0 db 86 3c 02 27 e5 39 92 fe b8 f5 92 4c 50 d0 a7 ba 6e ea b4 ad
1f f2 45 72 f4 f5 7c fa
</pre><a href="#section-b.2.1-1" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.2.1-2">
<pre>
G_X (Initiator's ephemeral public key) (32 bytes)
8d 3e f5 6d 1b 75 0a 43 51 d6 8a c2 50 a0 e8 83 79 0e fc 80 a5 38 a4 44
ee 9e 2b 57 e2 44 1a 7c
</pre><a href="#section-b.2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-b.2.1-3">The Initiator chooses a connection identifier C_I:<a href="#section-b.2.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.1-4">
<pre>
Connection identifier chosen by Initiator (1 bytes)
16
</pre><a href="#section-b.2.1-4" class="pilcrow">¶</a>
</div>
<p id="section-b.2.1-5">Note that since C_I is a byte strings of length one, it is encoded as the corresponding integer - 24 (see bstr_identifier in <a href="#bstr_id" class="xref">Section 4.3</a>), i.e. 0x16 = 22, 22 - 24 = -2, and -2 in CBOR encoding is equal to 0x21.<a href="#section-b.2.1-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.1-6">
<pre>
C_I (1 byte)
21
</pre><a href="#section-b.2.1-6" class="pilcrow">¶</a>
</div>
<p id="section-b.2.1-7">Since no unprotected opaque auxiliary data is sent in the message exchanges:<a href="#section-b.2.1-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.1-8">
<pre>
AD_1 (0 bytes)
</pre><a href="#section-b.2.1-8" class="pilcrow">¶</a>
</div>
<p id="section-b.2.1-9">Since the list of supported cipher suites needs to contain the selected cipher suite, the initiator truncates the list of supported cipher suites to one cipher suite only, 00.<a href="#section-b.2.1-9" class="pilcrow">¶</a></p>
<p id="section-b.2.1-10">Because one single selected cipher suite is conveyed, it is encoded as an int instead of an array:<a href="#section-b.2.1-10" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.1-11">
<pre>
SUITES_I (int)
0
</pre><a href="#section-b.2.1-11" class="pilcrow">¶</a>
</div>
<p id="section-b.2.1-12">With SUITES_I = 0, message_1 is constructed, as the CBOR Sequence of the CBOR data items above.<a href="#section-b.2.1-12" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.1-13">
<pre>
message_1 =
(
  13,
  0,
  h'8D3EF56D1B750A4351D68AC250A0E883790EFC80A538A444EE9E2B57E2441A7C',
  -2
)
</pre><a href="#section-b.2.1-13" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.2.1-14">
<pre>
message_1 (CBOR Sequence) (37 bytes)
0d 00 58 20 8d 3e f5 6d 1b 75 0a 43 51 d6 8a c2 50 a0 e8 83 79 0e fc 80
a5 38 a4 44 ee 9e 2b 57 e2 44 1a 7c 21
</pre><a href="#section-b.2.1-14" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="dh-ss-m2">
<section id="section-b.2.2">
          <h3 id="name-message_2-2">
<a href="#section-b.2.2" class="section-number selfRef">B.2.2. </a><a href="#name-message_2-2" class="section-name selfRef">Message_2</a>
          </h3>
<p id="section-b.2.2-1">Since METHOD_CORR mod 4 equals 1, C_I is omitted from data_2.<a href="#section-b.2.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-2">
<pre>
Y (Responder's ephemeral private key) (32 bytes)
c6 46 cd dc 58 12 6e 18 10 5f 01 ce 35 05 6e 5e bc 35 f4 d4 cc 51 07 49
a3 a5 e0 69 c1 16 16 9a
</pre><a href="#section-b.2.2-2" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.2.2-3">
<pre>
G_Y (Responder's ephemeral public key) (32 bytes)
52 fb a0 bd c8 d9 53 dd 86 ce 1a b2 fd 7c 05 a4 65 8c 7c 30 af db fc 33
01 04 70 69 45 1b af 35
</pre><a href="#section-b.2.2-3" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-4">From G_X and Y or from G_Y and X the ECDH shared secret is computed:<a href="#section-b.2.2-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-5">
<pre>
G_XY (ECDH shared secret) (32 bytes)
de fc 2f 35 69 10 9b 3d 1f a4 a7 3d c5 e2 fe b9 e1 15 0d 90 c2 5e e2 f0
66 c2 d8 85 f4 f8 ac 4e
</pre><a href="#section-b.2.2-5" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-6">The key and nonce for calculating the ciphertext are calculated as follows, as specified in <a href="#key-der" class="xref">Section 3.8</a>.<a href="#section-b.2.2-6" class="pilcrow">¶</a></p>
<p id="section-b.2.2-7">HKDF SHA-256 is the HKDF used (as defined by cipher suite 0).<a href="#section-b.2.2-7" class="pilcrow">¶</a></p>
<p id="section-b.2.2-8">PRK_2e = HMAC-SHA-256(salt, G_XY)<a href="#section-b.2.2-8" class="pilcrow">¶</a></p>
<p id="section-b.2.2-9">Salt is the empty byte string.<a href="#section-b.2.2-9" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-10">
<pre>
salt (0 bytes)
</pre><a href="#section-b.2.2-10" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-11">From there, PRK_2e is computed:<a href="#section-b.2.2-11" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-12">
<pre>
PRK_2e (32 bytes)
93 9f cb 05 6d 2e 41 4f 1b ec 61 04 61 99 c2 c7 63 d2 7f 0c 3d 15 fa 16
71 fa 13 4e 0d c5 a0 4d
</pre><a href="#section-b.2.2-12" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.2.2-13">
<pre>
SK_R (Responders's private authentication key) (32 bytes)
bb 50 1a ac 67 b9 a9 5f 97 e0 ed ed 6b 82 a6 62 93 4f bb fc 7a d1 b7 4c
1f ca d6 6a 07 94 22 d0
</pre><a href="#section-b.2.2-13" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-14">Since the Responder authenticates with a static Diffie-Hellman key, PRK_3e2m = HKDF-Extract( PRK_2e, G_RX ), where G_RX is the ECDH shared secret calculated from G_R and X, or G_X and R.<a href="#section-b.2.2-14" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-15">
<pre>
R (Responder's private authentication key) (32 bytes)
bb 50 1a ac 67 b9 a9 5f 97 e0 ed ed 6b 82 a6 62 93 4f bb fc 7a d1 b7 4c
1f ca d6 6a 07 94 22 d0
</pre><a href="#section-b.2.2-15" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.2.2-16">
<pre>
G_R (Responder's public authentication key) (32 bytes)
a3 ff 26 35 95 be b3 77 d1 a0 ce 1d 04 da d2 d4 09 66 ac 6b cb 62 20 51
b8 46 59 18 4d 5d 9a 32
</pre><a href="#section-b.2.2-16" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-17">From the Responder's authentication key and the Initiator's ephemeral key (see <a href="#dh-ss-m1" class="xref">Appendix B.2.1</a>), the ECDH shared secret G_RX is calculated.<a href="#section-b.2.2-17" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-18">
<pre>
G_RX (ECDH shared secret) (32 bytes)
21 c7 ef f4 fb 69 fa 4b 67 97 d0 58 84 31 5d 84 11 a3 fd a5 4f 6d ad a6
1d 4f cd 85 e7 90 66 68
</pre><a href="#section-b.2.2-18" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.2.2-19">
<pre>
PRK_3e2m (32 bytes)
75 07 7c 69 1e 35 01 2d 48 bc 24 c8 4f 2b ab 89 f5 2f ac 03 fe dd 81 3e
43 8c 93 b1 0b 39 93 07
</pre><a href="#section-b.2.2-19" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-20">The Responder chooses a connection identifier C_R.<a href="#section-b.2.2-20" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-21">
<pre>
Connection identifier chosen by Responder (1 byte)
20
</pre><a href="#section-b.2.2-21" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-22">Note that since C_R is a byte strings of length one, it is encoded as the corresponding integer - 24 (see bstr_identifier in <a href="#bstr_id" class="xref">Section 4.3</a>), i.e. 0x20 = 32, 32 - 24 = 8, and 8 in CBOR encoding is equal to 0x08.<a href="#section-b.2.2-22" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-23">
<pre>
C_R (1 byte)
08
</pre><a href="#section-b.2.2-23" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-24">Data_2 is constructed, as the CBOR Sequence of G_Y and C_R.<a href="#section-b.2.2-24" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-25">
<pre>
data_2 =
(
  h'52FBA0BDC8D953DD86CE1AB2FD7C05A4658C7C30AFDBFC3301047069451BAF35',
  08
)
</pre><a href="#section-b.2.2-25" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.2.2-26">
<pre>
data_2 (CBOR Sequence) (35 bytes)
58 20 52 fb a0 bd c8 d9 53 dd 86 ce 1a b2 fd 7c 05 a4 65 8c 7c 30 af db
fc 33 01 04 70 69 45 1b af 35 08
</pre><a href="#section-b.2.2-26" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-27">From data_2 and message_1, compute the input to the transcript hash TH_2 = H( message_1, data_2 ), as a CBOR Sequence of these 2 data items.<a href="#section-b.2.2-27" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-28">
<pre>
Input to calculate TH_2 (CBOR Sequence) (72 bytes)
0d 00 58 20 8d 3e f5 6d 1b 75 0a 43 51 d6 8a c2 50 a0 e8 83 79 0e fc 80
a5 38 a4 44 ee 9e 2b 57 e2 44 1a 7c 21 58 20 52 fb a0 bd c8 d9 53 dd 86
ce 1a b2 fd 7c 05 a4 65 8c 7c 30 af db fc 33 01 04 70 69 45 1b af 35 08
</pre><a href="#section-b.2.2-28" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-29">And from there, compute the transcript hash TH_2 = SHA-256( message_1, data_2 )<a href="#section-b.2.2-29" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-30">
<pre>
TH_2 (32 bytes)
6a 28 78 e8 4b 2c c0 21 cc 1a eb a2 96 52 53 ef 42 f7 fa 30 0c af 9c 49
1a 52 e6 83 6a 25 64 ff
</pre><a href="#section-b.2.2-30" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-31">The Responder's subject name is the empty string:<a href="#section-b.2.2-31" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-32">
<pre>
Responders's subject name (text string)
""
</pre><a href="#section-b.2.2-32" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-33">ID_CRED_R is the following:<a href="#section-b.2.2-33" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-34">
<pre>
ID_CRED_R =
{
  4: h'07'
}
</pre><a href="#section-b.2.2-34" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.2.2-35">
<pre>
ID_CRED_R (4 bytes)
a1 04 41 07
</pre><a href="#section-b.2.2-35" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-36">CRED_R is the following COSE_Key:<a href="#section-b.2.2-36" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-37">
<pre>
{
  1: 1,
  -1: 4,
  -2: h'A3FF263595BEB377D1A0CE1D04DAD2D40966AC6BCB622051B84659184D5D9A32',
  "subject name": ""
}
</pre><a href="#section-b.2.2-37" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-38">Which encodes to the following byte string:<a href="#section-b.2.2-38" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-39">
<pre>
CRED_R (54 bytes)
a4 01 01 20 04 21 58 20 a3 ff 26 35 95 be b3 77 d1 a0 ce 1d 04 da d2 d4
09 66 ac 6b cb 62 20 51 b8 46 59 18 4d 5d 9a 32 6c 73 75 62 6a 65 63 74
20 6e 61 6d 65 60
</pre><a href="#section-b.2.2-39" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-40">Since no unprotected opaque auxiliary data is sent in the message exchanges:<a href="#section-b.2.2-40" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-41">
<pre>
AD_2  (0 bytes)
</pre><a href="#section-b.2.2-41" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-42">The Plaintext is defined as the empty string:<a href="#section-b.2.2-42" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-43">
<pre>
P_2m (0 bytes)
</pre><a href="#section-b.2.2-43" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-44">The Enc_structure is defined as follows: [ "Encrypt0", &lt;&lt; ID_CRED_R &gt;&gt;, &lt;&lt; TH_2, CRED_R &gt;&gt; ]<a href="#section-b.2.2-44" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-45">
<pre>
A_2m =
[
  "Encrypt0",
  h'A1044107',
  h'58206A2878E84B2CC021CC1AEBA2965253EF42F7FA300CAF9C491A52E6836A2564FFA401012004215820A3FF263595BEB377D1A0CE1D04DAD2D40966AC6BCB622051B84659184D5D9A326C7375626A656374206E616D6560'
]
</pre><a href="#section-b.2.2-45" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-46">Which encodes to the following byte string to be used as Additional Authenticated Data:<a href="#section-b.2.2-46" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-47">
<pre>
A_2m (CBOR-encoded) (105 bytes)
83 68 45 6e 63 72 79 70 74 30 44 a1 04 41 07 58 58 58 20 6a 28 78 e8 4b
2c c0 21 cc 1a eb a2 96 52 53 ef 42 f7 fa 30 0c af 9c 49 1a 52 e6 83 6a
25 64 ff a4 01 01 20 04 21 58 20 a3 ff 26 35 95 be b3 77 d1 a0 ce 1d 04
da d2 d4 09 66 ac 6b cb 62 20 51 b8 46 59 18 4d 5d 9a 32 6c 73 75 62 6a
65 63 74 20 6e 61 6d 65 60
</pre><a href="#section-b.2.2-47" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-48">info for K_2m is defined as follows:<a href="#section-b.2.2-48" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-49">
<pre>
info for K_2m =
[
  10,
  h'6A2878E84B2CC021CC1AEBA2965253EF42F7FA300CAF9C491A52E6836A2564FF',
  "K_2m",
  16
]
</pre><a href="#section-b.2.2-49" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-50">Which as a CBOR encoded data item is:<a href="#section-b.2.2-50" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-51">
<pre>
info for K_2m (CBOR-encoded) (42 bytes)
84 0a 58 20 6a 28 78 e8 4b 2c c0 21 cc 1a eb a2 96 52 53 ef 42 f7 fa 30
0c af 9c 49 1a 52 e6 83 6a 25 64 ff 64 4b 5f 32 6d 10
</pre><a href="#section-b.2.2-51" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-52">From these parameters, K_2m is computed. Key K_2m is the output of HKDF-Expand(PRK_3e2m, info, L), where L is the length of K_2m, so 16 bytes.<a href="#section-b.2.2-52" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-53">
<pre>
K_2m (16 bytes)
81 2a 48 87 d1 90 ff ed 2b 10 0b a7 a5 c2 5e 67
</pre><a href="#section-b.2.2-53" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-54">info for IV_2m is defined as follows:<a href="#section-b.2.2-54" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-55">
<pre>
info for IV_2m =
[
  10,
  h'6A2878E84B2CC021CC1AEBA2965253EF42F7FA300CAF9C491A52E6836A2564FF',
  "IV_2m",
  13
]
</pre><a href="#section-b.2.2-55" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-56">Which as a CBOR encoded data item is:<a href="#section-b.2.2-56" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-57">
<pre>
info for IV_2m (CBOR-encoded) (43 bytes)
84 0a 58 20 6a 28 78 e8 4b 2c c0 21 cc 1a eb a2 96 52 53 ef 42 f7 fa 30
0c af 9c 49 1a 52 e6 83 6a 25 64 ff 65 49 56 5f 32 6d 0d
</pre><a href="#section-b.2.2-57" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-58">From these parameters, IV_2m is computed. IV_2m is the output of HKDF-Expand(PRK_3e2m, info, L), where L is the length of IV_2m, so 13 bytes.<a href="#section-b.2.2-58" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-59">
<pre>
IV_2m (13 bytes)
92 3c 0f 94 31 51 5b 69 21 30 49 2b 7f
</pre><a href="#section-b.2.2-59" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-60">Finally, COSE_Encrypt0 is computed from the parameters above.<a href="#section-b.2.2-60" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-b.2.2-61.1">protected header = CBOR-encoded ID_CRED_R<a href="#section-b.2.2-61.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-b.2.2-61.2">external_aad = A_2m<a href="#section-b.2.2-61.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-b.2.2-61.3">empty plaintext = P_2m<a href="#section-b.2.2-61.3" class="pilcrow">¶</a>
</li>
          </ul>
<div class="artwork art-text alignLeft" id="section-b.2.2-62">
<pre>
MAC_2 (8 bytes)
64 21 0d 2e 18 b9 28 cd
</pre><a href="#section-b.2.2-62" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-63">From there Signature_or_MAC_2 is the MAC (since method = 3):<a href="#section-b.2.2-63" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-64">
<pre>
Signature_or_MAC_2 (8 bytes)
64 21 0d 2e 18 b9 28 cd
</pre><a href="#section-b.2.2-64" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-65">CIPHERTEXT_2 is the ciphertext resulting from XOR encrypting a plaintext constructed from the following parameters and the key K_2e.<a href="#section-b.2.2-65" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-b.2.2-66.1">plaintext = CBOR Sequence of the items ID_CRED_R and the CBOR encoded Signature_or_MAC_2, in this order. Note that since ID_CRED_R contains a single 'kid' parameter, i.e., ID_CRED_R = { 4 : kid_R }, only the byte string kid_R is conveyed in the plaintext encoded as a bstr_identifier. kid_R is encoded as the corresponding integer - 24 (see bstr_identifier in <a href="#bstr_id" class="xref">Section 4.3</a>), i.e. 0x07 = 7, 7 - 24 = -17, and -17 in CBOR encoding is equal to 0x30.<a href="#section-b.2.2-66.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-b.2.2-67">The plaintext is the following:<a href="#section-b.2.2-67" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-68">
<pre>
P_2e (CBOR Sequence) (10 bytes)
30 48 64 21 0d 2e 18 b9 28 cd
</pre><a href="#section-b.2.2-68" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-69">K_2e = HKDF-Expand( PRK, info, length ), where length is the length of the plaintext, so 80.<a href="#section-b.2.2-69" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-70">
<pre>
info for K_2e =
[
  10,
  h'6A2878E84B2CC021CC1AEBA2965253EF42F7FA300CAF9C491A52E6836A2564FF',
  "K_2e",
  10
]
</pre><a href="#section-b.2.2-70" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-71">Which as a CBOR encoded data item is:<a href="#section-b.2.2-71" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-72">
<pre>
info for K_2e (CBOR-encoded) (42 bytes)
84 0a 58 20 6a 28 78 e8 4b 2c c0 21 cc 1a eb a2 96 52 53 ef 42 f7 fa 30
0c af 9c 49 1a 52 e6 83 6a 25 64 ff 64 4b 5f 32 65 0a
</pre><a href="#section-b.2.2-72" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-73">From there, K_2e is computed:<a href="#section-b.2.2-73" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-74">
<pre>
K_2e (10 bytes)
ec be 9a bd 5f 62 3a fc 65 26
</pre><a href="#section-b.2.2-74" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-75">Using the parameters above, the ciphertext CIPHERTEXT_2 can be computed:<a href="#section-b.2.2-75" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-76">
<pre>
CIPHERTEXT_2 (10 bytes)
dc f6 fe 9c 52 4c 22 45 4d eb
</pre><a href="#section-b.2.2-76" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-77">message_2 is the CBOR Sequence of data_2 and CIPHERTEXT_2, in this order:<a href="#section-b.2.2-77" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-78">
<pre>
message_2 =
(
 data_2,
 h'DCF6FE9C524C22454DEB'
)
</pre><a href="#section-b.2.2-78" class="pilcrow">¶</a>
</div>
<p id="section-b.2.2-79">Which as a CBOR encoded data item is:<a href="#section-b.2.2-79" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.2-80">
<pre>
message_2 (CBOR Sequence) (46 bytes)
58 20 52 fb a0 bd c8 d9 53 dd 86 ce 1a b2 fd 7c 05 a4 65 8c 7c 30 af db
fc 33 01 04 70 69 45 1b af 35 08 4a dc f6 fe 9c 52 4c 22 45 4d eb
</pre><a href="#section-b.2.2-80" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="message3-1">
<section id="section-b.2.3">
          <h3 id="name-message_3-2">
<a href="#section-b.2.3" class="section-number selfRef">B.2.3. </a><a href="#name-message_3-2" class="section-name selfRef">Message_3</a>
          </h3>
<p id="section-b.2.3-1">Since corr equals 1, C_R is not omitted from data_3.<a href="#section-b.2.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-2">
<pre>
SK_I (Initiator's private authentication key) (32 bytes)
2b be a6 55 c2 33 71 c3 29 cf bd 3b 1f 02 c6 c0 62 03 38 37 b8 b5 90 99
a4 43 6f 66 60 81 b0 8e
</pre><a href="#section-b.2.3-2" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.2.3-3">
<pre>
G_I (Initiator's public authentication key) (32 bytes)
2c 44 0c c1 21 f8 d7 f2 4c 3b 0e 41 ae da fe 9c aa 4f 4e 7a bb 83 5e c3
0f 1d e8 8a db 96 ff 71
</pre><a href="#section-b.2.3-3" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-4">HKDF SHA-256 is the HKDF used (as defined by cipher suite 0).<a href="#section-b.2.3-4" class="pilcrow">¶</a></p>
<p id="section-b.2.3-5">From the Initiator's authentication key and the Responder's ephemeral key (see <a href="#dh-ss-m2" class="xref">Appendix B.2.2</a>), the ECDH shared secret G_IY is calculated.<a href="#section-b.2.3-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-6">
<pre>
G_IY (ECDH shared secret) (32 bytes)
cb ff 8c d3 4a 81 df ec 4c b6 5d 9a 57 2e bd 09 64 45 0c 78 56 3d a4 98
1d 80 d3 6c 8b 1a 75 2a
</pre><a href="#section-b.2.3-6" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-7">PRK_4x3m = HMAC-SHA-256 (PRK_3e2m, G_IY).<a href="#section-b.2.3-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-8">
<pre>
PRK_4x3m (32 bytes)
ec 62 92 a0 67 f1 37 fc 7f 59 62 9d 22 6f bf c4 e0 68 89 49 f6 62 a9 7f
d8 2f be b7 99 71 39 4a
</pre><a href="#section-b.2.3-8" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-9">data 3 is equal to C_R.<a href="#section-b.2.3-9" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-10">
<pre>
data_3 (CBOR Sequence) (1 bytes)
08
</pre><a href="#section-b.2.3-10" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-11">From data_3, CIPHERTEXT_2, and TH_2, compute the input to the transcript hash TH_3 = H(TH_2 , CIPHERTEXT_2, data_3), as a CBOR Sequence of these 3 data items.<a href="#section-b.2.3-11" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-12">
<pre>
Input to calculate TH_3 (CBOR Sequence) (46 bytes)
58 20 6a 28 78 e8 4b 2c c0 21 cc 1a eb a2 96 52 53 ef 42 f7 fa 30 0c af
9c 49 1a 52 e6 83 6a 25 64 ff 4a dc f6 fe 9c 52 4c 22 45 4d eb 08
</pre><a href="#section-b.2.3-12" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-13">And from there, compute the transcript hash TH_3 = SHA-256(TH_2 , CIPHERTEXT_2, data_3)<a href="#section-b.2.3-13" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-14">
<pre>
TH_3 (32 bytes)
51 dd 22 43 a6 b8 3f 13 16 dc 53 29 1a e1 91 cd 93 b4 44 cc e4 80 16 07
03 ee d9 c4 a1 bc b6 11
</pre><a href="#section-b.2.3-14" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-15">The initiator's subject name is the empty string:<a href="#section-b.2.3-15" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-16">
<pre>
Initiator's subject name (text string)
""
</pre><a href="#section-b.2.3-16" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-17">And its credential is:<a href="#section-b.2.3-17" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-18">
<pre>
ID_CRED_I =
{
  4: h'24'
}
</pre><a href="#section-b.2.3-18" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.2.3-19">
<pre>
ID_CRED_I (4 bytes)
a1 04 41 24
</pre><a href="#section-b.2.3-19" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-20">CRED_I is the following COSE_Key:<a href="#section-b.2.3-20" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-21">
<pre>
{
  1: 1,
  -1: 4,
   -2: h'2C440CC121F8D7F24C3B0E41AEDAFE9CAA4F4E7ABB835EC30F1DE88ADB96FF71',
   "subject name": ""
 }
</pre><a href="#section-b.2.3-21" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-22">Which encodes to the following byte string:<a href="#section-b.2.3-22" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-23">
<pre>
CRED_I (54 bytes)
a4 01 01 20 04 21 58 20 2c 44 0c c1 21 f8 d7 f2 4c 3b 0e 41 ae da fe 9c
aa 4f 4e 7a bb 83 5e c3 0f 1d e8 8a db 96 ff 71 6c 73 75 62 6a 65 63 74
20 6e 61 6d 65 60
</pre><a href="#section-b.2.3-23" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-24">Since no opaque auxiliary data is exchanged:<a href="#section-b.2.3-24" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-25">
<pre>
AD_3 (0 bytes)
</pre><a href="#section-b.2.3-25" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-26">The Plaintext of the COSE_Encrypt is the empty string:<a href="#section-b.2.3-26" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-27">
<pre>
P_3m (0 bytes)
</pre><a href="#section-b.2.3-27" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-28">The external_aad is the CBOR Sequence of CRED_I and TH_3, in this order:<a href="#section-b.2.3-28" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-29">
<pre>
A_3m (CBOR-encoded) (105 bytes)
83 68 45 6e 63 72 79 70 74 30 44 a1 04 41 24 58 58 58 20 51 dd 22 43 a6
b8 3f 13 16 dc 53 29 1a e1 91 cd 93 b4 44 cc e4 80 16 07 03 ee d9 c4 a1
bc b6 11 a4 01 01 20 04 21 58 20 2c 44 0c c1 21 f8 d7 f2 4c 3b 0e 41 ae
da fe 9c aa 4f 4e 7a bb 83 5e c3 0f 1d e8 8a db 96 ff 71 6c 73 75 62 6a
65 63 74 20 6e 61 6d 65 60
</pre><a href="#section-b.2.3-29" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-30">Info for K_3m is computed as follows:<a href="#section-b.2.3-30" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-31">
<pre>
info for K_3m =
[
  10,
  h'51DD2243A6B83F1316DC53291AE191CD93B444CCE480160703EED9C4A1BCB611',
  "K_3m",
  16
]
</pre><a href="#section-b.2.3-31" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-32">Which as a CBOR encoded data item is:<a href="#section-b.2.3-32" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-33">
<pre>
info for K_3m (CBOR-encoded) (42 bytes)
84 0a 58 20 51 dd 22 43 a6 b8 3f 13 16 dc 53 29 1a e1 91 cd 93 b4 44 cc
e4 80 16 07 03 ee d9 c4 a1 bc b6 11 64 4b 5f 33 6d 10
</pre><a href="#section-b.2.3-33" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-34">From these parameters, K_3m is computed. Key K_3m is the output of HKDF-Expand(PRK_4x3m, info, L), where L is the length of K_2m, so 16 bytes.<a href="#section-b.2.3-34" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-35">
<pre>
K_3m (16 bytes)
84 85 31 8a a3 08 6f d5 86 7a 02 8e 99 e2 40 30
</pre><a href="#section-b.2.3-35" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-36">Nonce IV_3m is the output of HKDF-Expand(PRK_4x3m, info, L), where L = 13 bytes.<a href="#section-b.2.3-36" class="pilcrow">¶</a></p>
<p id="section-b.2.3-37">Info for IV_3m is defined as follows:<a href="#section-b.2.3-37" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-38">
<pre>
info for IV_3m =
[
  10,
  h'51DD2243A6B83F1316DC53291AE191CD93B444CCE480160703EED9C4A1BCB611',
  "IV_3m",
  13
]
</pre><a href="#section-b.2.3-38" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-39">Which as a CBOR encoded data item is:<a href="#section-b.2.3-39" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-40">
<pre>
info for IV_3m (CBOR-encoded) (43 bytes)
84 0a 58 20 51 dd 22 43 a6 b8 3f 13 16 dc 53 29 1a e1 91 cd 93 b4 44 cc
e4 80 16 07 03 ee d9 c4 a1 bc b6 11 65 49 56 5f 33 6d 0d
</pre><a href="#section-b.2.3-40" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-41">From these parameters, IV_3m is computed:<a href="#section-b.2.3-41" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-42">
<pre>
IV_3m (13 bytes)
1e 10 5b 88 50 0e d5 ae b0 5d 00 6b ea
</pre><a href="#section-b.2.3-42" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-43">MAC_3 is the ciphertext of the COSE_Encrypt0:<a href="#section-b.2.3-43" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-44">
<pre>
MAC_3 (8 bytes)
1f b7 5a c1 aa d2 34 25
</pre><a href="#section-b.2.3-44" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-45">Since the method = 3, Signature_or_Mac_3 is the MAC_3:<a href="#section-b.2.3-45" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-46">
<pre>
Signature_or_MAC_3 (8 bytes)
1f b7 5a c1 aa d2 34 25
</pre><a href="#section-b.2.3-46" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-47">Finally, the outer COSE_Encrypt0 is computed.<a href="#section-b.2.3-47" class="pilcrow">¶</a></p>
<p id="section-b.2.3-48">The Plaintext is the following CBOR Sequence: 
plaintext = ( ID_CRED_I , Signature_or_MAC_3 ).  Note that since ID_CRED_I contains a single 'kid' parameter, i.e., ID_CRED_I = { 4 : kid_I }, only the byte string kid_I is conveyed in the plaintext encoded as a bstr_identifier. kid_I is encoded as the corresponding integer - 24 (see bstr_identifier in <a href="#bstr_id" class="xref">Section 4.3</a>), i.e. 0x24 = 36, 36 - 24 = 12, and 12 in CBOR encoding is equal to 0x0c.<a href="#section-b.2.3-48" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-49">
<pre>
P_3ae (CBOR Sequence) (10 bytes)
0c 48 1f b7 5a c1 aa d2 34 25
</pre><a href="#section-b.2.3-49" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-50">The Associated data A is the following:
Associated data A = [ "Encrypt0", h'', TH_3 ]<a href="#section-b.2.3-50" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-51">
<pre>
A_3ae (CBOR-encoded) (45 bytes)
83 68 45 6e 63 72 79 70 74 30 40 58 20 51 dd 22 43 a6 b8 3f 13 16 dc 53
29 1a e1 91 cd 93 b4 44 cc e4 80 16 07 03 ee d9 c4 a1 bc b6 11
</pre><a href="#section-b.2.3-51" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-52">Key K_3ae is the output of HKDF-Expand(PRK_3e2m, info, L).<a href="#section-b.2.3-52" class="pilcrow">¶</a></p>
<p id="section-b.2.3-53">info is defined as follows:<a href="#section-b.2.3-53" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-54">
<pre>
info for K_3ae =
[
  10,
  h'51DD2243A6B83F1316DC53291AE191CD93B444CCE480160703EED9C4A1BCB611',
  "K_3ae",
  16
]
</pre><a href="#section-b.2.3-54" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-55">Which as a CBOR encoded data item is:<a href="#section-b.2.3-55" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-56">
<pre>
info for K_3ae (CBOR-encoded) (43 bytes)
84 0a 58 20 51 dd 22 43 a6 b8 3f 13 16 dc 53 29 1a e1 91 cd 93 b4 44 cc
e4 80 16 07 03 ee d9 c4 a1 bc b6 11 65 4b 5f 33 61 65 10
</pre><a href="#section-b.2.3-56" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-57">L is the length of K_3ae, so 16 bytes.<a href="#section-b.2.3-57" class="pilcrow">¶</a></p>
<p id="section-b.2.3-58">From these parameters, K_3ae is computed:<a href="#section-b.2.3-58" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-59">
<pre>
K_3ae (16 bytes)
bf 29 0b 7e e0 4b 86 5d e1 01 0a 81 1b 36 00 64
</pre><a href="#section-b.2.3-59" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-60">Nonce IV_3ae is the output of HKDF-Expand(PRK_3e2m, info, L).<a href="#section-b.2.3-60" class="pilcrow">¶</a></p>
<p id="section-b.2.3-61">info is defined as follows:<a href="#section-b.2.3-61" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-62">
<pre>
info for IV_3ae =
[
  10,
  h'51DD2243A6B83F1316DC53291AE191CD93B444CCE480160703EED9C4A1BCB611',
  "IV_3ae",
  13
]
</pre><a href="#section-b.2.3-62" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-63">Which as a CBOR encoded data item is:<a href="#section-b.2.3-63" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-64">
<pre>
info for IV_3ae (CBOR-encoded) (44 bytes)
84 0a 58 20 51 dd 22 43 a6 b8 3f 13 16 dc 53 29 1a e1 91 cd 93 b4 44 cc
e4 80 16 07 03 ee d9 c4 a1 bc b6 11 66 49 56 5f 33 61 65 0d
</pre><a href="#section-b.2.3-64" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-65">L is the length of IV_3ae, so 13 bytes.<a href="#section-b.2.3-65" class="pilcrow">¶</a></p>
<p id="section-b.2.3-66">From these parameters, IV_3ae is computed:<a href="#section-b.2.3-66" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-67">
<pre>
IV_3ae (13 bytes)
0e 74 45 0a fc ec e9 73 af 64 e9 4d 46
</pre><a href="#section-b.2.3-67" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-68">Using the parameters above, the ciphertext CIPHERTEXT_3 can be computed:<a href="#section-b.2.3-68" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-69">
<pre>
CIPHERTEXT_3 (18 bytes)
53 c3 99 19 99 a5 ff b8 69 21 e9 9b 60 7c 06 77 70 e0
</pre><a href="#section-b.2.3-69" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-70">From the parameter above, message_3 is computed, as the CBOR Sequence of the following items: (C_R, CIPHERTEXT_3).<a href="#section-b.2.3-70" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-71">
<pre>
message_3 =
(
  h'08',
  h'53C3991999A5FFB86921E99B607C067770E0'
)
</pre><a href="#section-b.2.3-71" class="pilcrow">¶</a>
</div>
<p id="section-b.2.3-72">Which encodes to the following byte string:<a href="#section-b.2.3-72" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2.3-73">
<pre>
message_3 (CBOR Sequence) (20 bytes)
08 52 53 c3 99 19 99 a5 ff b8 69 21 e9 9b 60 7c 06 77 70 e0
</pre><a href="#section-b.2.3-73" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="section-appendix.c">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-appendix.c-1">The authors want to thank Alessandro Bruni, Karthikeyan Bhargavan, Martin Disch, Theis Groenbech Petersen, Dan Harkins, Klaus Hartke, Russ Housley, Alexandros Krontiris, Ilari Liusvaara, Karl Norrman, Salvador Perez, Eric Rescorla, Michael Richardson, Thorvald Sahl Joergensen, Jim Schaad, Carsten Schuermann, Ludwig Seitz, Stanislav Smyshlyaev, Valery Smyslov, Rene Struik, Vaishnavi Sundararajan, Erik Thormarker, and Michel Veillette for reviewing and commenting on intermediate versions of the draft. We are especially indebted to Jim Schaad for his continuous reviewing and implementation of different versions of the draft.<a href="#section-appendix.c-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.d">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Göran Selander</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:goran.selander@ericsson.com" class="email">goran.selander@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">John Preuß Mattsson</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:john.mattsson@ericsson.com" class="email">john.mattsson@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Francesca Palombini</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:francesca.palombini@ericsson.com" class="email">francesca.palombini@ericsson.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
